<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0f172a">
    <title>BÄ°LSEM PRO ANALÄ°ZÃ–R 2026 | BarÄ±ÅŸ Ä°lkan</title>
    
    <!-- KÃ¼tÃ¼phaneler -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --bg-dark: #0f172a;
            --primary: #6366f1;
            --accent: #f43f5e;
            --success: #10b981;
            --card-bg: rgba(30, 41, 59, 0.85);
            --text-light: #f8fafc;
            --glass-border: rgba(255, 255, 255, 0.1);
            --level-1: #38bdf8; /* Ã‡Ä±rak - Mavi */
            --level-2: #fbbf24; /* Usta - SarÄ± */
            --level-3: #f97316; /* Uzman - Turuncu */
            --level-4: #ef4444; /* Åampiyon - KÄ±rmÄ±zÄ± */
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: radial-gradient(circle at top center, #1e1b4b, #020617);
            color: var(--text-light);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
            padding: 10px;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            padding: 30px;
            border-radius: 30px;
            box-shadow: 0 25px 80px rgba(0,0,0,0.6), inset 0 0 0 1px var(--glass-border);
            position: relative;
            transition: all 0.3s ease;
        }

        /* --- Header --- */
        .header-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .control-btn {
            background: rgba(255,255,255,0.1);
            border: 1px solid var(--glass-border);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
        }
        .control-btn:hover { background: var(--primary); }

        .hero-title {
            text-align: center;
            font-size: clamp(1.8rem, 4vw, 2.8rem);
            margin-bottom: 5px;
            background: linear-gradient(135deg, #fff 0%, #cbd5e1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 800;
        }

        .subtitle {
            text-align: center;
            color: #94a3b8;
            font-size: 0.9rem;
            margin-bottom: 25px;
        }

        /* --- Grid Layouts --- */
        .grid-container {
            display: grid;
            gap: 15px;
            margin-top: 10px;
        }

        .class-grid { grid-template-columns: repeat(4, 1fr); }
        .level-grid { grid-template-columns: 1fr; }

        @media (max-width: 600px) {
            .class-grid { grid-template-columns: repeat(2, 1fr); }
        }

        /* --- Buttons --- */
        .select-btn {
            background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
            border: 1px solid var(--glass-border);
            color: white;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 80px;
        }

        .select-btn:hover {
            transform: translateY(-3px);
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .select-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: 0 0 15px var(--primary);
        }

        /* --- Level Cards --- */
        .level-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            cursor: pointer;
            transition: 0.3s;
            margin-bottom: 15px;
        }
        .level-card:hover { transform: scale(1.02); }
        
        .lvl-1:hover { border-color: var(--level-1); box-shadow: 0 0 20px rgba(56, 189, 248, 0.2); }
        .lvl-2:hover { border-color: var(--level-2); box-shadow: 0 0 20px rgba(251, 191, 36, 0.2); }
        .lvl-3:hover { border-color: var(--level-3); box-shadow: 0 0 20px rgba(249, 115, 22, 0.2); }
        .lvl-4:hover { border-color: var(--level-4); box-shadow: 0 0 20px rgba(239, 68, 68, 0.2); }

        .level-icon { font-size: 2rem; width: 60px; text-align: center; }
        .level-info { flex: 1; margin-left: 20px; }
        .level-title { font-weight: bold; font-size: 1.2rem; display: block; margin-bottom: 5px; }
        .level-desc { font-size: 0.8rem; color: #94a3b8; }

        /* --- Quiz Interface --- */
        #quiz-screen { display: none; }
        #level-select-screen { display: none; animation: fadeIn 0.3s ease; }
        #welcome-screen { animation: fadeIn 0.3s ease; }

        .progress-bar-container {
            width: 100%; height: 6px; background: rgba(255,255,255,0.1);
            border-radius: 10px; margin: 20px 0; overflow: hidden;
        }
        .progress-bar { height: 100%; width: 0%; transition: 0.5s; }

        .question-area {
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            min-height: 220px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            margin-bottom: 20px;
            position: relative;
        }

        .category-tag {
            position: absolute; top: -12px; background: var(--primary);
            padding: 4px 12px; border-radius: 12px; font-size: 0.8rem;
            font-weight: bold; letter-spacing: 1px;
        }

        .q-text { font-size: 1.4rem; margin-bottom: 20px; line-height: 1.5; }
        
        .options-grid {
            display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;
        }
        
        .opt-btn {
            background: white; color: #0f172a; border: none;
            padding: 20px; font-size: 1.2rem; border-radius: 15px;
            cursor: pointer; font-weight: bold; box-shadow: 0 4px 0 #cbd5e1;
            transition: all 0.1s;
        }
        .opt-btn:active { transform: translateY(4px); box-shadow: 0 0 0; }
        
        /* Matris Stilleri */
        .matrix-container { display: grid; gap: 8px; margin: 15px 0; }
        .m-2x2 { grid-template-columns: repeat(2, 1fr); }
        .m-3x3 { grid-template-columns: repeat(3, 1fr); }
        .m-cell {
            width: 50px; height: 50px; background: #334155;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; border-radius: 8px;
        }
        .m-missing { background: var(--accent); color: white; border: 2px dashed white; }

        /* SonuÃ§ EkranÄ± */
        #result-screen { display: none; text-align: center; }
        .score-big { font-size: 3rem; font-weight: 800; margin: 10px 0; background: -webkit-linear-gradient(#fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        @keyframes fadeIn { from {opacity:0; transform:translateY(10px);} to {opacity:1; transform:translateY(0);} }
        .correct-anim { background: #22c55e !important; color: white !important; box-shadow: 0 4px 0 #15803d !important; }
        .wrong-anim { background: #ef4444 !important; color: white !important; box-shadow: 0 4px 0 #b91c1c !important; }

    </style>
</head>
<body>

<div class="container">
    
    <!-- Ãœst Bar -->
    <div class="header-controls">
        <button class="control-btn" onclick="toggleSound()"><i class="fas fa-volume-up" id="snd-icon"></i></button>
        <button class="control-btn" onclick="location.reload()"><i class="fas fa-home"></i></button>
    </div>

    <!-- 1. GÄ°RÄ°Å & SINIF SEÃ‡Ä°MÄ° -->
    <div id="welcome-screen">
        <h1 class="hero-title">BÄ°LSEM PRO 2026</h1>
        <p class="subtitle">TÃ¼rkiye Geneli BÄ°LSEM HazÄ±rlÄ±k ve Zeka GeliÅŸtirme Platformu</p>

        <h3 style="margin-bottom:15px; border-left:4px solid var(--primary); padding-left:10px;">SÄ±nÄ±f Seviyesi SeÃ§iniz:</h3>
        
        <!-- Dinamik SÄ±nÄ±f ButonlarÄ± (1-8) -->
        <div class="grid-container class-grid">
            <div class="select-btn" onclick="selectGrade(1)"><span>1.</span><small>SÄ±nÄ±f</small></div>
            <div class="select-btn" onclick="selectGrade(2)"><span>2.</span><small>SÄ±nÄ±f</small></div>
            <div class="select-btn" onclick="selectGrade(3)"><span>3.</span><small>SÄ±nÄ±f</small></div>
            <div class="select-btn" onclick="selectGrade(4)"><span>4.</span><small>SÄ±nÄ±f</small></div>
            <div class="select-btn" onclick="selectGrade(5)"><span>5.</span><small>SÄ±nÄ±f</small></div>
            <div class="select-btn" onclick="selectGrade(6)"><span>6.</span><small>SÄ±nÄ±f</small></div>
            <div class="select-btn" onclick="selectGrade(7)"><span>7.</span><small>SÄ±nÄ±f</small></div>
            <div class="select-btn" onclick="selectGrade(8)"><span>8.</span><small>SÄ±nÄ±f</small></div>
        </div>

        <div style="margin-top: 20px; font-size: 0.8rem; color: #64748b; text-align: center;">
            * BÄ°LSEM sÄ±navlarÄ± genelde 1, 2 ve 3. sÄ±nÄ±flar iÃ§indir. Ancak sistemimiz 8. sÄ±nÄ±fa kadar zeka geliÅŸimi saÄŸlar.
        </div>
    </div>

    <!-- 2. SEVÄ°YE SEÃ‡Ä°MÄ° -->
    <div id="level-select-screen">
        <h2 id="level-title-display" style="text-align: center; margin-bottom: 5px;">2. SÄ±nÄ±f</h2>
        <p style="text-align: center; color: #94a3b8; margin-bottom: 20px;">Zorluk seviyesi seÃ§iniz</p>

        <div class="level-card lvl-1" onclick="startExam(1)">
            <div class="level-icon" style="color:var(--level-1)"><i class="fas fa-bicycle"></i></div>
            <div class="level-info">
                <span class="level-title" style="color:var(--level-1)">SEVÄ°YE 1: Ã‡IRAK</span>
                <span class="level-desc">IsÄ±nma turlarÄ±. Temel mantÄ±k ve gÃ¶rsel dikkat sorularÄ±. (15 Soru)</span>
            </div>
            <i class="fas fa-chevron-right"></i>
        </div>

        <div class="level-card lvl-2" onclick="startExam(2)">
            <div class="level-icon" style="color:var(--level-2)"><i class="fas fa-motorcycle"></i></div>
            <div class="level-info">
                <span class="level-title" style="color:var(--level-2)">SEVÄ°YE 2: USTA</span>
                <span class="level-desc">BÄ°LSEM sÄ±nav standardÄ±. Åifreleme ve Matrisler baÅŸlar. (15 Soru)</span>
            </div>
            <i class="fas fa-chevron-right"></i>
        </div>

        <div class="level-card lvl-3" onclick="startExam(3)">
            <div class="level-icon" style="color:var(--level-3)"><i class="fas fa-car-side"></i></div>
            <div class="level-info">
                <span class="level-title" style="color:var(--level-3)">SEVÄ°YE 3: UZMAN</span>
                <span class="level-desc">ZorlayÄ±cÄ± sorular. 3x3 Matrisler ve Ã§oklu iliÅŸkilendirme. (20 Soru)</span>
            </div>
            <i class="fas fa-chevron-right"></i>
        </div>

        <div class="level-card lvl-4" onclick="startExam(4)">
            <div class="level-icon" style="color:var(--level-4)"><i class="fas fa-jet-fighter"></i></div>
            <div class="level-info">
                <span class="level-title" style="color:var(--level-4)">SEVÄ°YE 4: ÅAMPÄ°YON</span>
                <span class="level-desc">ÃœstÃ¼n yetenek seviyesi. Soyut dÃ¼ÅŸÃ¼nme ve ileri analiz. (20 Soru)</span>
            </div>
            <i class="fas fa-chevron-right"></i>
        </div>
        
        <button onclick="goBackToGrade()" style="background:none; border:none; color:#94a3b8; width:100%; padding:10px; cursor:pointer;">&larr; SÄ±nÄ±f SeÃ§imine DÃ¶n</button>
    </div>

    <!-- 3. SINAV EKRANI -->
    <div id="quiz-screen">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <span id="q-counter">Soru 1/15</span>
            <span id="timer-display" style="background:rgba(255,255,255,0.1); padding:4px 10px; border-radius:10px;"><i class="fas fa-clock"></i> 00:00</span>
        </div>
        
        <div class="progress-bar-container">
            <div class="progress-bar" id="progress-bar" style="background: var(--level-1)"></div>
        </div>

        <div class="question-area">
            <span class="category-tag" id="q-cat">MATRÄ°S</span>
            <div id="q-content"></div>
        </div>

        <div class="options-grid" id="opt-area"></div>
    </div>

    <!-- 4. SONUÃ‡ EKRANI -->
    <div id="result-screen">
        <h2>ANALÄ°Z TAMAMLANDI</h2>
        <div class="score-big" id="final-score">0</div>
        <p style="color:#cbd5e1">DoÄŸru Cevap</p>
        
        <div style="height: 300px; margin: 20px 0;">
            <canvas id="radarChart"></canvas>
        </div>
        
        <div id="ai-feedback" style="background:rgba(255,255,255,0.05); padding:15px; border-radius:15px; text-align:left; font-size:0.95rem; line-height:1.5;"></div>

        <button class="select-btn" style="width:100%; margin-top:20px; background:var(--primary);" onclick="location.reload()">
            <i class="fas fa-redo"></i> YENÄ° TEST
        </button>
    </div>

</div>

<script>
    /* --- SÄ°STEM DEÄÄ°ÅKENLERÄ° --- */
    let state = {
        grade: 1,
        level: 1,
        score: 0,
        qIndex: 0,
        questions: [],
        timer: 0,
        timerInt: null,
        sound: true,
        stats: { 'GÃ¶rsel':0, 'MantÄ±k':0, 'Matris':0, 'Matematik':0, 'HafÄ±za':0 } // DoÄŸrular
    };

    const categories = ['GÃ¶rsel', 'MantÄ±k', 'Matris', 'Matematik', 'HafÄ±za'];
    
    // Ses Motoru
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(type) {
        if(!state.sound) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        
        if(type === 'correct') {
            osc.frequency.setValueAtTime(600, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.start(); osc.stop(audioCtx.currentTime + 0.1);
        } else {
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(200, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.2);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
            osc.start(); osc.stop(audioCtx.currentTime + 0.2);
        }
    }
    
    function toggleSound() { state.sound = !state.sound; document.getElementById('snd-icon').className = state.sound ? 'fas fa-volume-up' : 'fas fa-volume-mute'; }

    /* --- NAVÄ°GASYON --- */
    function selectGrade(g) {
        state.grade = g;
        document.getElementById('welcome-screen').style.display = 'none';
        document.getElementById('level-select-screen').style.display = 'block';
        document.getElementById('level-title-display').innerText = `${g}. SÄ±nÄ±f Seviye SeÃ§imi`;
    }

    function goBackToGrade() {
        document.getElementById('level-select-screen').style.display = 'none';
        document.getElementById('welcome-screen').style.display = 'block';
    }

    function startExam(lvl) {
        state.level = lvl;
        state.questions = generateExam(state.grade, lvl);
        state.score = 0;
        state.qIndex = 0;
        state.timer = 0;
        
        // Renk ayarla
        let color = lvl===1?'var(--level-1)':(lvl===2?'var(--level-2)':(lvl===3?'var(--level-3)':'var(--level-4)'));
        document.getElementById('progress-bar').style.backgroundColor = color;
        
        document.getElementById('level-select-screen').style.display = 'none';
        document.getElementById('quiz-screen').style.display = 'block';
        
        if(audioCtx.state === 'suspended') audioCtx.resume();
        
        state.timerInt = setInterval(() => {
            state.timer++;
            let m = Math.floor(state.timer/60).toString().padStart(2,'0');
            let s = (state.timer%60).toString().padStart(2,'0');
            document.getElementById('timer-display').innerHTML = `<i class="fas fa-clock"></i> ${m}:${s}`;
        }, 1000);

        showQuestion();
    }

    /* --- SORU ÃœRETÄ°M MOTORU (BÄ°LSEM ALGORÄ°TMASI) --- */
    function generateExam(grade, level) {
        let qCount = level >= 3 ? 20 : 15;
        let exam = [];
        
        for(let i=0; i<qCount; i++) {
            // Dengeli DaÄŸÄ±lÄ±m
            let type = categories[i % 5];
            
            if(type === 'Matris') exam.push(genMatrix(grade, level));
            else if(type === 'Matematik') exam.push(genMath(grade, level));
            else if(type === 'MantÄ±k') exam.push(genLogic(grade, level));
            else if(type === 'GÃ¶rsel') exam.push(genVisual(grade, level));
            else exam.push(genMemory(grade, level));
        }
        return exam.sort(() => Math.random() - 0.5);
    }

    // 1. Matris Ãœretici
    function genMatrix(g, l) {
        let size = (g >= 3 || l >= 3) ? 3 : 2; // 3. sÄ±nÄ±f veya Seviye 3 ise 3x3
        let shapes = ['â– ','â–²','â—','â˜…','â™¦','â™ ','â™£','â™¥'];
        let s1 = shapes[Math.floor(Math.random()*shapes.length)];
        let s2 = shapes[Math.floor(Math.random()*shapes.length)];
        while(s1===s2) s2 = shapes[Math.floor(Math.random()*shapes.length)];
        
        // Kural: Her satÄ±rda A ve B var (Basit) veya Her satÄ±r kayÄ±yor (Zor)
        let grid = [];
        let ans;
        
        if(size === 2) {
            // A B
            // B ? (A)
            grid = [s1, s2, s2, '?'];
            ans = s1;
        } else {
            // A B C
            // B C A
            // C A ? (B)
            let s3 = shapes[Math.floor(Math.random()*shapes.length)];
            grid = [s1,s2,s3, s2,s3,s1, s3,s1,'?'];
            ans = s2;
        }

        // HTML OluÅŸtur
        let html = `<div class="matrix-container ${size===3?'m-3x3':'m-2x2'}">`;
        grid.forEach(cell => {
            html += `<div class="m-cell ${cell==='?'?'m-missing':''}">${cell}</div>`;
        });
        html += `</div>`;

        return {
            cat: 'Matris',
            html: `Åekil Ã¶rgÃ¼sÃ¼nÃ¼ tamamlayan hangisidir?<br>${html}`,
            opts: generateOptions(ans, shapes),
            ans: ans
        };
    }

    // 2. Matematik (Åifreli)
    function genMath(g, l) {
        let max = (g * 10) + (l * 5); // ZorluÄŸa gÃ¶re sayÄ± bÃ¼yÃ¼r
        let n1 = Math.floor(Math.random() * max) + 1;
        let n2 = Math.floor(Math.random() * (max/2)) + 1;
        let ans = n1 + n2;
        let symbol = ['ğŸ','ğŸš—','ğŸš€','ğŸ’'][Math.floor(Math.random()*4)];
        
        // Seviye 4 ise Ã§arpma olabilir
        if(l === 4 && g > 2) {
            n1 = Math.floor(Math.random() * 10) + 2;
            n2 = Math.floor(Math.random() * 5) + 2;
            ans = n1 * n2;
            return {
                cat: 'Matematik',
                html: `${symbol} = ${n1} <br> ${symbol} x ${n2} = ?`,
                opts: generateNumberOptions(ans),
                ans: ans
            };
        }

        return {
            cat: 'Matematik',
            html: `${symbol} = ${n1} ise;<br>${symbol} + ${n2} iÅŸleminin sonucu kaÃ§tÄ±r?`,
            opts: generateNumberOptions(ans),
            ans: ans
        };
    }

    // 3. MantÄ±k (Analoji)
    function genLogic(g, l) {
        // Basit veritabanÄ±
        const pairs = [
            ['Ayak-AyakkabÄ±', 'El-Eldiven'], ['GÃ¶z-GÃ¶zlÃ¼k', 'Kulak-KulaklÄ±k'],
            ['Limon-EkÅŸi', 'Biber-AcÄ±'], ['ArÄ±-Bal', 'Ä°nek-SÃ¼t'],
            ['Yaz-SÄ±cak', 'KÄ±ÅŸ-SoÄŸuk'], ['Doktor-Hastane', 'Ã–ÄŸretmen-Okul'],
            ['BalÄ±k-YÃ¼zmek', 'KuÅŸ-UÃ§mak'], ['Ressam-FÄ±rÃ§a', 'Yazar-Kalem']
        ];
        
        let p = pairs[Math.floor(Math.random()*pairs.length)];
        let p1 = p[0].split('-');
        let p2 = p[1].split('-');
        
        return {
            cat: 'MantÄ±k',
            html: `<div style="font-size:1.5rem; margin-bottom:10px;">${p1[0]} <i class="fas fa-arrow-right"></i> ${p1[1]}</div>
                   <div style="font-size:1.5rem;">${p2[0]} <i class="fas fa-arrow-right"></i> ?</div>`,
            opts: [p2[1], 'Masa', 'Araba', 'GÃ¼neÅŸ'].sort(()=>Math.random()-0.5),
            ans: p2[1]
        };
    }

    // 4. GÃ¶rsel (Fark Bulma / YansÄ±ma)
    function genVisual(g, l) {
        if(l >= 3) {
            // YansÄ±ma Sorusu
            let arr = ['P','R','K','L','F'];
            let char = arr[Math.floor(Math.random()*arr.length)];
            let wrong = char; 
            // Basit simÃ¼lasyon: YansÄ±ma sorusu metin tabanlÄ± zor olduÄŸu iÃ§in yÃ¶n soruyoruz
            let arrow = ['â¬…ï¸','â¡ï¸','â¬†ï¸','â¬‡ï¸'];
            let i = Math.floor(Math.random()*4);
            let q = arrow[i];
            let a = (i%2===0) ? arrow[i+1] : arrow[i-1]; // Sol->SaÄŸ, YukarÄ±->AÅŸaÄŸÄ±
            
            return {
                cat: 'GÃ¶rsel',
                html: `<div style="font-size:3rem">${q}</div><br>Aynadaki gÃ¶rÃ¼ntÃ¼sÃ¼ hangisidir?`,
                opts: arrow,
                ans: a
            };
        } else {
            // FarklÄ± olanÄ± bul
            let base = ['ğŸ¤ ','ğŸ˜','ğŸ¥º','ğŸ˜¡'][Math.floor(Math.random()*4)];
            let diff = ['ğŸ¤ ','ğŸ˜','ğŸ¥º','ğŸ˜¡'][Math.floor(Math.random()*4)];
            while(base===diff) diff = ['ğŸ‘½','ğŸ¤¡','ğŸ¤–','ğŸƒ'][Math.floor(Math.random()*4)];
            
            return {
                cat: 'GÃ¶rsel',
                html: `Hangisi diÄŸerlerinden farklÄ±dÄ±r?`,
                opts: [base, base, base, diff].sort(()=>Math.random()-0.5),
                ans: diff
            };
        }
    }

    // 5. HafÄ±za (Åifreleme)
    function genMemory(g, l) {
        // Kodlama sorusu: A=1, B=2 ise BABA=?
        let map = { 'A':1, 'K':2, 'L':3, 'E':4 };
        let word = "";
        let val = "";
        let chars = ['A','K','E','L'];
        
        for(let i=0; i<(l+2); i++) { // Seviye arttÄ±kÃ§a kelime uzar
            let c = chars[Math.floor(Math.random()*chars.length)];
            word += c;
            val += map[c];
        }

        // YanlÄ±ÅŸ cevap Ã¼retimi
        let w1 = "", w2 = "", w3 = "";
        for(let k=0; k<word.length; k++) {
             w1 += Math.floor(Math.random()*5);
             w2 += map[chars[Math.floor(Math.random()*4)]];
        }

        return {
            cat: 'HafÄ±za',
            html: `A=1, K=2, L=3, E=4<br><br><b>${word}</b> ÅŸifresi nedir?`,
            opts: [val, w1, w2, val.split('').reverse().join('')].sort(()=>Math.random()-0.5),
            ans: val
        };
    }

    /* --- YARDIMCILAR --- */
    function generateOptions(correct, pool) {
        let opts = [correct];
        while(opts.length < 4) {
            let r = pool[Math.floor(Math.random()*pool.length)];
            if(!opts.includes(r)) opts.push(r);
        }
        return opts.sort(()=>Math.random()-0.5);
    }

    function generateNumberOptions(num) {
        return [num, num+1, num-1, num+2].sort(()=>Math.random()-0.5);
    }

    /* --- OYUN AKIÅI --- */
    function showQuestion() {
        if(state.qIndex >= state.questions.length) {
            finishExam();
            return;
        }
        
        let q = state.questions[state.qIndex];
        document.getElementById('q-counter').innerText = `Soru ${state.qIndex+1}/${state.questions.length}`;
        document.getElementById('progress-bar').style.width = `${(state.qIndex / state.questions.length)*100}%`;
        
        document.getElementById('q-cat').innerText = q.cat;
        document.getElementById('q-content').innerHTML = `<div class="q-text">${q.html}</div>`;
        
        let btns = "";
        q.opts.forEach(o => {
            btns += `<button class="opt-btn" onclick="check('${o}', '${q.ans}', '${q.cat}', this)">${o}</button>`;
        });
        document.getElementById('opt-area').innerHTML = btns;
    }

    let locked = false;
    function check(userAns, realAns, cat, btn) {
        if(locked) return;
        locked = true;
        
        if(String(userAns) === String(realAns)) {
            state.score++;
            state.stats[cat]++;
            btn.classList.add('correct-anim');
            playSound('correct');
        } else {
            btn.classList.add('wrong-anim');
            playSound('wrong');
        }
        
        setTimeout(() => {
            state.qIndex++;
            showQuestion();
            locked = false;
        }, 800);
    }

    function finishExam() {
        clearInterval(state.timerInt);
        document.getElementById('quiz-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
        
        document.getElementById('final-score').innerText = `${state.score} / ${state.questions.length}`;
        
        // Grafik
        const ctx = document.getElementById('radarChart').getContext('2d');
        let labels = Object.keys(state.stats);
        let data = Object.values(state.stats).map(val => (val/ (state.questions.length/5) ) * 100); // YaklaÅŸÄ±k yÃ¼zde
        
        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Performans',
                    data: data,
                    backgroundColor: 'rgba(99, 102, 241, 0.4)',
                    borderColor: '#6366f1',
                    pointBackgroundColor: '#fff'
                }]
            },
            options: {
                scales: { r: { suggestedMin: 0, suggestedMax: 100, grid: {color:'rgba(255,255,255,0.1)'}, pointLabels:{color:'white'} } },
                plugins: { legend: {display:false} }
            }
        });

        // AI Yorumu
        let percent = (state.score / state.questions.length) * 100;
        let msg = "";
        if(percent > 85) msg = "MÃ¼kemmel! BÄ°LSEM sÄ±navÄ±na hazÄ±r gÃ¶rÃ¼nÃ¼yorsun. ÃœstÃ¼n yetenek potansiyelin Ã§ok yÃ¼ksek.";
        else if(percent > 60) msg = "Gayet iyi. Ã–zellikle Matris ve MantÄ±k alanlarÄ±nda biraz daha pratikle Åampiyon seviyesine Ã§Ä±kabilirsin.";
        else msg = "GeliÅŸime aÃ§Ä±ksÄ±n. Bu testler zeka seviyeni deÄŸil, soru Ã§Ã¶zme pratiÄŸini Ã¶lÃ§er. DÃ¼zenli Ã§alÄ±ÅŸarak hÄ±zla yÃ¼kseleceksin.";
        
        document.getElementById('ai-feedback').innerText = `KoÃ§ Yorumu (${state.grade}. SÄ±nÄ±f - Seviye ${state.level}):\n${msg}`;
    }
</script>

</body>
</html>
