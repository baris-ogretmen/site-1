<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SÃ¼per YÃ¶netici Paneli | BarÄ±ÅŸ Ä°lkan</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f8fafc; padding: 20px; color:#334155; }
        .container { max-width: 700px; margin: 0 auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        h2 { text-align: center; color: #2563eb; margin-bottom: 20px; font-weight:900; }
        
        .stat-card { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; padding: 25px; border-radius: 15px; text-align: center; margin-bottom: 25px; box-shadow: 0 10px 20px rgba(37, 99, 235, 0.2); }
        .stat-count { font-size: 3.5rem; font-weight: 800; line-height: 1; margin: 10px 0; }
        
        /* SEKMELER */
        .tab-buttons { display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; }
        .tab-btn { flex: 1; background: #e2e8f0; color: #64748b; border: none; padding: 12px; cursor: pointer; border-radius: 10px; font-weight: 700; font-size:0.9rem; transition:0.3s; }
        .tab-btn:hover { background: #cbd5e1; }
        .tab-btn.active { background: #2563eb; color: white; box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3); }

        /* FORMLAR */
        .form-group { margin-bottom: 15px; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; box-sizing: border-box; font-family: inherit; transition:0.3s; }
        input:focus, textarea:focus { border-color: #2563eb; outline:none; }
        button.save-btn { width: 100%; padding: 12px; background: #10b981; color: white; border: none; border-radius: 10px; font-size: 16px; font-weight:bold; cursor: pointer; transition: 0.3s; }
        button.save-btn:hover { background: #059669; }

        /* LÄ°STE KARTLARI */
        .item-card { background: #fff; border: 1px solid #f1f5f9; padding: 15px; border-radius: 12px; margin-bottom: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); transition:0.2s; }
        .item-card:hover { transform:translateY(-2px); box-shadow: 0 10px 15px rgba(0,0,0,0.05); }
        
        .btn-action-group { display: flex; gap: 5px; margin-top: 10px; flex-wrap: wrap; }
        .btn-mini { border: none; padding: 8px 12px; border-radius: 6px; font-size: 0.8rem; font-weight: bold; cursor: pointer; flex: 1; display:flex; align-items:center; justify-content:center; gap:5px; }
        
        .btn-vitrin { background: #FFD700; color: #000; }
        .btn-sil { background: #ef4444; color: white; flex: 0.3; }
        .btn-kat { background: #e2e8f0; color: #333; }

        /* SABÄ°T ESERLER KUTUSU */
        .fixed-box { background: #fffbeb; border: 2px solid #fef3c7; padding: 15px; border-radius: 12px; margin-bottom: 20px; }
        .fixed-title { color: #b45309; font-weight: bold; margin-bottom: 10px; display: block; }
        
        .message { margin-top: 15px; padding: 15px; border-radius: 8px; display: none; text-align: center; font-weight: bold; position:fixed; top:20px; left:50%; transform:translateX(-50%); z-index:9999; box-shadow:0 10px 30px rgba(0,0,0,0.2); }
        .success { background: #22c55e; color: white; }
    </style>
</head>
<body>

    <div class="message" id="mesaj-kutusu"></div>

    <div class="container">
        <div class="stat-card">
            <div style="opacity:0.8; font-size:0.9rem;">BugÃ¼n Gelen ZiyaretÃ§i</div>
            <div class="stat-count" id="ziyaret-sayisi">0</div>
        </div>

        <h2><i class="fas fa-rocket"></i> SÃ¼per YÃ¶netici Paneli</h2>
        
        <div class="tab-buttons">
            <button class="tab-btn active" id="btn-proje" onclick="tabDegis('proje')">Projeler & Oyunlar</button>
            <button class="tab-btn" id="btn-yazi" onclick="tabDegis('yazi')">KÃ¶ÅŸe YazÄ±larÄ±</button>
            <button class="tab-btn" id="btn-duyuru" onclick="tabDegis('duyuru')">Duyurular</button>
            <button class="tab-btn" id="btn-mesaj" onclick="tabDegis('mesaj')">Mesajlar</button>
        </div>

        <div id="proje-formu">
            <div class="fixed-box">
                <span class="fixed-title"><i class="fas fa-book"></i> Sabit Eserlerim (HÄ±zlÄ± Vitrin)</span>
                <div class="btn-action-group">
                    <button onclick="vitrinYap('ğŸ“– Ben Ali', 'Hz. Ali\'nin Ã§ocukluÄŸunu anlatan eÅŸsiz eser.', 'ben-ali.html')" class="btn-mini btn-kat">Ben Ali KitabÄ±</button>
                    <button onclick="vitrinYap('ğŸ“– En GÃ¼Ã§lÃ¼ Ã‡ocuk Halid', 'Ä°slamiyet\'i tanÄ±ma serÃ¼veni.', 'en-guclu-cocuk-halid.html')" class="btn-mini btn-kat">Halid KitabÄ±</button>
                    <button onclick="vitrinYap('ğŸµ MÃ¼zik Kutusu', 'EÄŸitici ve Ã¶ÄŸretici ÅŸarkÄ±lar.', 'sarkilar.html')" class="btn-mini btn-kat">ÅarkÄ±lar</button>
                    <button onclick="vitrinYap('ğŸ“Š GeliÅŸim Karnesi', 'Ã–ÄŸrencinin durumunu gÃ¶r.', 'karne.html')" class="btn-mini btn-kat">Karne</button>
                </div>
            </div>

            <h3 style="color:#475569;">Yeni Proje Ekle</h3>
            <div class="form-group"><input type="text" id="p-baslik" placeholder="BaÅŸlÄ±k (Ã–rn: Fen 1. Ãœnite Ã–zeti)"></div>
            <div class="form-group"><textarea id="p-aciklama" rows="2" placeholder="AÃ§Ä±klama (Vitrinde gÃ¶rÃ¼necek yazÄ±)"></textarea></div>
            <div class="form-group"><input type="text" id="p-link" placeholder="Link (Ã–rn: fen-5-ozet.html)"></div>
            
            <div class="form-group" style="display:flex; gap:10px;">
                <select id="p-kategori" style="flex:2;">
                    <option value="">Kategori SeÃ§iniz...</option>
                    <option value="Ortaokul">ğŸ“š Ortaokul / Ders</option>
                    <option value="LGS KoÃ§luk">ğŸ¯ LGS & YKS KoÃ§luk</option>
                    <option value="AkÄ±l Zeka">ğŸ§  AkÄ±l Zeka</option>
                    <option value="SatranÃ§">â™ SatranÃ§</option>
                    <option value="Anaokulu">ğŸ§¸ Anaokulu</option>
                    <option value="Ä°lkokul">ğŸ« Ä°lkokul</option>
                    <option value="Ã–zel EÄŸitim">ğŸ§© Ã–zel EÄŸt.</option>
                    <option value="Robotik">ğŸ¤– Robotik</option>
                </select>
                
                <select id="p-sinif" style="flex:1; border-color:#8b5cf6; font-weight:bold;">
                    <option value="">SÄ±nÄ±f</option>
                    <option value="5">5. SÄ±nÄ±f</option>
                    <option value="6">6. SÄ±nÄ±f</option>
                    <option value="7">7. SÄ±nÄ±f</option>
                    <option value="8">8. SÄ±nÄ±f</option>
                </select>
            </div>
            
            <div class="form-group"><select id="p-icon"><option value="fa-book">ğŸ“š Kitap/Ders</option><option value="fa-gamepad">ğŸ® Oyun</option><option value="fa-brain">ğŸ§  Zeka</option><option value="fa-robot">ğŸ¤– Robotik</option><option value="fa-chess-knight">â™ SatranÃ§</option></select></div>
            <button onclick="projeEkle()" class="save-btn">Projeyi Kaydet</button>
            
            <div style="margin-top: 30px;"><h4 style="border-bottom:2px solid #eee; padding-bottom:10px;">ğŸ“‚ Mevcut Projeler</h4><div id="list-projeler"></div></div>
        </div>

        <div id="yazi-formu" style="display:none;">
            <h3 style="color:#475569;">Yeni YazÄ± Ekle</h3>
            <div class="form-group"><input type="text" id="y-baslik" placeholder="YazÄ± BaÅŸlÄ±ÄŸÄ±"></div>
            <div class="form-group"><textarea id="y-icerik" rows="10" placeholder="Ä°Ã§erik (HTML destekler)..."></textarea></div>
            <button onclick="yaziEkle()" class="save-btn">YazÄ±yÄ± YayÄ±nla</button>
            <div style="margin-top: 30px;"><h4 style="border-bottom:2px solid #eee; padding-bottom:10px;">ğŸ“„ Mevcut YazÄ±lar</h4><div id="list-yazilar"></div></div>
        </div>

        <div id="duyuru-formu" style="display:none;">
            <h3 style="color:#475569;">Yeni Duyuru</h3>
            <div class="form-group"><input type="text" id="d-metin" placeholder="Duyuru metni..."></div>
            <button onclick="duyuruEkle()" class="save-btn">Duyuruyu As</button>
            <div style="margin-top: 30px;"><h4 style="border-bottom:2px solid #eee; padding-bottom:10px;">ğŸ“¢ Aktif Duyurular</h4><div id="list-duyurular"></div></div>
        </div>

        <div id="mesaj-formu" style="display:none;">
            <h3 style="color:#475569;">Gelen Talepler</h3>
            <div id="mesaj-listesi"></div>
        </div>

    </div>
    
    <center style="margin-top:20px;">
        <a href="https://info.flagcounter.com/Xk1d"><img src="https://s01.flagcounter.com/count2/Xk1d/bg_FFFFFF/txt_000000/border_CCCCCC/columns_2/maxflags_10/viewers_0/labels_0/pageviews_0/flags_0/percent_0/" alt="Flag Counter" border="0"></a>
    </center>

    <script>
        const db = firebase.firestore();

        // Ä°statistik
        const bugunStr = new Date().toISOString().split('T')[0];
        db.collection("istatistik").doc(bugunStr).onSnapshot(doc => { document.getElementById('ziyaret-sayisi').innerText = doc.exists ? doc.data().ziyaret : 0; });

        // SEKME GEÃ‡Ä°ÅLERÄ°
        function tabDegis(tip) {
            document.querySelectorAll('[id$="-formu"]').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tip + '-formu').style.display = 'block';
            if(tip !== 'mesaj') document.getElementById('btn-' + tip).classList.add('active');
        }

        // --- EKLEME FONKSÄ°YONLARI ---
        function projeEkle() {
            const b = document.getElementById('p-baslik').value; 
            const l = document.getElementById('p-link').value; 
            const k = document.getElementById('p-kategori').value; 
            const s = document.getElementById('p-sinif').value; // SÄ±nÄ±f verisi
            
            if(!b || !l) { alert("BaÅŸlÄ±k ve Link zorunlu!"); return; }
            
            db.collection("projeler").add({ 
                baslik: b, 
                aciklama: document.getElementById('p-aciklama').value, 
                link: l, 
                kategori: k, 
                sinif: s, // SÄ±nÄ±fÄ± veritabanÄ±na ekle
                icon: document.getElementById('p-icon').value, 
                tarih: firebase.firestore.FieldValue.serverTimestamp() 
            }).then(() => { resetForm('proje-formu'); });
        }

        function duyuruEkle() {
            const m = document.getElementById('d-metin').value; if(!m) return;
            db.collection("duyurular").add({ metin: m, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(() => { resetForm('duyuru-formu'); });
        }
        function yaziEkle() {
            const b = document.getElementById('y-baslik').value; const i = document.getElementById('y-icerik').value; if(!b || !i) return;
            db.collection("yazilar").add({ baslik: b, icerik: i, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(() => { resetForm('yazi-formu'); });
        }

        // --- SÃœPER LÄ°STELEME FONKSÄ°YONU ---
        function listeGetir(koleksiyon, divId, ikon) {
            db.collection(koleksiyon).orderBy("tarih", "desc").onSnapshot(snap => {
                let html = "";
                snap.forEach(doc => {
                    const d = doc.data();
                    let baslik = d.baslik || d.metin || d.ad_soyad;
                    const safeBaslik = (baslik || "").replace(/'/g, "\\'");
                    const safeAciklama = (d.aciklama || "Ä°ncelemek iÃ§in tÄ±kla.").replace(/'/g, "\\'");
                    const safeLink = d.link ? d.link.replace(/'/g, "\\'") : "yazi"; 
                    
                    let etiket = d.kategori ? `<span style="background:#e2e8f0; font-size:0.7rem; padding:2px 5px; border-radius:4px; margin-left:5px;">${d.kategori.toUpperCase()}</span>` : "";
                    let sinifEtiket = d.sinif ? `<span style="background:#d8b4fe; color:#581c87; font-size:0.7rem; padding:2px 5px; border-radius:4px; margin-left:5px;">${d.sinif}. SINIF</span>` : "";

                    html += `
                    <div class="item-card">
                        <div class="item-info" style="margin-bottom:10px;">${ikon} ${baslik} ${etiket} ${sinifEtiket}</div>
                        
                        <div class="btn-action-group">
                            ${(koleksiyon === 'projeler' || koleksiyon === 'yazilar') ? 
                              `<button onclick="vitrinYap('${safeBaslik}', '${safeAciklama}', '${safeLink}')" class="btn-mini btn-vitrin"><i class="fas fa-star"></i> Vitrin</button>` : ''}
                            
                            <button onclick="kayitSil('${koleksiyon}', '${doc.id}')" class="btn-mini btn-sil"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>`;
                });
                document.getElementById(divId).innerHTML = html || "<div style='text-align:center; color:#999;'>Veri yok.</div>";
            });
        }

        // --- DÄ°ÄER FONKSÄ°YONLAR (Vitrin, Silme vb.) ---
        function vitrinYap(baslik, aciklama, link) {
            if(!confirm("Bu iÃ§eriÄŸi Ana Sayfa'da 'HaftanÄ±n YÄ±ldÄ±zÄ±' yapmak istiyor musun?")) return;
            let url = link; if(link === 'yazi') url = 'index.html#kaynak-alani'; 
            db.collection("site_ayarlari").doc("haftanin_oyunu").set({
                baslik: baslik, metin: aciklama, url: url, tarih: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => gosterMesaj("âœ… Ana Sayfa Vitrini GÃ¼ncellendi!", "success"));
        }

        function kayitSil(col, id) { if(confirm("Silmek istiyor musun?")) db.collection(col).doc(id).delete().then(()=> gosterMesaj("Silindi", "success")); }
        function resetForm(id) { document.querySelectorAll('#'+id+' input, #'+id+' textarea').forEach(i=>i.value=""); gosterMesaj("BaÅŸarÄ±yla Kaydedildi!", "success"); }
        function gosterMesaj(m, t) { const k = document.getElementById('mesaj-kutusu'); k.innerText=m; k.className="message "+t; k.style.display="block"; setTimeout(()=>k.style.display="none", 3000); }

        listeGetir("projeler", "list-projeler", "ğŸ®");
        listeGetir("yazilar", "list-yazilar", "ğŸ“");
        listeGetir("duyurular", "list-duyurular", "ğŸ“¢");

        // Mesajlar
        db.collection("iletisim_talepleri").orderBy("tarih", "desc").onSnapshot(snap => {
            let html = "";
            snap.forEach(doc => {
                const v = doc.data();
                html += `<div class="item-card" style="border-left:5px solid #FFD700;"><div style="font-weight:bold;">${v.ad_soyad}</div><div style="font-size:0.9rem; margin:5px 0;">${v.konu}</div><div style="display:flex; gap:10px;"><a href="https://wa.me/90${v.telefon.replace(/\D/g,'')}" target="_blank" class="btn-mini" style="background:#25D366; color:white; text-decoration:none; flex:1;">WhatsApp</a><button onclick="kayitSil('iletisim_talepleri', '${doc.id}')" class="btn-mini btn-sil">Sil</button></div></div>`;
            });
            document.getElementById('mesaj-listesi').innerHTML = html || "Mesaj yok.";
        });
    </script>
</body>
</html>
