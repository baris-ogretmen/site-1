<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kokpit | BarÄ±ÅŸ Ä°lkan</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="firebase-config.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f1f5f9; margin: 0; padding: 0; color:#334155; }
        
        /* GÄ°RÄ°Å EKRANI */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #1e293b, #0f172a); display: flex; justify-content: center; align-items: center; z-index: 2000; }
        .login-box { background: white; padding: 40px; border-radius: 20px; width: 320px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .login-input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; }
        .login-btn { width: 100%; padding: 12px; background: #2563eb; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .error-msg { color: red; font-size: 0.9rem; margin-top: 10px; display: none; }

        /* PANEL */
        #admin-panel { display: none; max-width: 850px; margin: 40px auto; padding: 0 20px; padding-bottom: 50px; }
        .header-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; background:white; padding:15px 25px; border-radius:15px; box-shadow:0 5px 15px rgba(0,0,0,0.05); }
        .logout-btn { background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight:bold; }

        .tab-buttons { display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; }
        .tab-btn { flex: 1; background: #e2e8f0; color: #64748b; border: none; padding: 12px; cursor: pointer; border-radius: 10px; font-weight: 700; transition:0.3s; position: relative; }
        .tab-btn.active { background: #2563eb; color: white; box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3); }
        
        .badge { background: #ef4444; color: white; padding: 2px 6px; border-radius: 50%; font-size: 0.75rem; position: absolute; top: -8px; right: -5px; display: none; }
        .has-message { animation: sariAlarm 1.5s infinite; font-weight: 900 !important; border: 2px solid #b45309 !important; }
        @keyframes sariAlarm { 0% { background: #e2e8f0; } 50% { background: #FFD700; color: black; } 100% { background: #e2e8f0; } }

        .panel-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; box-sizing: border-box; margin-bottom: 15px; font-family: inherit; }
        button.save-btn { width: 100%; padding: 12px; background: #10b981; color: white; border: none; border-radius: 10px; font-weight:bold; cursor: pointer; }
        
        /* AYARLAR KUTUSU */
        .settings-box { border: 2px dashed #cbd5e1; padding: 20px; border-radius: 15px; margin-bottom: 20px; background: #f8fafc; }
        .settings-title { font-weight: 900; color: #475569; margin-bottom: 15px; display: block; text-transform: uppercase; font-size: 0.9rem; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2>KOKPÄ°T GÄ°RÄ°ÅÄ°</h2>
            <input type="email" id="email" class="login-input" placeholder="E-posta">
            <input type="password" id="password" class="login-input" placeholder="Åifre">
            <button onclick="girisYap()" class="login-btn">GiriÅŸ Yap</button>
            <div id="hata-mesaji" class="error-msg">HatalÄ± GiriÅŸ!</div>
        </div>
    </div>

    <div id="admin-panel">
        <div class="header-bar">
            <h2 style="margin:0; color:#2563eb;">ğŸš€ Kokpit</h2>
            <button onclick="cikisYap()" class="logout-btn">Ã‡Ä±kÄ±ÅŸ</button>
        </div>

        <div class="tab-buttons">
            <button class="tab-btn active" id="btn-proje" onclick="tabDegis('proje')">Projeler</button>
            <button class="tab-btn" id="btn-duyuru" onclick="tabDegis('duyuru')">Duyurular</button>
            <button class="tab-btn" id="btn-ayarlar" onclick="tabDegis('ayarlar')">âš™ï¸ Ayarlar</button>
            <button class="tab-btn" id="btn-mesaj" onclick="tabDegis('mesaj')">Mesajlar <span id="msg-badge" class="badge">0</span></button>
        </div>

        <div id="ayarlar-formu" class="panel-card" style="display:none;">
            
            <div class="settings-box">
                <span class="settings-title">ğŸ¤– Robot Beyni (Yapay Zeka)</span>
                <label>API AnahtarÄ± (Bitince buradan deÄŸiÅŸtir):</label>
                <input type="text" id="set-api" placeholder="AIzaSy...">
                
                <label>Robot TalimatÄ± (KiÅŸiliÄŸi):</label>
                <textarea id="set-prompt" rows="3" placeholder="Ã–rn: Sen neÅŸeli bir Ã¶ÄŸretmensin..."></textarea>
                <button onclick="robotAyarlariniKaydet()" class="save-btn" style="background:#2563eb;">Robotu GÃ¼ncelle</button>
            </div>

            <div class="settings-box" style="background:#fff7ed; border-color:#fdba74;">
                <span class="settings-title">ğŸ”´ SÃ¼rpriz Daire (SaÄŸ Alt)</span>
                <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px;">
                    <input type="checkbox" id="set-circle-active" style="width:20px; height:20px;">
                    <label style="font-weight:bold;">Daire GÃ¶rÃ¼nsÃ¼n mÃ¼?</label>
                </div>
                <input type="text" id="set-circle-text" placeholder="Daire Ä°Ã§indeki YazÄ± (Ã–rn: LGS KAMP)">
                <input type="text" id="set-circle-msg" placeholder="TÄ±klayÄ±nca Ã‡Ä±kan Mesaj">
                <input type="text" id="set-circle-link" placeholder="YÃ¶nleneceÄŸi Link (BoÅŸ bÄ±rakÄ±rsan sadece mesaj verir)">
                <button onclick="daireAyarlariniKaydet()" class="save-btn" style="background:#ea580c;">Daireyi GÃ¼ncelle</button>
            </div>

        </div>

        <div id="proje-formu" class="panel-card">
            <h3>Yeni Ä°Ã§erik Ekle</h3>
            <input type="text" id="p-baslik" placeholder="BaÅŸlÄ±k">
            <input type="text" id="p-link" placeholder="Link">
            <select id="p-kategori">
                <option value="Ortaokul">ğŸ“š Ortaokul</option><option value="LGS KoÃ§luk">ğŸ¯ KoÃ§luk</option>
                <option value="AkÄ±l Zeka">ğŸ§  AkÄ±l Zeka</option><option value="Robotik">ğŸ¤– Robotik</option>
            </select>
            <select id="p-icon"><option value="fa-gamepad">Oyun</option><option value="fa-book">Kitap</option></select>
            <button onclick="projeEkle()" class="save-btn">Kaydet</button>
            <div id="list-projeler" style="margin-top:20px;"></div>
        </div>

        <div id="duyuru-formu" class="panel-card" style="display:none;">
            <h3>Yeni Duyuru</h3>
            <input type="text" id="d-metin" placeholder="Duyuru metni...">
            <button onclick="duyuruEkle()" class="save-btn">YayÄ±nla</button>
            <div id="list-duyurular" style="margin-top:20px;"></div>
        </div>

        <div id="mesaj-formu" class="panel-card" style="display:none;">
            <h3>Gelen Mesajlar</h3>
            <div id="mesaj-listesi"></div>
        </div>

    </div>
    
    <script>
        const auth = firebase.auth();
        const db = firebase.firestore();

        // GÃœVENLÄ°K
        function girisYap() {
            auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('password').value)
            .catch(() => document.getElementById('hata-mesaji').style.display='block');
        }
        function cikisYap() { auth.signOut().then(()=>location.reload()); }
        auth.onAuthStateChanged(u => {
            if(u && !u.isAnonymous) {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                ayarlariYukle(); // Panel aÃ§Ä±lÄ±nca ayarlarÄ± Ã§ek
            } else {
                document.getElementById('login-screen').style.display = 'flex';
                document.getElementById('admin-panel').style.display = 'none';
                if(u && u.isAnonymous) auth.signOut();
            }
        });

        // SEKME GEÃ‡Ä°ÅÄ°
        function tabDegis(tip) {
            document.querySelectorAll('.panel-card').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tip + '-formu').style.display = 'block';
            if(tip !== 'mesaj') document.getElementById('btn-' + tip).classList.add('active');
        }

        // --- AYAR YÃ–NETÄ°MÄ° (YENÄ°) ---
        function ayarlariYukle() {
            // Robot AyarlarÄ±nÄ± Ã‡ek
            db.collection("site_ayarlari").doc("robot").get().then(doc => {
                if(doc.exists) {
                    document.getElementById('set-api').value = doc.data().apiKey || "";
                    document.getElementById('set-prompt').value = doc.data().prompt || "";
                }
            });
            // Daire AyarlarÄ±nÄ± Ã‡ek
            db.collection("site_ayarlari").doc("ozel_duyuru").get().then(doc => {
                if(doc.exists) {
                    document.getElementById('set-circle-active').checked = doc.data().aktif;
                    document.getElementById('set-circle-text').value = doc.data().daireMetni || "";
                    document.getElementById('set-circle-msg').value = doc.data().mesaj || "";
                    document.getElementById('set-circle-link').value = doc.data().link || "";
                }
            });
        }

        function robotAyarlariniKaydet() {
            db.collection("site_ayarlari").doc("robot").set({
                apiKey: document.getElementById('set-api').value,
                prompt: document.getElementById('set-prompt').value
            }, {merge: true}).then(() => alert("âœ… Robot AyarlarÄ± Kaydedildi!"));
        }

        function daireAyarlariniKaydet() {
            db.collection("site_ayarlari").doc("ozel_duyuru").set({
                aktif: document.getElementById('set-circle-active').checked,
                daireMetni: document.getElementById('set-circle-text').value,
                mesaj: document.getElementById('set-circle-msg').value,
                link: document.getElementById('set-circle-link').value
            }, {merge: true}).then(() => alert("âœ… Daire AyarlarÄ± Kaydedildi!"));
        }

        // --- DÄ°ÄER FONKSÄ°YONLAR (STANDART) ---
        function projeEkle() {
            const b = document.getElementById('p-baslik').value; const l = document.getElementById('p-link').value;
            if(!b || !l) return alert("Eksik bilgi.");
            db.collection("projeler").add({ baslik: b, link: l, kategori: document.getElementById('p-kategori').value, icon: document.getElementById('p-icon').value, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>alert("Eklendi"));
        }
        function duyuruEkle() {
            const m = document.getElementById('d-metin').value; if(!m) return;
            db.collection("duyurular").add({ metin: m, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>alert("Duyuru YayÄ±nda"));
        }

        // LÄ°STELEME VE MESAJLAR
        db.collection("iletisim_talepleri").orderBy("tarih", "desc").onSnapshot(snap => {
            let html = ""; let sayi = snap.size;
            if(sayi > 0) { document.getElementById('btn-mesaj').classList.add('has-message'); document.getElementById('msg-badge').style.display='inline-block'; document.getElementById('msg-badge').innerText=sayi; }
            snap.forEach(doc => { const v=doc.data(); html += `<div style="background:#f8fafc; padding:10px; margin-bottom:5px; border-left:4px solid gold;"><strong>${v.ad_soyad}</strong>: ${v.konu} <button onclick="db.collection('iletisim_talepleri').doc('${doc.id}').delete()">Sil</button></div>`; });
            document.getElementById('mesaj-listesi').innerHTML = html;
        });
    </script>
</body>
</html>
