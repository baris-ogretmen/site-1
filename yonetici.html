<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YÃ¶netici Paneli v40.3 (Fix) | BarÄ±ÅŸ Ä°lkan</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="firebase-config.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root { --ana: #6366f1; --koyu: #1e293b; --acik: #f1f5f9; }
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--acik); margin: 0; display: flex; height: 100vh; overflow: hidden; }

        /* TOAST BÄ°LDÄ°RÄ°M (En Ãœst Katman) */
        #toast-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 99999; display: flex; flex-direction: column; gap: 10px; width: 90%; max-width: 400px; pointer-events: none; }
        .toast { background: #10b981; color: white; padding: 15px 25px; border-radius: 50px; font-weight: bold; box-shadow: 0 10px 30px rgba(0,0,0,0.4); animation: slideUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); display: flex; align-items: center; gap: 15px; border: 2px solid white; font-size: 1rem; text-align: center; justify-content: center; pointer-events: auto; }
        @keyframes slideUp { from { transform: translateY(50px) scale(0.8); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }

        /* GÄ°RÄ°Å */
        #login-screen { position: fixed; inset: 0; background: linear-gradient(135deg, #1e293b, #0f172a); z-index: 9999; display: flex; align-items: center; justify-content: center; }
        .login-box { background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 350px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.5); }

        /* MOBÄ°L BUTON */
        #mobile-toggle-btn { display: none; position: fixed; top: 15px; left: 15px; z-index: 2000; background: var(--ana); color: white; border: none; padding: 10px 15px; border-radius: 8px; font-size: 1.2rem; cursor: pointer; }

        /* SIDEBAR */
        .sidebar { width: 260px; background: var(--koyu); color: white; display: flex; flex-direction: column; padding: 20px; box-shadow: 5px 0 15px rgba(0,0,0,0.05); overflow-y: auto; z-index: 1000; transition: transform 0.3s ease; }
        .sidebar h2 { margin: 0 0 20px 0; font-size: 1.4rem; color: #fbbf24; text-align: center; border-bottom: 1px solid #334155; padding-bottom: 15px; }
        .menu-btn { background: none; border: none; color: #cbd5e1; text-align: left; padding: 15px; font-size: 1rem; cursor: pointer; transition: 0.2s; border-radius: 10px; margin-bottom: 8px; display: flex; align-items: center; gap: 12px; text-decoration: none; width: 100%; font-weight: 600; }
        .menu-btn:hover, .menu-btn.active { background: var(--ana); color: white; transform: translateX(5px); }

        /* Ä°Ã‡ERÄ°K */
        .main-content { flex: 1; padding: 20px; overflow-y: auto; background: #f8fafc; position: relative; padding-top: 20px; }
        .panel-section { display: none; animation: fadeIn 0.3s; }
        .panel-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* KART */
        .card { background: white; padding: 20px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #e2e8f0; }
        h3 { color: var(--koyu); margin-top: 0; border-bottom: 2px solid #e2e8f0; padding-bottom: 10px; margin-bottom: 20px; font-size: 1.2rem; }
        .inp, select, textarea { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 12px; font-size: 1rem; margin-bottom: 15px; font-family: inherit; background: white; transition: 0.3s; }
        .inp:focus { border-color: var(--ana); box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); outline: none; }
        
        .btn { width: 100%; padding: 14px; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; transition: 0.2s; color: white; font-size: 1rem; margin-bottom: 5px; text-align: center; }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: linear-gradient(135deg, #6366f1, #4f46e5); }
        .btn-success { background: linear-gradient(135deg, #10b981, #059669); }
        .btn-danger { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .btn-warning { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
        .btn-info { background: linear-gradient(135deg, #3b82f6, #2563eb); }
        .btn-wa { background: #25D366; } 

        /* Ä°STATÄ°STÄ°K */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { text-align:center; padding:20px; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); color:white; }
        .stat-blue { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .stat-red { background: linear-gradient(135deg, #ef4444, #b91c1c); }
        .stat-purple { background: linear-gradient(135deg, #8b5cf6, #6d28d9); }
        .stat-val { font-size: 2.5rem; font-weight: 800; margin-top: 10px; }

        /* LÄ°STE TASARIMI (GeliÅŸmiÅŸ) */
        .list-item { background: white; padding: 15px; border-radius: 15px; margin-bottom: 10px; border-left: 5px solid var(--ana); box-shadow: 0 4px 6px rgba(0,0,0,0.05); display: flex; flex-direction: column; gap: 10px; border: 1px solid #f1f5f9; }
        .action-btns { display: flex; gap: 8px; flex-wrap: wrap; margin-top: 5px; }
        .btn-mini { padding: 8px 15px; border-radius: 8px; font-size: 0.85rem; cursor: pointer; border: none; color: white; font-weight: bold; flex: 1; min-width: 90px; text-align:center; display: flex; align-items: center; justify-content: center; gap: 5px; text-decoration: none; box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: 0.2s; }
        .btn-mini:hover { transform: translateY(-2px); opacity: 0.9; }
        
        .bg-vitrin { background: #f59e0b; } .bg-buton { background: #ef4444; } .bg-sil { background: #64748b; } .bg-sil:hover { background: #dc2626; } 
        .bg-cevap { background: #10b981; } .bg-paylas { background: #25D366; } .bg-gozat { background: #0ea5e9; }

        /* BUTON Ã–NÄ°ZLEME (Åekil DÃ¼zeltmeleri) */
        #preview-box { width: 100%; height: 160px; background: #e2e8f0; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 15px; margin-bottom: 20px; border: 2px dashed #cbd5e1; }
        .demo-btn { width: 100px; height: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; font-weight: bold; cursor: pointer; text-decoration: none; border: none; transition: all 0.3s; box-shadow: 0 10px 20px rgba(0,0,0,0.3); z-index: 5; }
        
        .shape-circle { border-radius: 50%; } 
        .shape-square { border-radius: 15px; } 
        .shape-leaf { border-radius: 50% 0 50% 50%; }
        .shape-msg { border-radius: 40px 40px 40px 0px; }
        .shape-blob { border-radius: 30% 70% 70% 30% / 30% 30% 70% 70%; }
        /* Åekillerin Panelde de dÃ¼zgÃ¼n gÃ¶rÃ¼nmesi iÃ§in */
        .shape-star { clip-path: polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%); border-radius: 0 !important; width: 110px !important; height: 110px !important; }
        .shape-hex { clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%); border-radius: 0 !important; width: 120px !important; }

        .anim-pulse { animation: pulse 1.5s infinite; } 
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        @media (max-width: 768px) {
            .sidebar { position: fixed; left: -270px; top: 0; bottom: 0; transition: 0.3s; }
            .sidebar.show { left: 0; }
            #mobile-toggle-btn { display: block; }
            .main-content { padding-top: 60px; }
            .stats-grid { grid-template-columns: 1fr; }
            .action-btns { flex-direction: row; } 
        }
    </style>
</head>
<body>

    <div id="toast-container"></div>

    <div id="login-screen">
        <div class="login-box">
            <h2 style="color:#6366f1;">YÃ¶netici GiriÅŸi</h2>
            <input type="email" id="email" class="inp" placeholder="E-posta">
            <input type="password" id="password" class="inp" placeholder="Åifre">
            <button onclick="girisYap()" class="btn btn-primary">GiriÅŸ Yap</button>
        </div>
    </div>

    <button id="mobile-toggle-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>

    <div style="display:flex; width:100%; height:100%;">
        
        <div class="sidebar" id="sidebar">
            <h2>BarÄ±ÅŸ Hoca<br><small style="font-size:0.8rem; color:#94a3b8;">v40.3 (Fix)</small></h2>
            <button class="menu-btn active" onclick="showSection('ozet')"><i class="fas fa-chart-pie"></i> Ã–zet</button>
            <button class="menu-btn" onclick="showSection('sihirbaz')"><i class="fas fa-magic"></i> Ä°Ã§erik Ekle</button>
            <button class="menu-btn" onclick="showSection('yazi-yonetimi')"><i class="fas fa-feather-alt"></i> KÃ¶ÅŸe YazÄ±larÄ±</button>
            <button class="menu-btn" onclick="showSection('kitap-ekle')"><i class="fas fa-book"></i> Kitap YÃ¶netimi</button>
            <button class="menu-btn" onclick="showSection('mesajlar')"><i class="fas fa-envelope"></i> Mesajlar</button>
            <button class="menu-btn" onclick="showSection('duyuru-tavsiye')"><i class="fas fa-bullhorn"></i> Duyuru & Tavsiye</button>
            <button class="menu-btn" onclick="showSection('ayarlar')"><i class="fas fa-cog"></i> Ayarlar & Buton</button>
            <div style="margin-top:auto;">
                <button onclick="if(confirm('Ã‡Ä±kÄ±ÅŸ?')) auth.signOut()" class="menu-btn" style="color:#ef4444;"><i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ</button>
            </div>
        </div>

        <div class="main-content" onclick="if(window.innerWidth<=768) document.getElementById('sidebar').classList.remove('show')">

            <div id="ozet" class="panel-section active">
                <h3>ğŸ“Š Ä°statistikler</h3>
                <div class="stats-grid">
                    <div class="stat-card stat-blue"><div>BugÃ¼n</div><div class="stat-val" id="stat-today">0</div></div>
                    <div class="stat-card stat-red"><div>Bu Ay</div><div class="stat-val" id="stat-month">0</div></div>
                    <div class="stat-card stat-purple"><div>Toplam</div><div class="stat-val" id="stat-total">0</div></div>
                </div>
                
                <div class="card">
                    <h3>âš¡ HÄ±zlÄ± Ä°Ã§erik YÃ¶netimi</h3>
                    <input type="text" id="search-content" class="inp" placeholder="Ä°Ã§erik ara (TÃ¼m Site)..." onkeyup="icerikFiltrele()">
                    <div id="tum-icerik-listesi">
                        <div style="text-align:center; padding:15px; color:#666;">Veriler YÃ¼kleniyor...</div>
                    </div>
                </div>
            </div>

            <div id="sihirbaz" class="panel-section">
                <div class="card">
                    <h3>ğŸª„ Yeni Ä°Ã§erik Ekle</h3>
                    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:15px;">
                        <label><input type="radio" name="tur" value="projeler" checked onchange="formuGuncelle()"> ğŸ® Oyun</label>
                        <label><input type="radio" name="tur" value="videolar" onchange="formuGuncelle()"> ğŸ¥ Video</label>
                        <label><input type="radio" name="tur" value="kaynaklar" onchange="formuGuncelle()"> ğŸ“š PDF</label>
                        <label><input type="radio" name="tur" value="yazilar" onchange="formuGuncelle()"> ğŸ“ KÃ¶ÅŸe YazÄ±sÄ±</label>
                    </div>
                    <input type="text" id="p-baslik" class="inp" placeholder="BaÅŸlÄ±k">
                    <input type="text" id="p-aciklama" class="inp" placeholder="KÄ±sa AÃ§Ä±klama (Ã–rn: Dikkat ve hafÄ±za oyunu)">
                    <input type="text" id="p-link" class="inp" placeholder="Link / Dosya AdÄ± / Video URL">
                    <div id="area-yazi" style="display:none;"><label>YazÄ± Ä°Ã§eriÄŸi (HTML)</label><textarea id="p-icerik" class="inp" rows="10"></textarea></div>
                    <div id="area-detay">
                        <label>Ä°kon & Kategori SeÃ§ (Opsiyonel)</label>
                        <input type="hidden" id="p-selected-icon" value="fa-gamepad">
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                            <label><input type="checkbox" id="is-vitrin" checked> Vitrine Ekle</label>
                        </div>
                    </div>
                    <button onclick="icerikKaydet()" class="btn btn-success" style="margin-top:10px;">KAYDET</button>
                </div>
            </div>

            <div id="yazi-yonetimi" class="panel-section">
                <div class="card"><h3>âœï¸ KÃ¶ÅŸe YazÄ±larÄ± Listesi</h3><div id="ozel-yazi-listesi">YÃ¼kleniyor...</div></div>
            </div>

            <div id="kitap-ekle" class="panel-section">
                <div class="card"><h3>ğŸ“š Kitap Ekle</h3>
                    <input type="text" id="k-baslik" class="inp" placeholder="Kitap AdÄ±"><input type="text" id="k-link" class="inp" placeholder="Link">
                    <button onclick="kitapKaydet()" class="btn btn-primary">EKLE</button>
                </div>
                <div class="card"><h3>ğŸ“– Kitap Listesi</h3><div id="kitap-listesi"></div></div>
            </div>

            <div id="mesajlar" class="panel-section">
                <div class="card"><h3>ğŸ“© Gelen Mesajlar</h3><div id="mesaj-listesi">YÃ¼kleniyor...</div></div>
            </div>

            <div id="duyuru-tavsiye" class="panel-section">
                <div class="card"><h3>ğŸ“¢ Duyuru Ekle</h3><input type="text" id="d-metin" class="inp" placeholder="Duyuru..."><button onclick="duyuruEkle()" class="btn btn-primary">Ekle</button><div id="list-duyurular" style="margin-top:10px;"></div></div>
                <div class="card"><h3>â­ Tavsiye Ekle</h3><input type="text" id="t-baslik" class="inp" placeholder="BaÅŸlÄ±k"><input type="text" id="t-link" class="inp" placeholder="Link"><button onclick="tavsiyeEkle()" class="btn btn-success">Ekle</button><div id="list-tavsiyeler" style="margin-top:10px;"></div></div>
            </div>

            <div id="ayarlar" class="panel-section">
                <div class="card" style="border:2px solid #fcd34d;">
                    <h3>ğŸ”´ Acil Buton AyarlarÄ±</h3>
                    <div id="preview-box">
                        <button id="demo-btn" class="demo-btn" onclick="testLink()"><i id="demo-icon" class="fas fa-play" style="font-size:1.5rem;"></i><span id="demo-text">YENÄ°</span></button>
                    </div>
                    <label><input type="checkbox" id="set-active"> Buton Aktif</label>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                        <select id="set-shape" class="inp" onchange="updateButtonPreview()">
                            <option value="shape-circle">Yuvarlak</option><option value="shape-square">Kare</option><option value="shape-leaf">Yaprak</option><option value="shape-msg">Mesaj Balonu</option><option value="shape-blob">Damla</option><option value="shape-star">YÄ±ldÄ±z</option><option value="shape-hex">AltÄ±gen</option>
                        </select>
                        <select id="set-color" class="inp" onchange="updateButtonPreview()">
                            <option value="linear-gradient(135deg, #ef4444, #b91c1c)">KÄ±rmÄ±zÄ±</option><option value="linear-gradient(135deg, #f59e0b, #d97706)">Turuncu</option><option value="linear-gradient(135deg, #3b82f6, #1d4ed8)">Mavi</option><option value="linear-gradient(135deg, #10b981, #059669)">YeÅŸil</option><option value="linear-gradient(135deg, #8b5cf6, #6d28d9)">Mor</option>
                        </select>
                    </div>
                    <label>Link ve Metin</label>
                    <input type="text" id="set-media" class="inp" placeholder="Link...">
                    <input type="text" id="set-text" class="inp" value="YENÄ°" onkeyup="updateButtonPreview()">
                    <input type="text" id="set-msg" class="inp" placeholder="Balon MesajÄ± (Opsiyonel)">
                    <button onclick="daireKaydet()" class="btn btn-warning">AYARLARI KAYDET</button>
                </div>
                <div class="card"><h3>ğŸ¤– Robot Asistan</h3><input type="text" id="api-key" class="inp" placeholder="API Key"><textarea id="robot-prompt" class="inp" placeholder="Prompt..."></textarea><button onclick="robotKaydet()" class="btn btn-primary">Robotu GÃ¼ncelle</button></div>
            </div>
        </div>
    </div>

    <script>
        const auth = firebase.auth();
        const db = firebase.firestore();
        let tumIceriklerCache = [];

        function showToast(msg) {
            const c = document.getElementById('toast-container');
            const t = document.createElement('div');
            t.className = 'toast';
            t.innerHTML = `<i class="fas fa-check-circle"></i> ${msg}`;
            c.appendChild(t);
            setTimeout(() => { t.style.opacity='0'; setTimeout(()=>t.remove(), 400); }, 3000);
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('show'); }
        function girisYap() { const e=document.getElementById('email').value; const p=document.getElementById('password').value; auth.signInWithEmailAndPassword(e,p).catch(err=>alert(err.message)); }
        auth.onAuthStateChanged(user => { if(user){ document.getElementById('login-screen').style.display='none'; verileriYukle(); istatistikGetir(); mesajlariGetir(); } else document.getElementById('login-screen').style.display='flex'; });
        function showSection(id) { document.querySelectorAll('.panel-section').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); if(window.innerWidth<=768) toggleSidebar(); if(id==='kitap-ekle') kitaplariGetir(); if(id==='yazi-yonetimi') yazilariGetirOzel(); }
        function formuGuncelle() { const tur=document.querySelector('input[name="tur"]:checked').value; document.getElementById('area-detay').style.display=tur==='yazilar'?'none':'block'; document.getElementById('area-yazi').style.display=tur==='yazilar'?'block':'none'; }

        async function icerikKaydet() {
            const baslik = document.getElementById('p-baslik').value;
            const tur = document.querySelector('input[name="tur"]:checked').value;
            if(!baslik) return alert("BaÅŸlÄ±k girin!");
            const batch = db.batch();
            const ref = tur === 'yazilar' ? db.collection('yazilar').doc() : db.collection(tur).doc();
            let data = { baslik, tarih: firebase.firestore.FieldValue.serverTimestamp() };
            if(tur === 'yazilar') { data.icerik = document.getElementById('p-icerik').value; }
            else { data.link = document.getElementById('p-link').value; data.aciklama = document.getElementById('p-aciklama').value; data.vitrin = document.getElementById('is-vitrin').checked; data.kategori="Genel"; data.icon="fa-gamepad"; }
            batch.set(ref, data);
            batch.commit().then(() => { showToast("âœ… Ä°Ã§erik Eklendi!"); verileriYukle(); if(tur==='yazilar') yazilariGetirOzel(); });
        }

        function verileriYukle() {
            tumIceriklerCache = [];
            const load = (col, type) => {
                db.collection(col).get().then(snap => {
                    snap.forEach(d => tumIceriklerCache.push({ id:d.id, col, type, ...d.data() }));
                    renderList();
                });
            };
            load("projeler","OYUN"); load("videolar","VÄ°DEO"); load("kaynaklar","PDF");
            
            db.collection("kitaplar").orderBy("sira","desc").get().then(snap=>{ let h=""; snap.forEach(d=>{ const k=d.data(); h+=createRow(k.baslik, d.id, 'kitaplar', k.link, 'KÄ°TAP'); }); document.getElementById('kitap-listesi').innerHTML=h; });
            db.collection("tavsiyeler").orderBy("tarih","desc").onSnapshot(s=>{ let h=""; s.forEach(d=>{ const t=d.data(); h+=createRow(t.baslik, d.id, 'tavsiyeler', t.link, 'TAVSÄ°YE'); }); document.getElementById('list-tavsiyeler').innerHTML=h; });
            db.collection("duyurular").onSnapshot(s=>{ let h=""; s.forEach(d=>h+=`<div class="list-item">${d.data().metin} <button class="btn-mini bg-sil" onclick="sil('duyurular','${d.id}')">Sil</button></div>`); document.getElementById('list-duyurular').innerHTML=h; });
            db.collection("site_ayarlari").doc("ozel_duyuru").get().then(d=>{ if(d.exists) { const v=d.data(); document.getElementById('set-active').checked=v.aktif; document.getElementById('set-text').value=v.daireMetni; document.getElementById('set-media').value=v.link; updateButtonPreview(); } });
            db.collection("site_ayarlari").doc("robot").get().then(d=>{ if(d.exists) { document.getElementById('api-key').value=d.data().apiKey; document.getElementById('robot-prompt').value=d.data().prompt; } });
        }

        function yazilariGetirOzel() {
            db.collection("yazilar").orderBy("tarih","desc").get().then(snap=>{
                let h=""; snap.forEach(d=>{ const y=d.data(); const link="https://baris-ogretmen.github.io/site-1/"; h+=createRow(y.baslik, d.id, 'yazilar', link, 'YAZI'); });
                document.getElementById('ozel-yazi-listesi').innerHTML=h || 'YazÄ± yok.';
            });
        }

        function createRow(baslik, id, col, link, tur) {
            const shareLink = `https://wa.me/?text=${encodeURIComponent(baslik + " " + link)}`;
            return `<div class="list-item">
                <div style="flex:1;"><b>${baslik}</b> <span style="font-size:0.7rem; background:#e0e7ff; padding:2px 5px; border-radius:4px;">${tur}</span></div>
                <div class="action-btns">
                    <a href="${shareLink}" target="_blank" class="btn-mini bg-paylas"><i class="fab fa-whatsapp"></i> PaylaÅŸ</a>
                    <button class="btn-mini bg-vitrin" onclick="vitrinYap('${col}','${id}','${baslik}','${link}')">â­ Vitrin</button>
                    <button class="btn-mini bg-buton" onclick="daireYap('${baslik}','${link}')">â­• Buton</button>
                    <button class="btn-mini bg-sil" onclick="sil('${col}','${id}')">ğŸ—‘ Sil</button>
                </div>
            </div>`;
        }

        function renderList() {
            tumIceriklerCache.sort((a,b)=>(b.tarih?.seconds||0)-(a.tarih?.seconds||0));
            let h="";
            tumIceriklerCache.forEach(i => {
                let fullLink = i.link && !i.link.startsWith('http') ? window.location.href.substring(0, window.location.href.lastIndexOf('/')+1)+i.link : i.link;
                h += createRow(i.baslik, i.id, i.col, fullLink, i.type);
            });
            document.getElementById('tum-icerik-listesi').innerHTML = h || 'Ä°Ã§erik yok.';
        }

        function vitrinYap(col, id, baslik, link) {
            db.collection("site_ayarlari").doc("haftanin_oyunu").set({ baslik, url: link }).then(() => showToast("â­ Vitrine Eklendi!"));
        }
        function daireYap(baslik, link) {
            document.getElementById('set-text').value="YENÄ°"; document.getElementById('set-media').value=link; document.getElementById('set-msg').value=baslik;
            showToast("â­• Ayarlara Ã‡ekildi (Kaydet'e bas!)"); updateButtonPreview();
        }
        function daireKaydet() {
            db.collection("site_ayarlari").doc("ozel_duyuru").set({
                aktif: document.getElementById('set-active').checked, daireMetni: document.getElementById('set-text').value,
                link: document.getElementById('set-media').value, renk: document.getElementById('set-color').value,
                sekil: document.getElementById('set-shape').value, mesaj: document.getElementById('set-msg').value, anim: "anim-pulse"
            }).then(()=>showToast("âœ… Buton Kaydedildi!"));
        }
        function sil(col, id) { if(confirm("Silinecek?")) db.collection(col).doc(id).delete().then(()=>{ showToast("ğŸ—‘ Silindi"); verileriYukle(); if(col==='yazilar') yazilariGetirOzel(); }); }
        
        function kitapKaydet() { db.collection("kitaplar").add({ baslik:document.getElementById('k-baslik').value, link:document.getElementById('k-link').value, sira:1, tarih:firebase.firestore.FieldValue.serverTimestamp() }).then(()=>{showToast("Kitap Eklendi"); kitaplariGetir();}); }
        function kitaplariGetir() { db.collection("kitaplar").orderBy("sira","desc").get().then(snap=>{ let h=""; snap.forEach(d=>{const k=d.data(); h+=createRow(k.baslik,d.id,'kitaplar',k.link,'KÄ°TAP')}); document.getElementById('kitap-listesi').innerHTML=h; }); }
        function duyuruEkle() { db.collection("duyurular").add({ metin: document.getElementById('d-metin').value, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>showToast("Duyuru Eklendi")); }
        function tavsiyeEkle() { db.collection("tavsiyeler").add({ baslik: document.getElementById('t-baslik').value, link: document.getElementById('t-link').value, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>showToast("Tavsiye Eklendi")); }
        function robotKaydet() { db.collection("site_ayarlari").doc("robot").set({ apiKey: document.getElementById('api-key').value, prompt: document.getElementById('robot-prompt').value }, {merge:true}).then(()=>showToast("Robot AyarlandÄ±")); }
        function updateButtonPreview() { const btn=document.getElementById('demo-btn'); btn.style.background=document.getElementById('set-color').value; btn.className=`demo-btn ${document.getElementById('set-shape').value} anim-pulse`; document.getElementById('demo-text').innerText=document.getElementById('set-text').value; }
        function testLink() { window.open(document.getElementById('set-media').value, '_blank'); }
        function icerikFiltrele() { const v=document.getElementById('search-content').value.toLowerCase(); document.querySelectorAll('#tum-icerik-listesi .list-item').forEach(i=>i.style.display=i.innerText.toLowerCase().includes(v)?'flex':'none'); }
        
        function istatistikGetir() {
            db.collection("istatistik").get().then(snap => {
                let g=0, a=0, t=0; const bugun=new Date().toISOString().split('T')[0]; const ay=bugun.substring(0,7);
                snap.forEach(d => { const s=d.data().ziyaret||0; t+=s; if(d.id.startsWith(ay)) a+=s; if(d.id===bugun) g=s; });
                document.getElementById('stat-today').innerText=g; document.getElementById('stat-month').innerText=a; document.getElementById('stat-total').innerText=t;
            });
        }
        function mesajlariGetir() {
            db.collection("iletisim_talepleri").orderBy("tarih","desc").onSnapshot(s=>{
                let h=""; document.getElementById('msg-badge').innerText=s.size; document.getElementById('msg-badge').style.display=s.size>0?'inline':'none';
                s.forEach(d=>{ const m=d.data(); let btn = m.email ? `<a href="mailto:${m.email}" class="btn-mini bg-cevap">âœ‰ï¸ Mail</a>` : `<a href="https://wa.me/${m.telefon}" class="btn-mini bg-wa">ğŸ“ WA</a>`;
                h+=`<div class="list-item"><div><b>${m.ad_soyad}</b><br><small>${m.konu}</small></div><div class="action-btns">${btn}<button class="btn-mini bg-sil" onclick="sil('iletisim_talepleri','${d.id}')">Sil</button></div></div>`; });
                document.getElementById('mesaj-listesi').innerHTML=h;
            });
        }
    </script>
</body>
</html>
