<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kokpit | BarÄ±ÅŸ Ä°lkan</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f1f5f9; margin: 0; padding: 0; color:#334155; }
        
        /* GÄ°RÄ°Å EKRANI */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #1e293b, #0f172a); display: flex; justify-content: center; align-items: center; z-index: 2000; }
        .login-box { background: white; padding: 40px; border-radius: 20px; width: 320px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .login-input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; }
        .login-btn { width: 100%; padding: 12px; background: #2563eb; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        
        /* PANEL GENEL */
        #admin-panel { display: none; max-width: 950px; margin: 40px auto; padding: 0 20px; padding-bottom: 50px; }
        .header-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; background:white; padding:20px; border-radius:15px; box-shadow:0 5px 15px rgba(0,0,0,0.05); }
        .logout-btn { background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight:bold; }
        .stat-card { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 25px; box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3); }
        .stat-number { font-size: 3rem; font-weight: 900; margin: 10px 0; line-height: 1; }

        /* TAB BUTONLARI */
        .tab-buttons { display: flex; gap: 10px; margin-bottom: 25px; flex-wrap: wrap; }
        .tab-btn { flex: 1; background: #e2e8f0; color: #64748b; border: none; padding: 12px; cursor: pointer; border-radius: 10px; font-weight: 700; transition:0.3s; position: relative; white-space: nowrap; }
        .tab-btn.active { background: #2563eb; color: white; box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3); }
        
        /* KIRMIZI BÄ°LDÄ°RÄ°M BALONU */
        .badge {
            position: absolute; top: -8px; right: -8px;
            background: #ef4444; color: white; 
            font-size: 0.75rem; padding: 4px 8px; border-radius: 50%;
            border: 2px solid white; display: none; animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes pop { from { transform: scale(0); } to { transform: scale(1); } }

        .panel-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 25px; }
        input, select, textarea { width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; box-sizing: border-box; margin-bottom: 15px; font-family: inherit; }
        button.save-btn { width: 100%; padding: 12px; background: #10b981; color: white; border: none; border-radius: 10px; font-weight:bold; cursor: pointer; }
        
        /* LÄ°STE ELEMANLARI */
        .list-item { display: flex; flex-direction: column; padding: 15px; border-bottom: 1px solid #eee; background: #f8fafc; margin-bottom: 10px; border-radius: 10px; border-left: 5px solid #cbd5e1; }
        .list-item.new-msg { border-left-color: #2563eb; background: #eff6ff; }
        
        .item-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
        .item-body { font-size: 0.95rem; color: #475569; margin-bottom: 15px; background: white; padding: 10px; border-radius: 8px; border: 1px dashed #cbd5e1; }
        
        .item-actions { display: flex; gap: 8px; flex-wrap: wrap; }
        .btn-mini { border: none; padding: 8px 15px; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 0.85rem; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-vitrin { background: #FFD700; color: #000; }
        .btn-sil { background: #fee2e2; color: #ef4444; }
        .btn-sil:hover { background: #ef4444; color: white; }
        .btn-arsiv { background: #f1f5f9; color: #64748b; border: 1px solid #cbd5e1; }
        .btn-wa { background: #25D366; color: white; flex: 1; text-align: center; }
        
        .settings-box { border: 2px dashed #cbd5e1; padding: 20px; border-radius: 15px; margin-bottom: 20px; background: #f8fafc; }

        /* YENÄ° GEOMETRÄ°K VE CAFCAFLI BUTON STÄ°LÄ° */
        .preview-circle { 
            width: 70px; height: 70px; 
            display: flex; align-items: center; justify-content: center; text-align: center; 
            font-size: 0.75rem; font-weight: 800; color: white; margin: 15px auto; 
            box-shadow: 0 0 20px rgba(0,0,0,0.3); cursor: pointer; border: 3px solid white; 
            
            /* Otomatik Renk GeÃ§iÅŸi (Rainbow) */
            background: linear-gradient(45deg, #ff0000, #ff7300, #fffb00, #48ff00, #00ffd5, #002bff, #7a00ff, #ff00c8, #ff0000);
            background-size: 400%;
            animation: cafcaflimorph 3s infinite ease-in-out, parlama 5s linear infinite;
        }

        /* Hem Åekil Hem Renk DeÄŸiÅŸtiren Animasyon */
        @keyframes cafcaflimorph {
            0% { border-radius: 50%; transform: rotate(0deg) scale(1); }
            25% { border-radius: 10%; transform: rotate(5deg) scale(1.1); } /* Karemsi */
            50% { border-radius: 50% 50% 0 50%; transform: rotate(-5deg) scale(1); } /* Damla */
            75% { border-radius: 30%; transform: rotate(3deg) scale(1.1); } /* YuvarlatÄ±lmÄ±ÅŸ Kare */
            100% { border-radius: 50%; transform: rotate(0deg) scale(1); }
        }

        @keyframes parlama { 
            0% { background-position: 0% 50%; } 
            50% { background-position: 100% 50%; } 
            100% { background-position: 0% 50%; } 
        }

        /* TAB GÄ°ZLEME */
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2>KOKPÄ°T GÄ°RÄ°ÅÄ°</h2>
            <p style="color:#aaa; font-size:0.9rem;">GÃ¼venlik: BarÄ±ÅŸ Ä°lkan Ã–zel</p>
            <input type="password" id="password" class="login-input" placeholder="YÃ¶netici Åifresi">
            <button onclick="girisYap()" class="login-btn">GiriÅŸ Yap</button>
            <div id="hata-mesaji" class="error-msg" style="display:none; color:red; margin-top:10px;">HatalÄ± Åifre!</div>
        </div>
    </div>

    <div id="admin-panel">
        <div class="header-bar">
            <h2 style="margin:0; color:#2563eb;">ğŸš€ BarÄ±ÅŸ Hoca Paneli</h2>
            <button onclick="cikisYap()" class="logout-btn">Ã‡Ä±kÄ±ÅŸ</button>
        </div>

        <div class="stat-card">
            <div>BUGÃœN GELEN ZÄ°YARETÃ‡Ä°</div>
            <div class="stat-number" id="ziyaret-sayisi">0</div>
        </div>

        <div class="tab-buttons">
            <button class="tab-btn active" onclick="tabDegis('proje')">Projeler</button>
            <button class="tab-btn" onclick="tabDegis('yazi')">YazÄ±lar</button>
            <button class="tab-btn" onclick="tabDegis('tavsiye')">Tavsiyeler</button>
            <button class="tab-btn" onclick="tabDegis('duyuru')">Duyurular</button>
            <button class="tab-btn" onclick="tabDegis('mesaj')">
                Mesajlar 
                <span id="msg-badge" class="badge">0</span>
            </button>
            <button class="tab-btn" onclick="tabDegis('ayarlar')">âš™ï¸ Ayarlar</button>
        </div>

        <div id="proje-tab" class="tab-content active panel-card">
            <h3>ğŸ® Yeni Ä°Ã§erik Ekle & YÃ¶nlendir</h3>
            <input type="text" id="p-baslik" placeholder="BaÅŸlÄ±k (Ã–rn: LGS Ã‡alÄ±ÅŸma KampÄ±)">
            <div style="display: flex; gap: 10px;">
                <input type="text" id="p-link" placeholder="Link..." style="flex:2;">
                <select onchange="document.getElementById('p-link').value = this.value" style="flex:1; background:#fffbeb; font-weight:bold;">
                    <option value="">HÄ±zlÄ± Sayfa ğŸ”½</option>
                    <option value="anaokulu.html">Anaokulu</option>
                    <option value="ilkokul.html">Ä°lkokul</option>
                    <option value="kocluk.html">KoÃ§luk</option>
                    <option value="ozel-egitim.html">Ã–zel EÄŸitim</option>
                    <option value="ben-ali.html">Ben Ali KitabÄ±</option>
                </select>
            </div>
            <select id="p-kategori">
                <option value="Genel">Kategori SeÃ§iniz...</option>
                <option value="Anaokulu">ğŸ§¸ Anaokulu</option>
                <option value="Ä°lkokul">ğŸ« Ä°lkokul</option>
                <option value="LGS KoÃ§luk">ğŸ¯ KoÃ§luk & SÄ±nav</option>
                <option value="Robotik">ğŸ¤– Robotik</option>
                <option value="Ã–zel EÄŸitim">ğŸ§© Ã–zel EÄŸitim</option>
            </select>
            <select id="p-icon">
                <option value="fa-star">â­ YÄ±ldÄ±z</option>
                <option value="fa-gamepad">ğŸ® Oyun</option>
                <option value="fa-book">ğŸ“– Kitap</option>
                <option value="fa-robot">ğŸ¤– Robot</option>
                <option value="fa-brain">ğŸ§  Beyin</option>
            </select>
            <button onclick="projeEkle()" class="save-btn">Projeyi Kaydet</button>
            <div style="margin-top:20px; border-top:1px solid #eee; padding-top:10px;">
                <h4>ğŸ“‚ Mevcut Projeler</h4>
                <div id="list-projeler"></div>
            </div>
        </div>

        <div id="yazi-tab" class="tab-content panel-card">
            <h3>ğŸ“ Yeni KÃ¶ÅŸe YazÄ±sÄ± Ekle</h3>
            <input type="text" id="y-baslik" placeholder="YazÄ± BaÅŸlÄ±ÄŸÄ±">
            <textarea id="y-icerik" rows="5" placeholder="YazÄ± iÃ§eriÄŸi..."></textarea>
            <button onclick="yaziEkle()" class="save-btn">YazÄ±yÄ± YayÄ±nla</button>
            <div id="list-yazilar" style="margin-top:20px;"></div>
        </div>

        <div id="tavsiye-tab" class="tab-content panel-card">
            <h3>â­ Tavsiye Ekle</h3>
            <input type="text" id="t-baslik" placeholder="BaÅŸlÄ±k">
            <input type="text" id="t-aciklama" placeholder="Alt BaÅŸlÄ±k">
            <input type="text" id="t-link" placeholder="Link">
            <select id="t-icon">
                <option value="fa-instagram">Instagram</option><option value="fa-youtube">YouTube</option>
                <option value="fa-link">Link</option>
            </select>
            <button onclick="tavsiyeEkle()" class="save-btn">Ekle</button>
            <div id="list-tavsiyeler" style="margin-top:20px;"></div>
        </div>

        <div id="duyuru-tab" class="tab-content panel-card">
            <h3>ğŸ“¢ Yeni Duyuru</h3>
            <input type="text" id="d-metin" placeholder="Kayan yazÄ± metni...">
            <button onclick="duyuruEkle()" class="save-btn">YayÄ±na Al</button>
            <div id="list-duyurular" style="margin-top:20px;"></div>
        </div>

        <div id="mesaj-tab" class="tab-content panel-card">
            <h3>ğŸ“¬ Gelen Kutusu</h3>
            <div style="display:flex; gap:10px; margin-bottom:15px;">
                <button class="btn-mini btn-arsiv" onclick="mesajFiltre('bekliyor')">Gelenler</button>
                <button class="btn-mini btn-arsiv" onclick="mesajFiltre('arsiv')">ArÅŸiv</button>
            </div>
            <div id="mesaj-listesi">YÃ¼kleniyor...</div>
        </div>

        <div id="ayarlar-tab" class="tab-content panel-card">
            <div class="settings-box">
                <h4>ğŸ¤– Robot AyarlarÄ±</h4>
                <input type="text" id="set-api" placeholder="API AnahtarÄ±">
                <textarea id="set-prompt" rows="3" placeholder="Robot TalimatÄ±"></textarea>
                <button onclick="robotAyarlariniKaydet()" class="save-btn" style="background:#2563eb;">Robotu GÃ¼ncelle</button>
            </div>
            
            <div class="settings-box" style="background:#fff7ed; border-color:#fdba74;">
                <h4>âœ¨ CAFCAFLI ACÄ°L BUTON AYARLARI</h4>
                
                <div style="text-align:center; margin-bottom:15px;">
                    <p style="font-size:0.9rem; color:#666;">Sitede gÃ¶rÃ¼necek ÅŸekil (Otomatik Renk & Geometri):</p>
                    <div class="preview-circle" id="circle-prev">ACÄ°L<br>DUYURU</div>
                </div>

                <div style="margin-bottom:10px; font-weight:bold;"><input type="checkbox" id="set-circle-active"> Sitede Aktif Olsun</div>
                <input type="text" id="set-circle-text" placeholder="Daire Ä°Ã§indeki YazÄ± (Ã–rn: CANLI DERS)">
                <input type="text" id="set-circle-msg" placeholder="TÄ±klayÄ±nca Ã‡Ä±kacak Mesaj">
                <input type="text" id="set-circle-link" placeholder="YÃ¶nlenecek Link (Varsa)">
                <button onclick="daireAyarlariniKaydet()" class="save-btn" style="background:#ea580c;">Butonu GÃ¼ncelle</button>
            </div>
        </div>

    </div>
    
    <script>
        const db = firebase.firestore();
        let tumMesajlar = []; 

        const YONETICI_SIFRESI = "123456"; 

        function girisYap() { 
            const girilenSifre = document.getElementById('password').value;
            if(girilenSifre === YONETICI_SIFRESI) {
                document.getElementById('login-screen').style.display = 'none'; 
                document.getElementById('admin-panel').style.display = 'block'; 
                baslat();
            } else {
                document.getElementById('hata-mesaji').style.display = 'block';
            }
        }
        
        function cikisYap() { location.reload(); }

        function baslat() {
            ayarlarYukle(); 
            listeleriGetir(); 
            mesajlariGetir(); 
        }

        function tabDegis(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            const buttons = document.querySelectorAll('.tab-btn');
            const tabs = ['proje', 'yazi', 'tavsiye', 'duyuru', 'mesaj', 'ayarlar'];
            const index = tabs.indexOf(tabName);
            if(index > -1 && buttons[index]) buttons[index].classList.add('active');
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        const bugunStr = new Date().toISOString().split('T')[0];
        db.collection("istatistik").doc(bugunStr).onSnapshot(d => { document.getElementById('ziyaret-sayisi').innerText = d.exists ? d.data().ziyaret : 0; });

        // PROJELERÄ° OLDUÄU GÄ°BÄ° KORUDUM (SENÄ°N Ä°STEÄÄ°N ÃœZERÄ°NE)
        function projeEkle() { db.collection("projeler").add({ baslik: document.getElementById('p-baslik').value, link: document.getElementById('p-link').value, kategori: document.getElementById('p-kategori').value, icon: document.getElementById('p-icon').value, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>alert("Eklendi")); }
        
        function yaziEkle() { db.collection("yazilar").add({ baslik: document.getElementById('y-baslik').value, icerik: document.getElementById('y-icerik').value, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>alert("Eklendi")); }
        function tavsiyeEkle() { db.collection("tavsiyeler").add({ baslik: document.getElementById('t-baslik').value, aciklama: document.getElementById('t-aciklama').value, link: document.getElementById('t-link').value, icon: document.getElementById('t-icon').value, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>alert("Eklendi")); }
        function duyuruEkle() { db.collection("duyurular").add({ metin: document.getElementById('d-metin').value, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>alert("Eklendi")); }

        function listeleriGetir() {
            // PROJELER LÄ°STESÄ° (KORUNDU)
            db.collection("projeler").orderBy("tarih", "desc").onSnapshot(snap => {
                let h = "";
                snap.forEach(d => {
                    const v = d.data();
                    const safeBaslik = (v.baslik || "").replace(/'/g, "\\'");
                    const safeLink = (v.link || "").replace(/'/g, "\\'");
                    h += `<div class="list-item">
                            <div class="item-header"><strong>${v.baslik}</strong> <span style="font-size:0.8rem; color:#666;">(${v.kategori})</span></div>
                            <div class="item-actions">
                                <button onclick="vitrinYap('${safeBaslik}', 'Ã–zel SeÃ§im', '${safeLink}')" class="btn-mini btn-vitrin"><i class="fas fa-star"></i> Vitrin</button>
                                <button onclick="sil('projeler', '${d.id}')" class="btn-mini btn-sil">Sil</button>
                            </div>
                          </div>`;
                });
                document.getElementById('list-projeler').innerHTML = h || "Veri yok.";
            });

            ['yazilar', 'tavsiyeler', 'duyurular'].forEach(tip => {
                db.collection(tip).orderBy("tarih", "desc").onSnapshot(snap => {
                    let h = "";
                    snap.forEach(d => {
                        let v = d.data();
                        h += `<div class="list-item"><span>${v.baslik || v.metin}</span> <button onclick="sil('${tip}', '${d.id}')" class="btn-mini btn-sil">Sil</button></div>`;
                    });
                    document.getElementById('list-' + tip).innerHTML = h || "Veri yok.";
                });
            });
        }

        function vitrinYap(baslik, aciklama, link) {
            if(!confirm("Vitrine eklensin mi?")) return;
            db.collection("site_ayarlari").doc("haftanin_oyunu").set({ baslik: baslik, metin: aciklama, url: link, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(() => alert("âœ… Vitrin GÃ¼ncellendi!"));
        }

        function sil(kol, id) { if(confirm("Silinsin mi?")) db.collection(kol).doc(id).delete(); }
        function arsivle(id) { db.collection("iletisim_talepleri").doc(id).update({durum: "arsiv"}).then(()=>alert("ArÅŸivlendi")); }

        function ayarlarYukle() {
            db.collection("site_ayarlari").doc("robot").get().then(d => { if(d.exists) { document.getElementById('set-api').value=d.data().apiKey; document.getElementById('set-prompt').value=d.data().prompt; } });
            db.collection("site_ayarlari").doc("ozel_duyuru").get().then(d => { 
                if(d.exists) { 
                    const v=d.data();
                    document.getElementById('set-circle-active').checked=v.aktif; 
                    document.getElementById('set-circle-text').value=v.daireMetni; 
                    document.getElementById('set-circle-msg').value=v.mesaj; 
                    document.getElementById('set-circle-link').value=v.link;
                } 
            });
        }
        function robotAyarlariniKaydet() { db.collection("site_ayarlari").doc("robot").set({ apiKey: document.getElementById('set-api').value, prompt: document.getElementById('set-prompt').value }, {merge:true}).then(()=>alert("Kaydedildi")); }
        
        // YENÄ° GEOMETRÄ°K BUTON AYARI
        function daireAyarlariniKaydet() { 
            db.collection("site_ayarlari").doc("ozel_duyuru").set({ 
                aktif: document.getElementById('set-circle-active').checked, 
                daireMetni: document.getElementById('set-circle-text').value, 
                mesaj: document.getElementById('set-circle-msg').value, 
                link: document.getElementById('set-circle-link').value,
                stil: "geometrik" // Yeni stil bilgisi
            }, {merge:true}).then(()=>alert("Geometrik Buton GÃ¼ncellendi!")); 
        }

        // MESAJ SÄ°STEMÄ°
        function mesajlariGetir() {
            db.collection("iletisim_talepleri").orderBy("tarih", "desc").onSnapshot(snap => {
                tumMesajlar = [];
                let bekleyenSayisi = 0;
                
                snap.forEach(doc => {
                    const data = doc.data();
                    data.id = doc.id;
                    if(data.durum === 'bekliyor') bekleyenSayisi++;
                    tumMesajlar.push(data);
                });

                const badge = document.getElementById('msg-badge');
                if(bekleyenSayisi > 0) {
                    badge.innerText = bekleyenSayisi;
                    badge.style.display = 'inline-block';
                } else {
                    badge.style.display = 'none';
                }

                mesajFiltre('bekliyor');
            });
        }

        function mesajFiltre(filtreDurumu) {
            let html = "";
            const gosterilecekler = tumMesajlar.filter(m => m.durum === filtreDurumu);
            
            if(gosterilecekler.length === 0) {
                document.getElementById('mesaj-listesi').innerHTML = "<p style='color:#666; font-style:italic;'>Bu klasÃ¶rde mesaj yok.</p>";
                return;
            }

            gosterilecekler.forEach(v => {
                const tarih = v.tarih ? new Date(v.tarih.seconds*1000).toLocaleDateString('tr-TR') : '';
                
                let girisCumlesi = "Merhaba, ben BarÄ±ÅŸ Ã–ÄŸretmen.";
                if(v.konu.toLowerCase().includes("lgs")) girisCumlesi += " LGS koÃ§luÄŸu baÅŸvurunuzu inceledim.";
                else if(v.konu.toLowerCase().includes("Ã¶zel")) girisCumlesi += " Ã–zel ders talebinizi aldÄ±m.";
                else girisCumlesi += ` "${v.konu}" hakkÄ±ndaki mesajÄ±nÄ±zÄ± aldÄ±m.`;
                
                const waMesaj = `${girisCumlesi} Size nasÄ±l yardÄ±mcÄ± olabilirim?`;
                const waLink = `https://wa.me/90${v.telefon.replace(/\D/g,'')}?text=${encodeURIComponent(waMesaj)}`;

                html += `<div class="list-item ${filtreDurumu==='bekliyor' ? 'new-msg' : ''}">
                        <div class="item-header">
                            <div><strong>${v.ad_soyad}</strong> <small style="color:#666">${tarih}</small></div>
                            <div>${v.telefon}</div>
                        </div>
                        <div class="item-body">
                            <strong>Konu:</strong> ${v.konu}
                        </div>
                        <div class="item-actions">
                            <a href="${waLink}" target="_blank" class="btn-mini btn-wa"><i class="fab fa-whatsapp"></i> ONAYLA & CEVAPLA</a>
                            ${filtreDurumu === 'bekliyor' ? `<button onclick="arsivle('${v.id}')" class="btn-mini btn-arsiv">ArÅŸivle</button>` : ''}
                            <button onclick="sil('iletisim_talepleri','${v.id}')" class="btn-mini btn-sil">Sil</button>
                        </div>
                    </div>`; 
            });
            document.getElementById('mesaj-listesi').innerHTML = html;
        }
    </script>
</body>
</html>
