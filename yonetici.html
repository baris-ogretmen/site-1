<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>YÃ¶netici Paneli v43.1 (Vitrin Fix) | BarÄ±ÅŸ Ä°lkan</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="firebase-config.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        /* ... (Senin mevcut stil kodlarÄ±n burada aynen kalsÄ±n) ... */
        :root { --ana: #6366f1; --koyu: #1e293b; --acik: #f1f5f9; }
        * { box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--acik); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        /* ... (DiÄŸer CSS kodlarÄ±) ... */
        .sayfa-kutusu { border: 2px dashed #cbd5e1; padding: 15px; border-radius: 10px; margin-bottom: 15px; background: #fff; position: relative; }
        .sayfa-no-etiket { position: absolute; top: -10px; left: 10px; background: #3b82f6; color: white; padding: 2px 10px; border-radius: 10px; font-size: 0.8rem; font-weight: bold; }
        /* ... (DiÄŸer CSS kodlarÄ±) ... */
        .icon-selector-area { border: 2px solid #e2e8f0; padding: 10px; border-radius: 12px; background: #f8fafc; max-height: 300px; overflow-y: auto; }
        .icon-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(50px, 1fr)); gap: 10px; padding: 5px; }
        .icon-opt { width: 50px; height: 50px; background: white; border: 1px solid #ddd; border-radius: 10px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.5rem; transition: 0.2s; }
        .icon-opt:hover { transform: scale(1.1); border-color: var(--ana); background: #e0e7ff; }
        .icon-opt.selected { border: 3px solid var(--ana); background: #c7d2fe; transform: scale(1.1); }
        /* ... */
    </style>
</head>
<body>
    <div id="toast-container"></div>
    <div id="login-screen">
        <div class="login-box">
            <h2 style="color:#6366f1;">YÃ¶netici GiriÅŸi</h2>
            <input type="email" id="email" class="inp" placeholder="E-posta">
            <input type="password" id="password" class="inp" placeholder="Åifre">
            <button onclick="girisYap()" class="btn btn-primary">GiriÅŸ Yap</button>
        </div>
    </div>
    
    <button id="mobile-toggle-btn" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>

    <div style="display:flex; width:100%; height:100%;">
        <div class="sidebar" id="sidebar">
            <h2>BarÄ±ÅŸ Hoca<br><small style="font-size:0.8rem; color:#94a3b8;">v43.1 (Fix)</small></h2>
            <button class="menu-btn active" onclick="showSection('ozet')"><i class="fas fa-chart-pie"></i> Ã–zet</button>
            <button class="menu-btn" style="color:#fbbf24;" onclick="showSection('hikaye-yaz')"><i class="fas fa-pen-nib"></i> HÄ°KAYE YAZ</button>
            <button class="menu-btn" onclick="showSection('vitrin-yonetimi')"><i class="fas fa-star"></i> Vitrin YÃ¶netimi</button>
            <button class="menu-btn" onclick="showSection('sihirbaz')"><i class="fas fa-magic"></i> Ä°Ã§erik Ekle</button>
            <button class="menu-btn" onclick="showSection('yazi-yonetimi')"><i class="fas fa-feather-alt"></i> KÃ¶ÅŸe YazÄ±larÄ±</button>
            <button class="menu-btn" onclick="showSection('kitap-ekle')"><i class="fas fa-book"></i> Kitap YÃ¶netimi</button>
            <button class="menu-btn" onclick="showSection('mesajlar')"><i class="fas fa-envelope"></i> Mesajlar</button>
            <button class="menu-btn" onclick="showSection('duyuru-tavsiye')"><i class="fas fa-bullhorn"></i> Duyuru & Tavsiye</button>
            <button class="menu-btn" onclick="showSection('ayarlar')"><i class="fas fa-cog"></i> Ayarlar & Buton</button>
            <div style="margin-top:auto;"><button onclick="if(confirm('Ã‡Ä±kÄ±ÅŸ?')) auth.signOut()" class="menu-btn" style="color:#ef4444;"><i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ</button></div>
        </div>

        <div class="main-content" onclick="if(window.innerWidth<=768) document.getElementById('sidebar').classList.remove('show')">
            <div id="ozet" class="panel-section active">
                <h3>ğŸ“Š Ä°statistikler</h3>
                <div class="stats-grid">
                    <div class="stat-card stat-blue"><div>BugÃ¼n</div><div class="stat-val" id="stat-today">0</div></div>
                    <div class="stat-card stat-red"><div>Bu Ay</div><div class="stat-val" id="stat-month">0</div></div>
                    <div class="stat-card stat-purple"><div>Toplam</div><div class="stat-val" id="stat-total">0</div></div>
                </div>
            </div>

            <div id="hikaye-yaz" class="panel-section">
                <div class="card border-2 border-yellow-400">
                    <h3 style="color:#d97706;"><i class="fas fa-pen-fancy"></i> Ä°nteraktif Hikaye OluÅŸtur</h3>
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-bottom:15px;">
                        <input type="text" id="h-baslik" class="inp" placeholder="KitabÄ±n AdÄ±">
                        <input type="text" id="h-alt" class="inp" placeholder="Alt BaÅŸlÄ±k">
                        <select id="h-renk" class="inp">
                            <option value="linear-gradient(135deg, #f59e0b, #d97706)">Turuncu</option>
                            <option value="linear-gradient(135deg, #3b82f6, #1d4ed8)">Mavi</option>
                            <option value="linear-gradient(135deg, #10b981, #059669)">YeÅŸil</option>
                            <option value="linear-gradient(135deg, #ef4444, #b91c1c)">KÄ±rmÄ±zÄ±</option>
                        </select>
                        <input type="number" id="h-sira" class="inp" value="100" placeholder="SÄ±ra">
                    </div>
                    <div id="sayfalar-alani" style="margin-bottom:20px;"></div>
                    <button onclick="yeniSayfaEkle()" class="btn btn-info" style="width:100%; margin-bottom:10px;">+ Sayfa Ekle</button>
                    <button onclick="hikayeyiKaydet()" class="btn btn-success" style="width:100%;">KÄ°TABI YAYINLA</button>
                </div>
            </div>

            <div id="vitrin-yonetimi" class="panel-section">
                <div class="card border-2 border-blue-500">
                    <h3>â­ Ana Sayfa Vitrin KutularÄ±</h3>
                    <p style="color:#666; margin-bottom:15px;">Mavi ve SarÄ± kutularda HANGÄ° Ä°Ã‡ERÄ°ÄÄ°N gÃ¶rÃ¼neceÄŸini buradan sen seÃ§ersin.</p>
                    <div style="margin-bottom:20px;">
                        <label><b>YENÄ° KÄ°TAP (Mavi Kutu)</b></label>
                        <div id="dropdown-kitaplar" class="inp" style="height:auto; max-height:150px; overflow-y:auto; border:2px solid #3b82f6;">YÃ¼kleniyor...</div>
                    </div>
                    <div style="margin-bottom:20px;">
                        <label><b>SON YAZI (SarÄ± Kutu)</b></label>
                        <div id="dropdown-yazilar" class="inp" style="height:auto; max-height:150px; overflow-y:auto; border:2px solid #fcd34d;">YÃ¼kleniyor...</div>
                    </div>
                </div>
            </div>

            <div id="sihirbaz" class="panel-section"><div class="card"><h3>ğŸª„ Yeni Ä°Ã§erik Ekle</h3><div style="display:flex; gap:10px; flex-wrap:wrap; margin-bottom:15px;"><label><input type="radio" name="tur" value="projeler" checked onchange="formuGuncelle()"> ğŸ® Oyun</label><label><input type="radio" name="tur" value="videolar" onchange="formuGuncelle()"> ğŸ¥ Video</label><label><input type="radio" name="tur" value="kaynaklar" onchange="formuGuncelle()"> ğŸ“š PDF</label><label><input type="radio" name="tur" value="yazilar" onchange="formuGuncelle()"> ğŸ“ KÃ¶ÅŸe YazÄ±sÄ±</label></div><input type="text" id="p-baslik" class="inp" placeholder="BaÅŸlÄ±k"><input type="text" id="p-aciklama" class="inp" placeholder="KÄ±sa AÃ§Ä±klama"><input type="text" id="p-link" class="inp" placeholder="Link / Dosya AdÄ± / Video URL"><div id="area-yazi" style="display:none;"><label>YazÄ± Ä°Ã§eriÄŸi (HTML)</label><textarea id="p-icerik" class="inp" rows="10"></textarea></div><div id="area-detay"><label>Ä°kon SeÃ§</label><div class="icon-selector-area"><input type="text" id="icon-search" class="inp" placeholder="Ä°kon ara..." onkeyup="filterIcons()"><div class="icon-grid" id="icon-grid-container"></div><input type="hidden" id="p-selected-icon" value="fa-gamepad"></div><div style="margin:10px 0;">SeÃ§ilen: <i id="preview-icon" class="fas fa-gamepad" style="font-size:2rem; color:var(--ana);"></i></div><label>Kategoriler</label><div class="category-grid"><label class="cat-item"><input type="checkbox" class="cat-check" value="Anaokulu"> ğŸ§¸ Anaokulu</label><label class="cat-item"><input type="checkbox" class="cat-check" value="Ã–zel EÄŸitim"> ğŸ§© Ã–zel EÄŸitim</label><label class="cat-item"><input type="checkbox" class="cat-check" value="1. SÄ±nÄ±f"> 1. SÄ±nÄ±f</label><label class="cat-item"><input type="checkbox" class="cat-check" value="2. SÄ±nÄ±f"> 2. SÄ±nÄ±f</label><label class="cat-item"><input type="checkbox" class="cat-check" value="3. SÄ±nÄ±f"> 3. SÄ±nÄ±f</label><label class="cat-item"><input type="checkbox" class="cat-check" value="4. SÄ±nÄ±f"> 4. SÄ±nÄ±f</label><label class="cat-item"><input type="checkbox" class="cat-check" value="5. SÄ±nÄ±f"> 5. SÄ±nÄ±f</label><label class="cat-item"><input type="checkbox" class="cat-check" value="6. SÄ±nÄ±f"> 6. SÄ±nÄ±f</label><label class="cat-item"><input type="checkbox" class="cat-check" value="7. SÄ±nÄ±f"> 7. SÄ±nÄ±f</label><label class="cat-item"><input type="checkbox" class="cat-check" value="8. SÄ±nÄ±f"> 8. SÄ±nÄ±f</label><label class="cat-item"><input type="checkbox" class="cat-check" value="Robotik"> ğŸ¤– Robotik</label><label class="cat-item"><input type="checkbox" class="cat-check" value="Kodlama"> ğŸ’» Kodlama</label><label class="cat-item"><input type="checkbox" class="cat-check" value="AkÄ±l Zeka"> ğŸ§  AkÄ±l Zeka</label><label class="cat-item"><input type="checkbox" class="cat-check" value="SatranÃ§"> â™Ÿï¸ SatranÃ§</label><label class="cat-item"><input type="checkbox" class="cat-check" value="Dil KonuÅŸma"> ğŸ—£ï¸ Dil</label><label class="cat-item"><input type="checkbox" class="cat-check" value="TasarÄ±m"> ğŸ¨ TasarÄ±m</label></div></div><label><input type="checkbox" id="is-vitrin" checked> Vitrine Ekle</label><button onclick="icerikKaydet()" class="btn btn-success" style="margin-top:10px;">KAYDET</button></div></div>
            <div id="yazi-yonetimi" class="panel-section"><div class="card"><h3>âœï¸ KÃ¶ÅŸe YazÄ±larÄ± Listesi</h3><div id="ozel-yazi-listesi">YÃ¼kleniyor...</div></div></div>
            <div id="kitap-ekle" class="panel-section"><div class="card"><h3>ğŸ“š Kitap Ekle (Manuel Link)</h3><div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;"><div><input type="text" id="k-baslik" class="inp" placeholder="Kitap AdÄ±"><input type="text" id="k-alt" class="inp" placeholder="Alt BaÅŸlÄ±k"><input type="text" id="k-link" class="inp" placeholder="Link"></div><div><select id="k-renk" class="inp"><option value="linear-gradient(135deg, #2563eb, #1e3a8a)">Mavi</option><option value="linear-gradient(135deg, #f59e0b, #d97706)">Turuncu</option><option value="linear-gradient(135deg, #ef4444, #991b1b)">KÄ±rmÄ±zÄ±</option><option value="linear-gradient(135deg, #10b981, #059669)">YeÅŸil</option></select><input type="number" id="k-sira" class="inp" value="1"></div></div><button onclick="kitapKaydet()" class="btn btn-primary">EKLE</button></div><div class="card"><h3>ğŸ“– Kitap Listesi</h3><div id="kitap-listesi"></div></div></div>
            <div id="mesajlar" class="panel-section"><div class="card"><h3>ğŸ“© Gelen Mesajlar</h3><div id="mesaj-listesi">YÃ¼kleniyor...</div></div></div>
            <div id="duyuru-tavsiye" class="panel-section"><div class="card"><h3>ğŸ“¢ Duyuru Ekle</h3><input type="text" id="d-metin" class="inp" placeholder="Duyuru metni..."><button onclick="duyuruEkle()" class="btn btn-primary">Ekle</button><div id="list-duyurular" style="margin-top:15px;"></div></div><div class="card"><h3>â­ Tavsiye Ekle</h3><input type="text" id="t-baslik" class="inp" placeholder="BaÅŸlÄ±k"><input type="text" id="t-link" class="inp" placeholder="Link"><button onclick="tavsiyeEkle()" class="btn btn-success">Ekle</button><div id="list-tavsiyeler" style="margin-top:15px;"></div></div></div>
            <div id="ayarlar" class="panel-section">
                <div class="card" style="border:2px solid #fcd34d;"><h3>ğŸ”´ Acil Buton AyarlarÄ±</h3><div id="preview-box"><button id="demo-btn" class="demo-btn" onclick="testLink()"><i id="demo-icon" class="fas fa-play" style="font-size:1.5rem;"></i><span id="demo-text">YENÄ°</span></button></div><label><input type="checkbox" id="set-active"> Buton Aktif</label><div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;"><select id="set-shape" class="inp" onchange="updateButtonPreview()"><option value="shape-circle">Yuvarlak</option><option value="shape-square">Kare</option><option value="shape-leaf">Yaprak</option><option value="shape-msg">Mesaj Balonu</option><option value="shape-blob">Damla</option><option value="shape-star">YÄ±ldÄ±z</option><option value="shape-hex">AltÄ±gen</option><option value="shape-cloud">Bulut</option><option value="shape-heart">Kalp</option><option value="shape-diamond">Elmas</option></select><select id="set-color" class="inp" onchange="updateButtonPreview()"><option value="linear-gradient(135deg, #ef4444, #b91c1c)">KÄ±rmÄ±zÄ±</option><option value="linear-gradient(135deg, #f59e0b, #d97706)">Turuncu</option><option value="linear-gradient(135deg, #3b82f6, #1d4ed8)">Mavi</option><option value="linear-gradient(135deg, #10b981, #059669)">YeÅŸil</option><option value="linear-gradient(135deg, #8b5cf6, #6d28d9)">Mor</option></select></div><label>Link ve Metin</label><div style="display:flex; gap:10px;"><input type="text" id="set-media" class="inp" placeholder="Link..."><button onclick="enYeniOyunGetir()" class="btn btn-primary" style="width:auto; white-space:nowrap;">En Yeni OYUN</button><button onclick="enYeniHerseyGetir()" class="btn btn-info" style="width:auto; white-space:nowrap;">En Yeni Her Åey</button></div><input type="text" id="set-text" class="inp" value="YENÄ°" onkeyup="updateButtonPreview()"><input type="text" id="set-msg" class="inp" placeholder="Balon MesajÄ± (Opsiyonel)"><button onclick="daireKaydet()" class="btn btn-warning">AYARLARI KAYDET</button></div>
                <div class="card"><h3>ğŸ¤– Robot Asistan</h3><input type="text" id="api-key" class="inp" placeholder="API Key"><textarea id="robot-prompt" class="inp" placeholder="Prompt..."></textarea><button onclick="robotKaydet()" class="btn btn-primary">Robotu GÃ¼ncelle</button></div>
            </div>
        </div>
    </div>

    <script>
        const auth = firebase.auth();
        const db = firebase.firestore();
        let tumIceriklerCache = [];

        function showToast(msg) {
            const c = document.getElementById('toast-container');
            const t = document.createElement('div'); t.className = 'toast'; t.innerHTML = `<i class="fas fa-check-circle"></i> ${msg}`; c.appendChild(t);
            setTimeout(() => { t.style.opacity='0'; setTimeout(()=>t.remove(), 400); }, 3000);
        }

        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('show'); }
        function girisYap() { const e=document.getElementById('email').value; const p=document.getElementById('password').value; auth.signInWithEmailAndPassword(e,p).catch(err=>alert(err.message)); }
        auth.onAuthStateChanged(user => { if(user){ document.getElementById('login-screen').style.display='none'; verileriYukle(); istatistikGetir(); mesajlariGetir(); loadIcons(); yeniSayfaEkle(); } else document.getElementById('login-screen').style.display='flex'; });
        function showSection(id) { document.querySelectorAll('.panel-section').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); if(window.innerWidth<=768) toggleSidebar(); if(id==='kitap-ekle') kitaplariGetir(); if(id==='yazi-yonetimi') yazilariGetirOzel(); }
        function formuGuncelle() { const tur=document.querySelector('input[name="tur"]:checked').value; document.getElementById('area-detay').style.display=tur==='yazilar'?'none':'block'; document.getElementById('area-yazi').style.display=tur==='yazilar'?'block':'none'; }

        // --- HÄ°KAYE YAZMA ---
        let sayfaSayisi = 0;
        function yeniSayfaEkle() {
            sayfaSayisi++;
            const div = document.createElement('div'); div.className = 'sayfa-kutusu';
            div.innerHTML = `<div class="sayfa-no-etiket">Sayfa ${sayfaSayisi}</div><div style="text-align:right;"><span onclick="this.parentElement.parentElement.remove()" style="color:red; cursor:pointer; font-size:0.8rem;">Sil</span></div><input type="text" class="inp s-resim" placeholder="Resim AdÄ± (Ã–rn: ali1.jpg veya Link)"><textarea class="inp s-metin" style="height:80px;" placeholder="Hikayenin bu kÄ±smÄ±nÄ± yaz..."></textarea>`;
            document.getElementById('sayfalar-alani').appendChild(div);
        }

        function hikayeyiKaydet() {
            const baslik = document.getElementById('h-baslik').value;
            if(!baslik) return alert("Kitap adÄ±nÄ± yazmalÄ±sÄ±n!");
            let sayfalar = [];
            document.querySelectorAll('.sayfa-kutusu').forEach(kutu => { sayfalar.push({ img: kutu.querySelector('.s-resim').value, text: kutu.querySelector('.s-metin').value }); });
            if(sayfalar.length === 0) return alert("En az 1 sayfa eklemelisin!");
            
            db.collection("dijital_kitaplar").add({ baslik: baslik, sayfalar: sayfalar, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then((docRef) => {
                const otomatikLink = `kitap-oku.html?id=${docRef.id}`;
                // Otomatik olarak vitrin listesine ekle
                db.collection("kitaplar").add({ 
                    baslik: baslik, 
                    altBaslik: document.getElementById('h-alt').value, 
                    link: otomatikLink, 
                    renk: document.getElementById('h-renk').value, 
                    sira: parseInt(document.getElementById('h-sira').value) || 100, 
                    tarih: firebase.firestore.FieldValue.serverTimestamp() 
                }).then(() => { 
                    showToast("âœ… Kitap YayÄ±nlandÄ±!"); 
                    // OTOMATÄ°K OLARAK ANA SAYFA VÄ°TRÄ°NÄ°NE DE AYARLA (MAVÄ° KUTU)
                    vitrinGuncelle('kitap', baslik, otomatikLink);
                    
                    document.getElementById('sayfalar-alani').innerHTML = ""; 
                    document.getElementById('h-baslik').value = ""; 
                    sayfaSayisi = 0; 
                    yeniSayfaEkle(); 
                });
            });
        }

        // --- VÄ°TRÄ°N GÃœNCELLEME ---
        function vitrinGuncelle(tur, baslik, link) {
            const veri = { baslik, link };
            const docId = tur === 'kitap' ? 'vitrin_kitap' : 'vitrin_yazi';
            db.collection("site_ayarlari").doc(docId).set(veri).then(() => showToast(`âœ… ${tur==='kitap'?'Yeni Kitap':'Son YazÄ±'} Vitrine Koyuldu!`));
        }

        // --- Ä°KON YÃœKLEME ---
        const iconList = ["fa-gamepad", "fa-book", "fa-video", "fa-robot", "fa-chess", "fa-brain", "fa-rocket", "fa-star", "fa-pen-nib", "fa-music", "fa-code", "fa-puzzle-piece", "fa-calculator", "fa-flask", "fa-globe", "fa-graduation-cap", "fa-paint-brush", "fa-microscope", "fa-atom", "fa-laptop-code", "fa-tree", "fa-child", "fa-shapes", "fa-cubes", "fa-palette", "fa-bullhorn", "fa-calendar-alt", "fa-clock", "fa-comment-dots", "fa-thumbs-up", "fa-heart", "fa-star-half-alt", "fa-award", "fa-medal", "fa-trophy", "fa-crown", "fa-gem", "fa-magic", "fa-key", "fa-lock", "fa-unlock", "fa-bell", "fa-envelope", "fa-paper-plane", "fa-map-marker-alt", "fa-compass", "fa-binoculars", "fa-search", "fa-lightbulb", "fa-question-circle"];
        function loadIcons() { const g=document.getElementById('icon-grid-container'); g.innerHTML=""; iconList.forEach(i=>{ const d=document.createElement('div'); d.className='icon-opt'; d.innerHTML=`<i class="fas ${i}" style="color:#6366f1;"></i>`; d.onclick=()=>{document.querySelectorAll('.icon-opt').forEach(x=>x.classList.remove('selected')); d.classList.add('selected'); document.getElementById('p-selected-icon').value=i; document.getElementById('preview-icon').className=`fas ${i}`;}; g.appendChild(d); }); }
        function filterIcons() { const t=document.getElementById('icon-search').value.toLowerCase(); document.querySelectorAll('.icon-opt').forEach(i=>i.style.display=i.innerHTML.includes(t)?'flex':'none'); }

        // --- DÄ°ÄER FONKSÄ°YONLAR ---
        function formatLink(link) { if (!link) return ""; if (link.startsWith("http")) return link; const baseUrl = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1); return baseUrl + encodeURI(link); }
        function escapeStr(str) { return str ? str.replace(/'/g, "\\'").replace(/"/g, '&quot;') : ''; }
        function createRow(baslik, id, col, link, tur) { const safeBaslik = escapeStr(baslik); const fullLink = formatLink(link); const shareLink = `https://wa.me/?text=${encodeURIComponent(baslik + "\n" + fullLink)}`; return `<div class="list-item"><div style="flex:1;"><b>${baslik}</b> <span style="font-size:0.7rem; background:#e0e7ff; padding:2px 5px; border-radius:4px;">${tur}</span></div><div class="action-btns"><a href="${shareLink}" target="_blank" class="btn-mini bg-paylas"><i class="fab fa-whatsapp"></i> PaylaÅŸ</a><button class="btn-mini bg-vitrin" onclick="vitrinYap('${col}','${id}','${safeBaslik}','${formatLink(link)}')">â­ Vitrin</button><button class="btn-mini bg-buton" onclick="daireYap('${safeBaslik}','${formatLink(link)}')">â­• Buton</button><button class="btn-mini bg-sil" onclick="sil('${col}','${id}')">ğŸ—‘ Sil</button></div></div>`; }
        
        async function icerikKaydet() { const baslik = document.getElementById('p-baslik').value; const tur = document.querySelector('input[name="tur"]:checked').value; if(!baslik) return alert("BaÅŸlÄ±k girin!"); const batch = db.batch(); const ref = tur === 'yazilar' ? db.collection('yazilar').doc() : db.collection(tur).doc(); let data = { baslik, tarih: firebase.firestore.FieldValue.serverTimestamp() }; if(tur === 'yazilar') { data.icerik = document.getElementById('p-icerik').value; } else { data.link = document.getElementById('p-link').value; data.aciklama = document.getElementById('p-aciklama').value; data.vitrin = document.getElementById('is-vitrin').checked; data.icon = document.getElementById('p-selected-icon').value; const cats=[]; document.querySelectorAll('.cat-check:checked').forEach(c=>cats.push(c.value)); if(cats.length>0) { cats.forEach(k => { batch.set(db.collection(tur).doc(), {...data, kategori:k}); }); batch.commit().then(() => { showToast("âœ… Ä°Ã§erik Eklendi!"); verileriYukle(); }); return; } else { data.kategori="Genel"; } } batch.set(ref, data); batch.commit().then(() => { showToast("âœ… Ä°Ã§erik Eklendi!"); verileriYukle(); if(tur==='yazilar') yazilariGetirOzel(); }); }

        function verileriYukle() {
            tumIceriklerCache = [];
            const load = (col, type) => { db.collection(col).get().then(snap => { snap.forEach(d => tumIceriklerCache.push({ id:d.id, col, type, ...d.data() })); renderList(); }); };
            load("projeler","OYUN"); load("videolar","VÄ°DEO"); load("kaynaklar","PDF");
            db.collection("kitaplar").orderBy("sira","desc").get().then(snap=>{ let h=""; let dropH=""; snap.forEach(d=>{ const k=d.data(); const link=formatLink(k.link); h+=createRow(k.baslik, d.id, 'kitaplar', k.link, 'KÄ°TAP'); dropH += `<div style="display:flex; justify-content:space-between; padding:5px; border-bottom:1px solid #eee;"><span>${k.baslik}</span><button onclick="vitrinGuncelle('kitap', '${escapeStr(k.baslik)}', '${link}')" style="background:#3b82f6; color:white; border:none; padding:3px 8px; border-radius:5px; cursor:pointer;">SEÃ‡</button></div>`; }); document.getElementById('kitap-listesi').innerHTML=h; document.getElementById('dropdown-kitaplar').innerHTML = dropH; });
            
            db.collection("yazilar").orderBy("tarih","desc").get().then(snap=>{ let h=""; let dropH=""; snap.forEach(d=>{ const y=d.data(); const link="ebeveyn-kosesi.html"; h+=createRow(y.baslik, d.id, 'yazilar', link, 'YAZI'); dropH += `<div style="display:flex; justify-content:space-between; padding:5px; border-bottom:1px solid #eee;"><span>${y.baslik}</span><button onclick="vitrinGuncelle('yazi', '${escapeStr(y.baslik)}', '${link}')" style="background:#f59e0b; color:white; border:none; padding:3px 8px; border-radius:5px; cursor:pointer;">SEÃ‡</button></div>`; }); document.getElementById('ozel-yazi-listesi').innerHTML=h || 'YazÄ± yok.'; document.getElementById('dropdown-yazilar').innerHTML = dropH || 'YazÄ± yok.'; });

            db.collection("tavsiyeler").orderBy("tarih","desc").onSnapshot(s=>{ let h=""; s.forEach(d=>{ const t=d.data(); h+=createRow(t.baslik, d.id, 'tavsiyeler', t.link, 'TAVSÄ°YE'); }); document.getElementById('list-tavsiyeler').innerHTML=h; });
            db.collection("duyurular").onSnapshot(s=>{ let h=""; s.forEach(d=>h+=`<div class="list-item">${d.data().metin} <button class="btn-mini bg-sil" onclick="sil('duyurular','${d.id}')">Sil</button></div>`); document.getElementById('list-duyurular').innerHTML=h; });
            db.collection("site_ayarlari").doc("ozel_duyuru").get().then(d=>{ if(d.exists) { const v=d.data(); document.getElementById('set-active').checked=v.aktif; document.getElementById('set-text').value=v.daireMetni; document.getElementById('set-media').value=v.link; document.getElementById('set-msg').value=v.mesaj; document.getElementById('set-shape').value=v.sekil; document.getElementById('set-color').value=v.renk; updateButtonPreview(); } });
            db.collection("site_ayarlari").doc("robot").get().then(d=>{ if(d.exists) { document.getElementById('api-key').value=d.data().apiKey; document.getElementById('robot-prompt').value=d.data().prompt; } });
        }

        function yazilariGetirOzel() { /* YukarÄ±da entegre edildi */ }
        function renderList() { tumIceriklerCache.sort((a,b)=>(b.tarih?.seconds||0)-(a.tarih?.seconds||0)); let h=""; tumIceriklerCache.forEach(i => { h += createRow(i.baslik, i.id, i.col, i.link, i.type); }); document.getElementById('tum-icerik-listesi').innerHTML = h || 'Ä°Ã§erik yok.'; }
        function vitrinYap(col, id, baslik, link) { const fullLink = formatLink(link); db.collection(col).doc(id).update({ vitrin: true }); db.collection("site_ayarlari").doc("haftanin_oyunu").set({ baslik, url: fullLink }).then(() => showToast("â­ Vitrine Eklendi!")); }
        function daireYap(baslik, link) { const fullLink = formatLink(link); document.getElementById('set-text').value="YENÄ°"; document.getElementById('set-media').value=fullLink; document.getElementById('set-msg').value=baslik; showToast("â­• Ayarlara Ã‡ekildi (Kaydet'e bas!)"); updateButtonPreview(); }
        function daireKaydet() { db.collection("site_ayarlari").doc("ozel_duyuru").set({ aktif: document.getElementById('set-active').checked, daireMetni: document.getElementById('set-text').value, link: document.getElementById('set-media').value, renk: document.getElementById('set-color').value, sekil: document.getElementById('set-shape').value, mesaj: document.getElementById('set-msg').value, anim: "anim-pulse" }).then(()=>showToast("âœ… Buton Kaydedildi!")); }
        function sil(col, id) { if(confirm("Silinecek?")) db.collection(col).doc(id).delete().then(()=>{ showToast("ğŸ—‘ Silindi"); verileriYukle(); if(col==='yazilar') yazilariGetirOzel(); }); }
        function kitapKaydet() { db.collection("kitaplar").add({ baslik:document.getElementById('k-baslik').value, altBaslik:document.getElementById('k-alt').value, link:document.getElementById('k-link').value, renk:document.getElementById('k-renk').value, sira:parseInt(document.getElementById('k-sira').value), tarih:firebase.firestore.FieldValue.serverTimestamp() }).then(()=>{showToast("Kitap Eklendi"); kitaplariGetir();}); }
        function kitaplariGetir() { db.collection("kitaplar").orderBy("sira","desc").get().then(snap=>{ let h=""; snap.forEach(d=>{const k=d.data(); h+=createRow(k.baslik,d.id,'kitaplar',k.link,'KÄ°TAP')}); document.getElementById('kitap-listesi').innerHTML=h; }); }
        function duyuruEkle() { db.collection("duyurular").add({ metin: document.getElementById('d-metin').value, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>showToast("Duyuru Eklendi")); }
        function tavsiyeEkle() { db.collection("tavsiyeler").add({ baslik: document.getElementById('t-baslik').value, link: document.getElementById('t-link').value, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>showToast("Tavsiye Eklendi")); }
        function robotKaydet() { db.collection("site_ayarlari").doc("robot").set({ apiKey: document.getElementById('api-key').value, prompt: document.getElementById('robot-prompt').value }, {merge:true}).then(()=>showToast("Robot AyarlandÄ±")); }
        function updateButtonPreview() { const btn=document.getElementById('demo-btn'); btn.style.background=document.getElementById('set-color').value; btn.className=`demo-btn ${document.getElementById('set-shape').value} anim-pulse`; document.getElementById('demo-text').innerText=document.getElementById('set-text').value; }
        function testLink() { window.open(document.getElementById('set-media').value, '_blank'); }
        function icerikFiltrele() { const v=document.getElementById('search-content').value.toLowerCase(); document.querySelectorAll('#tum-icerik-listesi .list-item').forEach(i=>i.style.display=i.innerText.toLowerCase().includes(v)?'flex':'none'); }
        function istatistikGetir() { db.collection("istatistik").get().then(snap => { let g=0, a=0, t=0; const bugun=new Date().toISOString().split('T')[0]; const ay=bugun.substring(0,7); snap.forEach(d => { const s=d.data().ziyaret||0; t+=s; if(d.id.startsWith(ay)) a+=s; if(d.id===bugun) g=s; }); document.getElementById('stat-today').innerText=g; document.getElementById('stat-month').innerText=a; document.getElementById('stat-total').innerText=t; }); }
        function mesajlariGetir() { db.collection("iletisim_talepleri").orderBy("tarih","desc").onSnapshot(s=>{ let h=""; document.getElementById('msg-badge').innerText=s.size; document.getElementById('msg-badge').style.display=s.size>0?'inline':'none'; s.forEach(d=>{ const m=d.data(); let btn = ""; if(m.email) { btn = `<a href="mailto:${m.email}?subject=Cevap: ${m.konu}" class="btn-mini bg-cevap">âœ‰ï¸ Mail</a>`; } else if(m.telefon) { const tel = m.telefon.replace(/[^0-9]/g, ''); const cleanTel = tel.startsWith('90') ? tel : '90' + tel; const autoMsg = `Merhaba, ben BarÄ±ÅŸ Ã–ÄŸretmen. "${m.konu}" hakkÄ±nda gÃ¶nderdiÄŸiniz talep Ã¼zerine yazÄ±yorum. Size nasÄ±l yardÄ±mcÄ± olabilirim?`; btn = `<a href="https://wa.me/${cleanTel}?text=${encodeURIComponent(autoMsg)}" target="_blank" class="btn-mini bg-wa">ğŸ“ WA</a>`; } h+=`<div class="list-item"><div><b>${m.ad_soyad}</b><br><small>${m.konu}</small></div><div class="action-btns">${btn}<button class="btn-mini bg-sil" onclick="sil('iletisim_talepleri','${d.id}')">Sil</button></div></div>`; }); document.getElementById('mesaj-listesi').innerHTML=h; }); }
        function enYeniOyunGetir() { db.collection("projeler").orderBy("tarih","desc").limit(1).get().then(s=>{if(!s.empty){const d=s.docs[0].data(); daireYap(d.baslik,d.link);}else{alert("Oyun yok");}}); }
        function enYeniHerseyGetir() { if(tumIceriklerCache.length>0) { const y=tumIceriklerCache[0]; daireYap(y.baslik,y.link); } else { alert("Ä°Ã§erik yok"); } }
    </script>
</body>
</html>
