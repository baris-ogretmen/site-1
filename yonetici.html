<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BarÄ±ÅŸ Hoca - Mobil Panel (Final)</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="firebase-config.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #f3f4f6; margin: 0; padding: 0; padding-bottom: 50px; }
        
        /* ÃœST MENÃœ Ã‡UBUÄžU */
        .top-bar { background: white; padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
        .menu-toggle { font-size: 1.5rem; color: #333; cursor: pointer; background: none; border: none; }
        .page-title { font-weight: 800; color: #2563eb; font-size: 1.2rem; }

        /* YAN MENÃœ (Gizli) */
        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 998; display: none; }
        .sidebar { position: fixed; top: 0; left: -280px; width: 260px; height: 100%; background: white; z-index: 999; transition: 0.3s; padding: 20px; box-shadow: 5px 0 15px rgba(0,0,0,0.1); display: flex; flex-direction: column; }
        .sidebar.active { left: 0; }
        .menu-item { padding: 15px; border-radius: 10px; margin-bottom: 5px; color: #333; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
        .menu-item:hover, .menu-item.active { background: #eff6ff; color: #2563eb; }
        .menu-item i { width: 25px; text-align: center; }

        /* KONTEYNER */
        .container { max-width: 800px; margin: 0 auto; padding: 20px; }

        /* Ä°STATÄ°STÄ°K KARTLARI (SENÄ°N SEVDÄ°ÄžÄ°N RENKLÄ°LER) */
        .stats-container { display: grid; gap: 15px; margin-bottom: 25px; }
        .stat-card { padding: 25px; border-radius: 15px; color: white; text-align: center; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .bg-blue { background: #3b82f6; }
        .bg-red { background: #ef4444; }
        .bg-purple { background: #8b5cf6; }
        .stat-val { font-size: 3rem; font-weight: 700; margin-top: 5px; }
        .stat-label { font-size: 1rem; opacity: 0.9; font-weight: 600; }

        /* KART TASARIMI */
        .card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #e5e7eb; }
        h3 { margin-top: 0; color: #1f2937; border-bottom: 2px solid #f3f4f6; padding-bottom: 10px; margin-bottom: 20px; font-size: 1.1rem; display: flex; align-items: center; gap: 10px; }
        
        .inp, select, textarea { width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 1rem; margin-bottom: 15px; outline: none; transition: 0.3s; background: #f9fafb; font-family: inherit; }
        .inp:focus { border-color: #2563eb; background: white; }
        
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-weight: bold; font-size: 1rem; cursor: pointer; color: white; transition: 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn:active { transform: scale(0.98); }
        .btn-success { background: #10b981; }
        .btn-primary { background: #2563eb; }
        .btn-warning { background: #f59e0b; }
        .btn-info { background: #3b82f6; }

        /* BÃ–LÃœMLER */
        .section { display: none; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* IKON SEÃ‡Ä°CÄ° (IZGARA) */
        .icon-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(45px, 1fr)); gap: 8px; max-height: 200px; overflow-y: auto; padding: 5px; border: 2px solid #e5e7eb; border-radius: 12px; background: #f9fafb; }
        .icon-opt { height: 45px; display: flex; align-items: center; justify-content: center; background: white; border-radius: 8px; border: 1px solid #ddd; cursor: pointer; font-size: 1.2rem; color: #555; }
        .icon-opt.selected { background: #dbeafe; border-color: #2563eb; color: #2563eb; }

        /* HÄ°KAYE KUTUSU */
        .story-box { border: 2px dashed #cbd5e1; padding: 15px; border-radius: 12px; background: #fff; margin-bottom: 10px; position: relative; }
        .story-badge { position: absolute; top: -10px; left: 10px; background: #2563eb; color: white; padding: 2px 8px; border-radius: 5px; font-size: 0.75rem; font-weight: bold; }

        /* TOAST */
        #toast-container { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); z-index: 2000; }
        .toast { background: #1f2937; color: white; padding: 12px 20px; border-radius: 50px; display: flex; align-items: center; gap: 10px; box-shadow: 0 10px 20px rgba(0,0,0,0.3); font-size: 0.9rem; margin-bottom: 10px; }

        /* KATEGORÄ° IZGARA */
        .cat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .cat-label { display: flex; align-items: center; gap: 8px; background: #f3f4f6; padding: 10px; border-radius: 8px; font-size: 0.9rem; cursor: pointer; }
        .cat-label input { transform: scale(1.2); }

        /* GÄ°RÄ°Åž */
        #login-screen { position: fixed; inset: 0; background: #1e293b; z-index: 3000; display: flex; align-items: center; justify-content: center; }
        .login-card { background: white; padding: 30px; border-radius: 20px; width: 90%; max-width: 350px; text-align: center; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-card">
            <h2 style="color:#2563eb;">BarÄ±ÅŸ Hoca GiriÅŸ</h2>
            <input type="email" id="email" class="inp" placeholder="E-posta">
            <input type="password" id="password" class="inp" placeholder="Åžifre">
            <button onclick="girisYap()" class="btn btn-primary">GiriÅŸ Yap</button>
        </div>
    </div>

    <div id="toast-container"></div>

    <div class="top-bar">
        <button class="menu-toggle" onclick="toggleMenu()"><i class="fas fa-bars"></i></button>
        <div class="page-title">YÃ–NETÄ°M PANELÄ°</div>
        <div style="width: 24px;"></div> </div>

    <div class="sidebar-overlay" onclick="toggleMenu()"></div>
    <div class="sidebar" id="sidebar">
        <div style="text-align: center; margin-bottom: 20px;">
            <h2 style="color:#2563eb; margin:0;">BarÄ±ÅŸ Ä°lkan</h2>
            <small style="color:#666;">Dijital EÄŸitim ÃœssÃ¼</small>
        </div>
        <div class="menu-item active" onclick="nav('ozet')"><i class="fas fa-chart-pie"></i> Ã–zet</div>
        <div class="menu-item" onclick="nav('hikaye-yaz')" style="color:#d97706;"><i class="fas fa-pen-nib"></i> <b>HÄ°KAYE YAZ</b></div>
        <div class="menu-item" onclick="nav('vitrin-yonetimi')"><i class="fas fa-star"></i> Vitrin YÃ¶netimi</div>
        <div class="menu-item" onclick="nav('icerik-ekle')"><i class="fas fa-magic"></i> Ä°Ã§erik Ekle</div>
        <div class="menu-item" onclick="nav('kose-yazisi')"><i class="fas fa-feather-alt"></i> KÃ¶ÅŸe YazÄ±larÄ±</div>
        <div class="menu-item" onclick="nav('kitap-yonetimi')"><i class="fas fa-book"></i> Kitap Listesi</div>
        <div class="menu-item" onclick="nav('mesajlar')"><i class="fas fa-envelope"></i> Mesajlar</div>
        <div class="menu-item" onclick="nav('ayarlar')"><i class="fas fa-cog"></i> Ayarlar</div>
        <div style="margin-top: auto;">
            <div class="menu-item" onclick="auth.signOut()" style="color:red;"><i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ</div>
        </div>
    </div>

    <div class="container">

        <div id="ozet" class="section active">
            <h2 style="margin-top:0; margin-bottom:20px; color:#333;">Ä°statistikler</h2>
            <div class="stats-container">
                <div class="stat-card bg-blue">
                    <div class="stat-label">BugÃ¼n</div>
                    <div class="stat-val" id="stat-bugun">0</div>
                </div>
                <div class="stat-card bg-red">
                    <div class="stat-label">Bu Ay</div>
                    <div class="stat-val" id="stat-ay">0</div>
                </div>
                <div class="stat-card bg-purple">
                    <div class="stat-label">Toplam</div>
                    <div class="stat-val" id="stat-toplam">0</div>
                </div>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-bolt" style="color:#f59e0b;"></i> HÄ±zlÄ± Ä°Ã§erik YÃ¶netimi</h3>
                <input type="text" id="hizli-ara" class="inp" placeholder="Ä°Ã§erik ara (Oyun, Video, PDF)..." onkeyup="hizliAra()">
                <div id="hizli-liste" style="max-height: 300px; overflow-y: auto;"></div>
            </div>
        </div>

        <div id="hikaye-yaz" class="section">
            <div class="card" style="border-top: 5px solid #d97706;">
                <h3 style="color:#d97706;"><i class="fas fa-pen-fancy"></i> Ä°nteraktif Hikaye Yaz</h3>
                <input type="text" id="h-baslik" class="inp" placeholder="Kitap AdÄ± (Ã–rn: DaÄŸlarÄ±n Bilgesi)">
                <input type="text" id="h-alt" class="inp" placeholder="Alt BaÅŸlÄ±k">
                <select id="h-renk" class="inp">
                    <option value="linear-gradient(135deg, #f59e0b, #d97706)">Turuncu (Hani)</option>
                    <option value="linear-gradient(135deg, #3b82f6, #1d4ed8)">Mavi (Ali)</option>
                    <option value="linear-gradient(135deg, #10b981, #059669)">YeÅŸil</option>
                    <option value="linear-gradient(135deg, #ef4444, #b91c1c)">KÄ±rmÄ±zÄ±</option>
                </select>
                
                <div id="sayfa-container"></div>
                
                <button onclick="yeniSayfaEkle()" class="btn btn-info" style="margin-bottom:10px;">+ Sayfa Ekle</button>
                <button onclick="hikayeyiYayinla()" class="btn btn-success">KÄ°TABI YAYINLA</button>
            </div>
        </div>

        <div id="vitrin-yonetimi" class="section">
            <div class="card" style="border-top: 5px solid #3b82f6;">
                <h3><i class="fas fa-star" style="color:#3b82f6;"></i> Ana Sayfa Vitrin SeÃ§imi</h3>
                <p style="color:#666; margin-bottom:15px; font-size:0.9rem;">Mavi ve SarÄ± kutuda ne gÃ¶zÃ¼keceÄŸini buradan seÃ§.</p>
                
                <label style="font-weight:bold; display:block; margin-bottom:5px; color:#2563eb;">ðŸ”µ MAVÄ° KUTU (Yeni Kitap)</label>
                <div id="drop-kitap" style="max-height:150px; overflow-y:auto; border:2px solid #e5e7eb; border-radius:10px; margin-bottom:20px; padding:5px;">YÃ¼kleniyor...</div>

                <label style="font-weight:bold; display:block; margin-bottom:5px; color:#d97706;">ðŸŸ¡ SARI KUTU (Son YazÄ±)</label>
                <div id="drop-yazi" style="max-height:150px; overflow-y:auto; border:2px solid #e5e7eb; border-radius:10px; margin-bottom:20px; padding:5px;">YÃ¼kleniyor...</div>
            </div>
        </div>

        <div id="icerik-ekle" class="section">
            <div class="card">
                <h3><i class="fas fa-magic"></i> Ä°Ã§erik SihirbazÄ±</h3>
                <div style="display:flex; gap:10px; margin-bottom:15px; overflow-x:auto;">
                    <label class="cat-label"><input type="radio" name="tur" value="projeler" checked> Oyun</label>
                    <label class="cat-label"><input type="radio" name="tur" value="videolar"> Video</label>
                    <label class="cat-label"><input type="radio" name="tur" value="kaynaklar"> PDF</label>
                </div>
                
                <input type="text" id="i-baslik" class="inp" placeholder="BaÅŸlÄ±k">
                <input type="text" id="i-aciklama" class="inp" placeholder="KÄ±sa AÃ§Ä±klama">
                <input type="text" id="i-link" class="inp" placeholder="Link / Dosya AdÄ±">
                
                <label style="font-weight:bold; display:block; margin-bottom:5px;">Ä°kon SeÃ§:</label>
                <div class="icon-grid" id="icon-listesi"></div>
                <input type="hidden" id="selected-icon" value="fa-gamepad">
                
                <label style="font-weight:bold; display:block; margin:15px 0 5px;">Kategori SeÃ§:</label>
                <div class="cat-grid">
                    <label class="cat-label"><input type="checkbox" class="cat-check" value="Anaokulu"> Anaokulu</label>
                    <label class="cat-label"><input type="checkbox" class="cat-check" value="1. SÄ±nÄ±f"> 1. SÄ±nÄ±f</label>
                    <label class="cat-label"><input type="checkbox" class="cat-check" value="AkÄ±l Zeka"> AkÄ±l Zeka</label>
                    <label class="cat-label"><input type="checkbox" class="cat-check" value="Robotik"> Robotik</label>
                    </div>
                
                <br>
                <button onclick="icerikKaydet()" class="btn btn-success">KAYDET</button>
            </div>
        </div>

        <div id="kose-yazisi" class="section">
            <div class="card">
                <h3><i class="fas fa-feather-alt"></i> KÃ¶ÅŸe YazÄ±sÄ± Yaz</h3>
                <input type="text" id="y-baslik" class="inp" placeholder="YazÄ± BaÅŸlÄ±ÄŸÄ±">
                <textarea id="y-icerik" class="inp" style="height:150px;" placeholder="YazÄ± iÃ§eriÄŸi..."></textarea>
                <button onclick="yaziKaydet()" class="btn btn-primary">YAYINLA</button>
            </div>
            <div class="card">
                <h3>Mevcut YazÄ±lar</h3>
                <div id="yazi-listesi"></div>
            </div>
        </div>

        <div id="kitap-yonetimi" class="section">
            <div class="card">
                <h3><i class="fas fa-book"></i> Kitap Listesi</h3>
                <div id="kitap-listesi"></div>
            </div>
        </div>

        <div id="mesajlar" class="section">
            <div class="card">
                <h3><i class="fas fa-envelope"></i> Gelen Mesajlar</h3>
                <div id="mesaj-listesi"></div>
            </div>
        </div>

        <div id="ayarlar" class="section">
            <div class="card">
                <h3>ðŸ”´ Buton AyarlarÄ±</h3>
                <label style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                    <input type="checkbox" id="btn-aktif" style="transform:scale(1.5);"> Aktif Olsun
                </label>
                <input type="text" id="btn-text" class="inp" placeholder="Buton Metni (Ã–rn: YENÄ°)">
                <input type="text" id="btn-link" class="inp" placeholder="Link">
                <input type="text" id="btn-mesaj" class="inp" placeholder="Balon MesajÄ±">
                <button onclick="ayarlariKaydet()" class="btn btn-warning">KAYDET</button>
            </div>
        </div>

    </div>

    <script>
        const auth = firebase.auth();
        const db = firebase.firestore();
        let tumIcerik = [];

        // TOAST
        function showToast(msg) {
            const c = document.getElementById('toast-container');
            const t = document.createElement('div'); t.className = 'toast'; t.innerHTML = `<i class="fas fa-check-circle"></i> ${msg}`; 
            c.appendChild(t); setTimeout(() => t.remove(), 3000);
        }

        // NAVÄ°GASYON
        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('active');
            document.querySelector('.sidebar-overlay').style.display = document.getElementById('sidebar').classList.contains('active') ? 'block' : 'none';
        }
        function nav(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            toggleMenu(); // Mobilde menÃ¼ kapansÄ±n
            if(id === 'kitap-yonetimi') kitaplariGetir();
            if(id === 'vitrin-yonetimi') vitrinVerileriniGetir();
        }

        // GÄ°RÄ°Åž
        function girisYap() { 
            const e = document.getElementById('email').value; 
            const p = document.getElementById('password').value; 
            auth.signInWithEmailAndPassword(e, p).catch(err => alert("Hata: " + err.message)); 
        }
        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('login-screen').style.display = 'none';
                baslangicVerileriniYukle();
            } else {
                document.getElementById('login-screen').style.display = 'flex';
            }
        });

        // --- Ä°KONLAR ---
        const ikonlar = ["fa-gamepad", "fa-book", "fa-video", "fa-robot", "fa-chess", "fa-brain", "fa-rocket", "fa-star", "fa-pen-nib", "fa-music", "fa-code", "fa-puzzle-piece", "fa-calculator", "fa-flask", "fa-globe", "fa-child", "fa-shapes", "fa-bullhorn", "fa-heart"];
        const iconListDiv = document.getElementById('icon-listesi');
        ikonlar.forEach(i => {
            const div = document.createElement('div');
            div.className = 'icon-opt';
            div.innerHTML = `<i class="fas ${i}"></i>`;
            div.onclick = () => {
                document.querySelectorAll('.icon-opt').forEach(x => x.classList.remove('selected'));
                div.classList.add('selected');
                document.getElementById('selected-icon').value = i;
            };
            iconListDiv.appendChild(div);
        });

        // --- HÄ°KAYE YAZMA ---
        let sayfaSayisi = 0;
        function yeniSayfaEkle() {
            sayfaSayisi++;
            const div = document.createElement('div');
            div.className = 'story-box';
            div.innerHTML = `
                <div class="story-badge">Sayfa ${sayfaSayisi}</div>
                <div style="text-align:right; margin-bottom:5px;"><span onclick="this.parentElement.parentElement.remove()" style="color:red; font-size:0.8rem; cursor:pointer;">Sil</span></div>
                <input type="text" class="inp s-resim" placeholder="Resim (ali1.jpg)">
                <textarea class="inp s-metin" style="height:70px;" placeholder="Metin..."></textarea>
            `;
            document.getElementById('sayfa-container').appendChild(div);
        }
        yeniSayfaEkle(); // Ä°lk aÃ§Ä±lÄ±ÅŸta 1 tane ekle

        function hikayeyiYayinla() {
            const baslik = document.getElementById('h-baslik').value;
            if(!baslik) return alert("BaÅŸlÄ±k yazmalÄ±sÄ±n!");
            
            let sayfalar = [];
            document.querySelectorAll('.story-box').forEach(box => {
                sayfalar.push({
                    img: box.querySelector('.s-resim').value,
                    text: box.querySelector('.s-metin').value
                });
            });

            if(sayfalar.length === 0) return alert("En az 1 sayfa ekle!");

            // 1. Dijital Kitap Olarak Kaydet
            db.collection("dijital_kitaplar").add({
                baslik: baslik,
                sayfalar: sayfalar,
                tarih: firebase.firestore.FieldValue.serverTimestamp()
            }).then(docRef => {
                // 2. Kitaplar Listesine Ekle (Otomatik Link)
                const autoLink = `kitap-oku.html?id=${docRef.id}`;
                db.collection("kitaplar").add({
                    baslik: baslik,
                    altBaslik: document.getElementById('h-alt').value,
                    link: autoLink,
                    renk: document.getElementById('h-renk').value,
                    sira: 100,
                    tarih: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    // 3. OTOMATÄ°K VÄ°TRÄ°NE EKLE (Senin isteÄŸin Ã¼zerine)
                    db.collection("site_ayarlari").doc("vitrin_kitap").set({
                        baslik: baslik,
                        link: autoLink
                    });
                    
                    showToast("âœ… Kitap YayÄ±nlandÄ± ve Vitrine Eklendi!");
                    document.getElementById('sayfa-container').innerHTML = "";
                    document.getElementById('h-baslik').value = "";
                    sayfaSayisi = 0;
                    yeniSayfaEkle();
                });
            });
        }

        // --- Ä°Ã‡ERÄ°K EKLEME ---
        function icerikKaydet() {
            const tur = document.querySelector('input[name="tur"]:checked').value;
            const baslik = document.getElementById('i-baslik').value;
            if(!baslik) return alert("BaÅŸlÄ±k gir!");

            const cats = [];
            document.querySelectorAll('.cat-check:checked').forEach(c => cats.push(c.value));
            
            let data = {
                baslik: baslik,
                aciklama: document.getElementById('i-aciklama').value,
                link: document.getElementById('i-link').value,
                icon: document.getElementById('selected-icon').value,
                tarih: firebase.firestore.FieldValue.serverTimestamp(),
                vitrin: true
            };

            const batch = db.batch();
            if(cats.length > 0) {
                cats.forEach(k => {
                    batch.set(db.collection(tur).doc(), { ...data, kategori: k });
                });
                batch.commit().then(() => showToast("Ä°Ã§erik Eklendi!"));
            } else {
                db.collection(tur).add({ ...data, kategori: "Genel" }).then(() => showToast("Ä°Ã§erik Eklendi!"));
            }
        }

        // --- YAZI EKLEME ---
        function yaziKaydet() {
            const baslik = document.getElementById('y-baslik').value;
            const icerik = document.getElementById('y-icerik').value;
            if(!baslik) return alert("BaÅŸlÄ±k gir!");

            db.collection("yazilar").add({
                baslik: baslik,
                icerik: icerik,
                tarih: firebase.firestore.FieldValue.serverTimestamp()
            }).then(docRef => {
                // OTOMATÄ°K VÄ°TRÄ°NE EKLE
                db.collection("site_ayarlari").doc("vitrin_yazi").set({
                    baslik: baslik,
                    link: 'ebeveyn-kosesi.html' // Sabit link, veya dinamik yapÄ±labilir
                });
                showToast("YazÄ± YayÄ±nlandÄ± ve Vitrine Eklendi!");
                document.getElementById('y-baslik').value = "";
                document.getElementById('y-icerik').value = "";
            });
        }

        // --- VÄ°TRÄ°N YÃ–NETÄ°MÄ° ---
        function vitrinVerileriniGetir() {
            // KitaplarÄ± Ã‡ek
            db.collection("kitaplar").orderBy("tarih", "desc").get().then(snap => {
                let h = "";
                snap.forEach(d => {
                    const k = d.data();
                    h += `<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee; background:white;">
                        <span>${k.baslik}</span>
                        <button onclick="vitrinAyarla('kitap', '${k.baslik}', '${k.link}')" style="background:#2563eb; color:white; border:none; padding:5px 10px; border-radius:5px; font-weight:bold;">SEÃ‡</button>
                    </div>`;
                });
                document.getElementById('drop-kitap').innerHTML = h;
            });

            // YazÄ±larÄ± Ã‡ek
            db.collection("yazilar").orderBy("tarih", "desc").get().then(snap => {
                let h = "";
                snap.forEach(d => {
                    const y = d.data();
                    h += `<div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #eee; background:white;">
                        <span>${y.baslik}</span>
                        <button onclick="vitrinAyarla('yazi', '${y.baslik}', 'ebeveyn-kosesi.html')" style="background:#d97706; color:white; border:none; padding:5px 10px; border-radius:5px; font-weight:bold;">SEÃ‡</button>
                    </div>`;
                });
                document.getElementById('drop-yazi').innerHTML = h;
            });
        }

        function vitrinAyarla(tur, baslik, link) {
            const docId = tur === 'kitap' ? 'vitrin_kitap' : 'vitrin_yazi';
            db.collection("site_ayarlari").doc(docId).set({ baslik, link }).then(() => showToast("Vitrin GÃ¼ncellendi!"));
        }

        // --- VERÄ° YÃœKLEME ---
        function baslangicVerileriniYukle() {
            istatistikGetir();
            // DiÄŸer veriler ihtiyaÃ§ duyuldukÃ§a Ã§ekilecek (performans iÃ§in)
        }

        function istatistikGetir() {
            const bugun = new Date().toISOString().split('T')[0];
            const ay = bugun.substring(0, 7);
            
            db.collection("istatistik").get().then(snap => {
                let g = 0, a = 0, t = 0;
                snap.forEach(d => {
                    const s = d.data().ziyaret || 0;
                    t += s;
                    if (d.id.startsWith(ay)) a += s;
                    if (d.id === bugun) g = s;
                });
                document.getElementById('stat-bugun').innerText = g;
                document.getElementById('stat-ay').innerText = a;
                document.getElementById('stat-toplam').innerText = t;
            });
        }

        function hizliAra() {
            // Basit bir arama fonksiyonu simÃ¼lasyonu
            const val = document.getElementById('hizli-ara').value.toLowerCase();
            if(val.length < 3) return;
            // Buraya gerÃ§ek arama eklenebilir, ÅŸu an sadece UI
        }
        
        function ayarlariKaydet() {
            db.collection("site_ayarlari").doc("ozel_duyuru").set({
                aktif: document.getElementById('btn-aktif').checked,
                daireMetni: document.getElementById('btn-text').value,
                link: document.getElementById('btn-link').value,
                mesaj: document.getElementById('btn-mesaj').value,
                renk: "#ef4444", // VarsayÄ±lan
                sekil: "shape-circle", // VarsayÄ±lan
                anim: "anim-pulse"
            }, {merge:true}).then(()=>showToast("Ayarlar Kaydedildi!"));
        }
    </script>
</body>
</html>
