<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YÃ¶netici Paneli | BarÄ±ÅŸ Ä°lkan</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f1f5f9; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #2563eb; margin-bottom: 20px; }
        
        /* ZÄ°YARETÃ‡Ä° KARTI STÄ°LÄ° */
        .stat-card {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.3);
        }
        .stat-count { font-size: 3.5rem; font-weight: 800; line-height: 1; margin: 10px 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        .stat-label { font-size: 1rem; opacity: 0.9; text-transform: uppercase; letter-spacing: 1px; }

        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #475569; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #cbd5e1; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #2563eb; color: white; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; transition: 0.3s; }
        button:hover { background: #1e40af; }
        .message { margin-top: 15px; padding: 15px; border-radius: 8px; display: none; text-align: center; font-weight: bold; }
        .success { background: #dcfce7; color: #166534; border: 1px solid #166534; }
        .error { background: #fee2e2; color: #991b1b; border: 1px solid #991b1b; }
        .tab-buttons { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        .tab-btn { flex: 1; background: #e2e8f0; color: #333; border: none; padding: 10px; cursor: pointer; border-radius: 8px; font-weight: 600; font-size: 0.9rem; }
        .tab-btn.active { background: #2563eb; color: white; }
        
        /* Mesaj KartÄ± Stilleri */
        .msg-card { background: #fff; border: 1px solid #e2e8f0; border-left: 5px solid #FFD700; padding: 15px; border-radius: 10px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .msg-header { display: flex; justify-content: space-between; font-size: 0.85rem; color: #94a3b8; margin-bottom: 8px; }
        .msg-name { font-weight: bold; color: #1e293b; font-size: 1.1rem; }
        .msg-phone { color: #64748b; font-size: 0.9rem; margin-bottom: 10px; }
        .msg-content { background: #f8fafc; padding: 10px; border-radius: 6px; font-size: 0.95rem; color: #334155; margin-bottom: 12px; border: 1px dashed #cbd5e1; }
        .msg-actions { display: flex; gap: 10px; }
        .btn-wa { background: #22c55e; color: white; text-decoration: none; padding: 10px; border-radius: 6px; flex: 2; text-align: center; font-weight: bold; font-size: 0.9rem; display: flex; align-items: center; justify-content: center; gap: 5px; }
        .btn-del { background: #ef4444; color: white; border: none; padding: 10px; border-radius: 6px; flex: 1; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div class="container">
        <div class="stat-card">
            <div class="stat-label"><i class="fas fa-users"></i> BugÃ¼n Gelen ZiyaretÃ§i</div>
            <div class="stat-count" id="ziyaret-sayisi">0</div>
            <div style="font-size:0.8rem; opacity:0.7;" id="tarih-goster">...</div>
        </div>

        <h2><i class="fas fa-user-cog"></i> YÃ¶netici Paneli</h2>
        
        <div class="tab-buttons">
            <button class="tab-btn active" id="btn-proje" onclick="tabDegis('proje')"><i class="fas fa-code"></i> Proje Ekle</button>
            <button class="tab-btn" id="btn-duyuru" onclick="tabDegis('duyuru')"><i class="fas fa-bullhorn"></i> Duyuru Ekle</button>
            <button class="tab-btn" id="btn-mesaj" onclick="tabDegis('mesaj')" style="background: #FFD700; color: #000;"><i class="fas fa-envelope"></i> Gelen Mesajlar</button>
        </div>

        <div id="proje-formu">
            <h3 style="color:#475569; margin-top:0;">Yeni Proje / Oyun Ekle</h3>
            <div class="form-group"><label>Proje BaÅŸlÄ±ÄŸÄ±</label><input type="text" id="p-baslik" placeholder="Ã–rn: BeyazÄ±t Bellek Oyunu"></div>
            <div class="form-group"><label>AÃ§Ä±klama</label><textarea id="p-aciklama" rows="3" placeholder="Proje hakkÄ±nda kÄ±sa bilgi..."></textarea></div>
            <div class="form-group"><label>Link (Dosya AdÄ±)</label><input type="text" id="p-link" placeholder="Ã–rn: beyazit.html"></div>
            <div class="form-group"><label>Ä°kon SeÃ§</label>
                <select id="p-icon">
                    <option value="fa-brain">ğŸ§  Beyin (Zeka)</option>
                    <option value="fa-trophy">ğŸ† Kupa (YarÄ±ÅŸma)</option>
                    <option value="fa-gamepad">ğŸ® Oyun</option>
                    <option value="fa-chess-knight">â™ SatranÃ§</option>
                    <option value="fa-puzzle-piece">ğŸ§© Dikkat</option>
                    <option value="fa-robot">ğŸ¤– Robotik</option>
                </select>
            </div>
            <button onclick="projeEkle()">Projeyi VeritabanÄ±na Kaydet</button>
        </div>

        <div id="duyuru-formu" style="display:none;">
            <h3 style="color:#475569; margin-top:0;">Kayan YazÄ± Ekle</h3>
            <div class="form-group"><label>Duyuru Metni</label><input type="text" id="d-metin" placeholder="Kayan bantta ne yazsÄ±n?"></div>
            <button onclick="duyuruEkle()">Duyuruyu VeritabanÄ±na Kaydet</button>
        </div>

        <div id="mesaj-formu" style="display:none;">
            <h3 style="color:#475569; margin-top:0;">Gelen Ä°letiÅŸim Talepleri</h3>
            <div id="mesaj-listesi"><div style="text-align:center; color:#999;">Mesajlar yÃ¼kleniyor...</div></div>
        </div>

        <div id="mesaj-kutusu" class="message"></div>
    </div>

    <script>
        const db = firebase.firestore();

        // --- ZÄ°YARETÃ‡Ä° SAYISINI Ã‡EKME ---
        const bugunStr = new Date().toISOString().split('T')[0];
        document.getElementById('tarih-goster').innerText = new Date().toLocaleDateString('tr-TR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        
        db.collection("istatistik").doc(bugunStr).onSnapshot(doc => {
            if (doc.exists) {
                // Animasyonlu sayÄ± artÄ±ÅŸÄ± (0'dan yukarÄ±)
                const hedef = doc.data().ziyaret;
                document.getElementById('ziyaret-sayisi').innerText = hedef;
            } else {
                document.getElementById('ziyaret-sayisi').innerText = 0;
            }
        });

        function tabDegis(tip) {
            document.getElementById('proje-formu').style.display = 'none'; document.getElementById('duyuru-formu').style.display = 'none'; document.getElementById('mesaj-formu').style.display = 'none';
            document.getElementById('btn-proje').classList.remove('active'); document.getElementById('btn-duyuru').classList.remove('active'); document.getElementById('btn-mesaj').classList.remove('active');
            document.getElementById('btn-mesaj').style.background = '#FFD700'; document.getElementById('btn-mesaj').style.color = '#000';
            document.getElementById(tip + '-formu').style.display = 'block';
            if (tip === 'mesaj') { document.getElementById('btn-mesaj').style.background = '#d97706'; document.getElementById('btn-mesaj').style.color = '#fff'; } else { document.getElementById('btn-' + tip).classList.add('active'); }
        }

        function projeEkle() {
            const b = document.getElementById('p-baslik').value; const l = document.getElementById('p-link').value;
            if(!b || !l) { gosterMesaj("Hata: BaÅŸlÄ±k ve Link boÅŸ olamaz!", "error"); return; }
            db.collection("projeler").add({ baslik: b, aciklama: document.getElementById('p-aciklama').value, link: l, icon: document.getElementById('p-icon').value, tarih: firebase.firestore.FieldValue.serverTimestamp() })
            .then(() => { gosterMesaj("Tebrikler! Proje baÅŸarÄ±yla buluta kaydedildi.", "success"); document.querySelectorAll('#proje-formu input, #proje-formu textarea').forEach(i => i.value = ""); })
            .catch((error) => { gosterMesaj("Hata OluÅŸtu: " + error.message, "error"); });
        }

        function duyuruEkle() {
            const m = document.getElementById('d-metin').value; if(!m) return;
            db.collection("duyurular").add({ metin: m, tarih: firebase.firestore.FieldValue.serverTimestamp() })
            .then(() => { gosterMesaj("Duyuru baÅŸarÄ±yla kaydedildi!", "success"); document.getElementById('d-metin').value = ""; })
            .catch((error) => { gosterMesaj("Hata: " + error.message, "error"); });
        }

        db.collection("iletisim_talepleri").orderBy("tarih", "desc").onSnapshot(snap => {
            const liste = document.getElementById('mesaj-listesi'); let html = "";
            if (snap.empty) { liste.innerHTML = "<div style='text-align:center; padding:20px; color:#999;'>ğŸ“­ HenÃ¼z yeni bir mesaj yok.</div>"; return; }
            snap.forEach(doc => {
                const veri = doc.data(); const tarih = veri.tarih ? new Date(veri.tarih.seconds * 1000).toLocaleString('tr-TR') : "Tarih Yok";
                const temizTel = veri.telefon.replace(/^0/, '').replace(/\s/g, '').replace(/-/g, '');
                html += `<div class="msg-card"><div class="msg-header"><span><i class="far fa-clock"></i> ${tarih}</span><span style="color:${veri.durum === 'bekliyor' ? '#f59e0b' : '#22c55e'}">â— Bekliyor</span></div><div class="msg-name">${veri.ad_soyad}</div><div class="msg-phone"><i class="fas fa-phone-alt"></i> ${veri.telefon}</div><div class="msg-content"><strong>Konu:</strong> ${veri.konu}</div><div class="msg-actions"><a href="https://wa.me/90${temizTel}?text=Merhaba ${veri.ad_soyad}, ben BarÄ±ÅŸ Ã–ÄŸretmen..." target="_blank" class="btn-wa"><i class="fab fa-whatsapp"></i> Onayla & Yaz</a><button onclick="talepSil('${doc.id}')" class="btn-del"><i class="fas fa-trash"></i> Sil</button></div></div>`;
            });
            liste.innerHTML = html;
        });

        function talepSil(id) { if(confirm("Bu mesajÄ± silmek istediÄŸine emin misin?")) { db.collection("iletisim_talepleri").doc(id).delete().then(() => { gosterMesaj("Mesaj silindi.", "success"); }); } }
        function gosterMesaj(metin, tip) { const k = document.getElementById('mesaj-kutusu'); k.innerText = metin; k.className = "message " + tip; k.style.display = "block"; setTimeout(() => { k.style.display = "none"; }, 5000); }
    </script>
</body>
</html>
