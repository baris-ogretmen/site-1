<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kitap Okuma</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="firebase-config.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { background: #2c3e50; font-family: 'Fredoka', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        .book-container { width: 95%; max-width: 1100px; height: 90vh; background: #fffbf0; border-radius: 20px; display: flex; box-shadow: 0 20px 50px rgba(0,0,0,0.5); border: 8px solid #5d4037; overflow: hidden; position: relative; }
        .text-area { flex: 1; padding: 40px; display: flex; flex-direction: column; justify-content: center; border-right: 3px dashed #d7ccc8; overflow-y: auto; position: relative; }
        .image-area { flex: 1; background: #fdf2e9; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .story-img { max-width: 100%; max-height: 90%; border-radius: 15px; border: 5px solid white; box-shadow: 5px 5px 15px rgba(0,0,0,0.2); }
        h1 { color: #d35400; font-family: 'Patrick Hand', cursive; font-size: 2.5rem; margin-bottom: 20px; }
        p { font-size: 1.4rem; line-height: 1.6; color: #444; }
        .nav-btn { position: absolute; bottom: 20px; padding: 10px 25px; font-size: 1.2rem; cursor: pointer; background: #ff9800; color: white; border: none; border-radius: 50px; font-family: 'Patrick Hand', cursive; z-index: 10; }
        #prev { left: 30px; } #next { right: 30px; }
        .page-num { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); font-family: 'Patrick Hand', cursive; color: #795548; font-weight: bold; }
        
        /* Loading */
        #loader { position: fixed; inset: 0; background: #2c3e50; color: white; display: flex; align-items: center; justify-content: center; z-index: 999; font-size: 2rem; }

        @media (max-width: 768px) {
            .book-container { flex-direction: column-reverse; height: 95vh; }
            .text-area { border-right: none; border-top: 2px dashed #ccc; padding: 20px; justify-content: flex-start; }
            .image-area { height: 40%; padding: 10px; }
            h1 { font-size: 1.5rem; margin-top: 0; } p { font-size: 1rem; }
            .nav-btn { bottom: 10px; padding: 8px 15px; font-size: 1rem; }
        }
    </style>
</head>
<body>

<div id="loader">Kitap Yükleniyor...</div>

<div class="book-container" id="book-content" style="display:none;">
    <div class="text-area">
        <h1 id="baslik"></h1>
        <p id="metin"></p>
    </div>
    <div class="image-area">
        <img id="resim" class="story-img" src="">
    </div>
    <button id="prev" class="nav-btn" onclick="sayfaDegistir(-1)">❮ Geri</button>
    <div class="page-num" id="sayfa-no"></div>
    <button id="next" class="nav-btn" onclick="sayfaDegistir(1)">İleri ❯</button>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const kitapID = urlParams.get('id');
    const RESIM_URL_PREFIX = "https://baris-ogretmen.github.io/site-1/"; // Resimlerin olduğu klasör

    if (!kitapID) {
        document.body.innerHTML = "<h1 style='color:white;text-align:center;'>Kitap Bulunamadı!</h1>";
    } else {
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        
        let SAYFALAR = [];
        let aktifSayfa = 0;

        db.collection("dijital_kitaplar").doc(kitapID).get().then(doc => {
            if (doc.exists) {
                const data = doc.data();
                SAYFALAR = data.sayfalar;
                document.title = data.baslik;
                
                document.getElementById('loader').style.display = 'none';
                document.getElementById('book-content').style.display = 'flex';
                sahneYukle(0);
            } else {
                document.body.innerHTML = "<h1 style='color:white;text-align:center;'>Bu kitap silinmiş!</h1>";
            }
        }).catch(err => {
            console.error(err);
            alert("Kitap yüklenirken hata oluştu.");
        });

        function sahneYukle(index) {
            const sayfa = SAYFALAR[index];
            document.getElementById('baslik').innerText = (index === 0) ? document.title : `Bölüm ${index + 1}`;
            document.getElementById('metin').innerText = sayfa.text;
            
            let imgLink = sayfa.img;
            if(!imgLink.startsWith('http')) imgLink = RESIM_URL_PREFIX + imgLink;
            
            document.getElementById('resim').src = imgLink;
            document.getElementById('sayfa-no').innerText = `${index + 1} / ${SAYFALAR.length}`;

            document.getElementById('prev').disabled = (index === 0);
            document.getElementById('next').disabled = (index === SAYFALAR.length - 1);
        }

        window.sayfaDegistir = function(yon) {
            const yeni = aktifSayfa + yon;
            if(yeni >= 0 && yeni < SAYFALAR.length) {
                aktifSayfa = yeni;
                sahneYukle(aktifSayfa);
            }
        }
    }
</script>
</body>
</html>
