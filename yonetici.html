<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kokpit | BarÄ±ÅŸ Ä°lkan</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="firebase-config.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Segoe+UI:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f8fafc; margin: 0; padding: 0; color:#1e293b; }
        
        /* GÄ°RÄ°Å EKRANI */
        #login-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #1e293b, #0f172a); display: flex; justify-content: center; align-items: center; z-index: 2000; }
        .login-box { background: white; padding: 40px; border-radius: 20px; width: 90%; max-width: 350px; text-align: center; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        .login-input { width: 100%; padding: 14px; margin: 10px 0; border: 2px solid #e2e8f0; border-radius: 10px; box-sizing: border-box; outline: none; transition:0.3s; }
        .login-input:focus { border-color: #2563eb; }
        .login-btn { width: 100%; padding: 14px; background: #2563eb; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; transition:0.3s; font-size:1rem; }
        .login-btn:hover { background: #1d4ed8; }
        
        /* PANEL */
        #admin-panel { display: none; max-width: 1000px; margin: 30px auto; padding: 0 20px 100px; }
        .header-bar { display:flex; justify-content:space-between; align-items:center; margin-bottom:25px; background:white; padding:20px 30px; border-radius:15px; box-shadow:0 10px 25px rgba(0,0,0,0.05); }
        .logout-btn { background: #ef4444; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight:bold; display:flex; align-items:center; gap:8px; }
        
        /* Ä°STATÄ°STÄ°K */
        .stat-card { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; padding: 30px; border-radius: 20px; text-align: center; margin-bottom: 30px; box-shadow: 0 15px 30px rgba(37, 99, 235, 0.25); position:relative; overflow:hidden; }
        .stat-card::after { content:''; position:absolute; top:-50%; left:-50%; width:200%; height:200%; background:rgba(255,255,255,0.1); transform:rotate(30deg); pointer-events:none; }
        .stat-number { font-size: 4rem; font-weight: 900; margin: 10px 0; line-height: 1; text-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        /* SEKMELER */
        .tab-buttons { display: flex; gap: 10px; margin-bottom: 25px; overflow-x: auto; padding-bottom: 10px; }
        .tab-btn { flex: 1; min-width: 130px; background: white; color: #64748b; border: 2px solid #e2e8f0; padding: 12px; cursor: pointer; border-radius: 12px; font-weight: 700; transition:0.3s; white-space: nowrap; display:flex; align-items:center; justify-content:center; gap:8px; }
        .tab-btn.active { background: #2563eb; color: white; border-color:#2563eb; box-shadow: 0 8px 20px rgba(37, 99, 235, 0.3); transform: translateY(-3px); }
        .tab-btn:hover:not(.active) { background: #f1f5f9; }
        
        /* KARTLAR */
        .panel-card { background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid #f1f5f9; animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }
        .panel-card h3 { margin-top: 0; color: #1e293b; border-bottom: 2px solid #f1f5f9; padding-bottom: 15px; font-size: 1.3rem; display:flex; align-items:center; gap:10px; }
        
        input, select, textarea { width: 100%; padding: 14px; border: 2px solid #e2e8f0; border-radius: 12px; box-sizing: border-box; margin-bottom: 15px; font-family: inherit; font-size: 0.95rem; transition: 0.3s; background: #f8fafc; }
        input:focus, select:focus, textarea:focus { border-color: #2563eb; outline: none; background: white; }
        label { font-weight: 700; font-size: 0.9rem; color: #475569; margin-bottom: 5px; display: block; }
        
        button.save-btn { width: 100%; padding: 15px; background: #10b981; color: white; border: none; border-radius: 12px; font-weight:bold; cursor: pointer; font-size: 1rem; transition: 0.3s; display:flex; align-items:center; justify-content:center; gap:10px; }
        button.save-btn:hover { background: #059669; transform: scale(1.02); box-shadow: 0 10px 20px rgba(16, 185, 129, 0.2); }
        
        /* LÄ°STE ELEMANLARI */
        .list-item { 
            display: flex; flex-direction: column; gap: 15px;
            padding: 15px; border-bottom: 1px solid #eee; background: #fff; margin-bottom: 15px; border-radius: 15px; border: 1px solid #e2e8f0; box-shadow: 0 4px 10px rgba(0,0,0,0.02);
        }
        @media (min-width: 600px) { .list-item { flex-direction: row; justify-content: space-between; align-items: center; } }
        
        .item-info { font-size: 1rem; color: #334155; display:flex; align-items:center; gap:10px; }
        .item-badge { font-size:0.75rem; background:#eff6ff; padding:4px 8px; border-radius:6px; color:#2563eb; font-weight:bold; border:1px solid #dbeafe; }
        
        .btn-mini { border: none; padding: 10px 15px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 0.9rem; text-decoration: none; display: inline-flex; align-items: center; justify-content: center; gap: 5px; transition: 0.2s; }
        .btn-mini:hover { transform: translateY(-2px); filter:brightness(1.1); }
        .btn-vitrin { background: #FFD700; color: #000; box-shadow: 0 4px 10px rgba(255, 215, 0, 0.3); }
        .btn-sil { background: #ef4444; color: white; box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3); }
        .btn-wa { background: #25D366; color: white; box-shadow: 0 4px 10px rgba(37, 211, 102, 0.3); }
        .btn-arsiv { background: #64748b; color: white; }
        
        .settings-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 25px; }
        .settings-box { border: 2px dashed #cbd5e1; padding: 25px; border-radius: 20px; background: #fff; }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-box">
            <h2 style="color:#2563eb; margin-bottom:20px;">KOKPÄ°T GÄ°RÄ°ÅÄ°</h2>
            <input type="email" id="email" class="login-input" placeholder="E-posta">
            <input type="password" id="password" class="login-input" placeholder="Åifre">
            <button onclick="girisYap()" class="login-btn">GiriÅŸ Yap</button>
            <div id="hata-mesaji" class="error-msg" style="display:none; color:red; margin-top:15px; font-weight:bold;">HatalÄ± GiriÅŸ!</div>
        </div>
    </div>

    <div id="admin-panel">
        <div class="header-bar">
            <div style="display:flex; align-items:center; gap:15px;">
                <div style="width:50px; height:50px; background:#eff6ff; border-radius:50%; display:flex; align-items:center; justify-content:center; color:#2563eb; font-size:1.5rem;"><i class="fas fa-rocket"></i></div>
                <div>
                    <h2 style="margin:0; color:#1e293b;">BarÄ±ÅŸ Hoca Paneli</h2>
                    <small style="color:#64748b;">YÃ¶netim ve Ä°letiÅŸim Merkezi</small>
                </div>
            </div>
            <button onclick="cikisYap()" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ</button>
        </div>

        <div class="stat-card">
            <div style="font-weight:700; opacity:0.9; letter-spacing:1px;">BUGÃœN GELEN ZÄ°YARETÃ‡Ä°</div>
            <div class="stat-number" id="ziyaret-sayisi">0</div>
        </div>

        <div class="tab-buttons">
            <button class="tab-btn active" id="btn-proje" onclick="tabDegis('proje')"><i class="fas fa-layer-group"></i> Projeler</button>
            <button class="tab-btn" id="btn-yazi" onclick="tabDegis('yazi')"><i class="fas fa-pen-nib"></i> YazÄ±lar</button>
            <button class="tab-btn" id="btn-tavsiye" onclick="tabDegis('tavsiye')"><i class="fas fa-star"></i> Tavsiyeler</button>
            <button class="tab-btn" id="btn-duyuru" onclick="tabDegis('duyuru')"><i class="fas fa-bullhorn"></i> Duyurular</button>
            <button class="tab-btn" id="btn-ayarlar" onclick="tabDegis('ayarlar')"><i class="fas fa-cog"></i> Ayarlar</button>
            <button class="tab-btn" id="btn-mesaj" onclick="tabDegis('mesaj')"><i class="fas fa-envelope"></i> Mesajlar <span id="msg-badge" style="display:none; background:red; color:white; padding:2px 6px; border-radius:50%; font-size:0.7rem;">0</span></button>
        </div>

        <div id="proje-formu" class="panel-card">
            <h3>ğŸ® Yeni Ä°Ã§erik Ekle & YÃ¶nlendir</h3>
            
            <label>Ä°Ã§erik BaÅŸlÄ±ÄŸÄ±</label>
            <input type="text" id="p-baslik" placeholder="Ã–rn: 8. SÄ±nÄ±f LGS KampÄ±">
            
            <div style="display: flex; gap: 15px; flex-wrap:wrap;">
                <div style="flex:2; min-width:250px;">
                    <label>YÃ¶nlenecek Link (Manuel)</label>
                    <input type="text" id="p-link" placeholder="https://... veya sayfa.html">
                </div>
                <div style="flex:1; min-width:250px;">
                    <label>HÄ±zlÄ± Sayfa SeÃ§ (Otomatik Doldur)</label>
                    <select onchange="document.getElementById('p-link').value = this.value" style="background:#fffbeb; font-weight:bold; color:#d97706;">
                        <option value="">SeÃ§iniz ğŸ”½</option>
                        <optgroup label="Okul Kademeleri">
                            <option value="anaokulu.html">Anaokulu</option>
                            <option value="ilkokul.html">Ä°lkokul</option>
                            <option value="ortaokul.html">Ortaokul (Genel)</option>
                            <option value="ortaokul-5.html">Ortaokul 5. SÄ±nÄ±f</option>
                            <option value="ortaokul-6.html">Ortaokul 6. SÄ±nÄ±f</option>
                            <option value="ortaokul-7.html">Ortaokul 7. SÄ±nÄ±f</option>
                            <option value="ortaokul-8.html">Ortaokul 8. SÄ±nÄ±f (LGS)</option>
                        </optgroup>
                        <optgroup label="Ã–zel Alanlar">
                            <option value="kocluk.html">LGS/YKS KoÃ§luk</option>
                            <option value="ozel-egitim.html">Ã–zel EÄŸitim</option>
                            <option value="dil-konusma.html">Dil ve KonuÅŸma</option>
                        </optgroup>
                        <optgroup label="AtÃ¶lyeler">
                            <option value="robotik.html">Robotik Kodlama</option>
                            <option value="akil-zeka.html">AkÄ±l Zeka OyunlarÄ±</option>
                            <option value="satranc.html">SatranÃ§</option>
                            <option value="sarkilar.html">ÅarkÄ±lar & MÃ¼zik</option>
                            <option value="ben-ali.html">Ben Ali KitabÄ±</option>
                        </optgroup>
                    </select>
                </div>
            </div>

            <div style="display:flex; gap:15px; flex-wrap:wrap;">
                <div style="flex:1;">
                    <label>Kategori</label>
                    <select id="p-kategori">
                        <option value="Genel">SeÃ§iniz...</option>
                        <option value="Anaokulu">ğŸ§¸ Anaokulu</option>
                        <option value="Ä°lkokul">ğŸ« Ä°lkokul</option>
                        <option value="Ortaokul">ğŸ“š Ortaokul</option>
                        <option value="LGS KoÃ§luk">ğŸ¯ KoÃ§luk & SÄ±nav</option>
                        <option value="AkÄ±l Zeka">ğŸ§  AkÄ±l Zeka</option>
                        <option value="Robotik">ğŸ¤– Robotik</option>
                        <option value="SatranÃ§">â™ SatranÃ§</option>
                        <option value="Ã–zel EÄŸitim">ğŸ§© Ã–zel EÄŸitim</option>
                    </select>
                </div>
                <div style="flex:1;">
                    <label>Ä°kon</label>
                    <select id="p-icon">
                        <option value="fa-star">â­ YÄ±ldÄ±z</option>
                        <option value="fa-gamepad">ğŸ® Oyun</option>
                        <option value="fa-book">ğŸ“– Kitap</option>
                        <option value="fa-robot">ğŸ¤– Robot</option>
                        <option value="fa-brain">ğŸ§  Beyin/Zeka</option>
                        <option value="fa-chess">â™ SatranÃ§</option>
                        <option value="fa-music">ğŸµ MÃ¼zik</option>
                        <option value="fa-video">ğŸ¥ Video</option>
                        <option value="fa-calculator">ğŸ§® Matematik</option>
                        <option value="fa-flask">ğŸ§ª Fen Bilimleri</option>
                        <option value="fa-pencil-alt">âœï¸ Kalem/YazÄ±</option>
                        <option value="fa-laptop-code">ğŸ’» Kodlama</option>
                        <option value="fa-puzzle-piece">ğŸ§© Yapboz</option>
                    </select>
                </div>
            </div>

            <button onclick="projeEkle()" class="save-btn"><i class="fas fa-save"></i> Projeyi Kaydet</button>
            
            <div style="margin-top:40px;">
                <h4 style="border-bottom:2px solid #eee; padding-bottom:10px; color:#64748b;">ğŸ“‚ Mevcut Ä°Ã§erik Listesi</h4>
                <div id="list-projeler"></div>
            </div>
        </div>

        <div id="yazi-formu" class="panel-card" style="display:none;">
            <h3>ğŸ“ Yeni KÃ¶ÅŸe YazÄ±sÄ±</h3>
            <label>BaÅŸlÄ±k</label>
            <input type="text" id="y-baslik" placeholder="YazÄ± BaÅŸlÄ±ÄŸÄ±">
            <label>Ä°Ã§erik</label>
            <textarea id="y-icerik" rows="8" placeholder="YazÄ± iÃ§eriÄŸi buraya..."></textarea>
            <button onclick="yaziEkle()" class="save-btn"><i class="fas fa-paper-plane"></i> YazÄ±yÄ± YayÄ±nla</button>
            <div id="list-yazilar" style="margin-top:20px;"></div>
        </div>

        <div id="tavsiye-formu" class="panel-card" style="display:none;">
            <h3>â­ Tavsiye Ekle</h3>
            <input type="text" id="t-baslik" placeholder="BaÅŸlÄ±k">
            <input type="text" id="t-aciklama" placeholder="KÄ±sa AÃ§Ä±klama">
            <input type="text" id="t-link" placeholder="Link (URL)">
            <select id="t-icon">
                <option value="fa-star">YÄ±ldÄ±z</option>
                <option value="fa-instagram">Instagram</option>
                <option value="fa-youtube">YouTube</option>
                <option value="fa-link">Zincir</option>
            </select>
            <button onclick="tavsiyeEkle()" class="save-btn">Ekle</button>
            <div id="list-tavsiyeler" style="margin-top:20px;"></div>
        </div>

        <div id="duyuru-formu" class="panel-card" style="display:none;">
            <h3>ğŸ“¢ Haber BandÄ± Duyurusu</h3>
            <label>Kayan YazÄ± Metni</label>
            <input type="text" id="d-metin" placeholder="Ã–rn: LGS KayÄ±tlarÄ±mÄ±z BaÅŸlamÄ±ÅŸtÄ±r!">
            <button onclick="duyuruEkle()" class="save-btn"><i class="fas fa-bullhorn"></i> YayÄ±na Al</button>
            <div id="list-duyurular" style="margin-top:20px;"></div>
        </div>

        <div id="ayarlar-formu" class="panel-card" style="display:none;">
            <div class="settings-group">
                <div class="settings-box" style="background:#fff7ed; border-color:#fdba74;">
                    <h4 style="display:flex; align-items:center; gap:10px;"><i class="fas fa-dot-circle" style="color:#ea580c;"></i> Acil Buton / SÃ¼rpriz Daire</h4>
                    
                    <div style="margin-bottom:15px; font-weight:bold; background:white; padding:10px; border-radius:10px;">
                        <input type="checkbox" id="set-circle-active"> <label for="set-circle-active" style="display:inline; cursor:pointer;">Sitede GÃ¶rÃ¼nsÃ¼n</label>
                    </div>
                    
                    <label>Buton Ãœzerindeki YazÄ±</label>
                    <input type="text" id="set-circle-text" placeholder="Ã–rn: ACÄ°L, DUYURU">
                    
                    <label>Veya GÃ¶rsel Kullan (URL)</label>
                    <input type="text" id="set-circle-img" placeholder="https://... (Resim varsa yazÄ± gÃ¶rÃ¼nmez)">
                    <small style="display:block; margin-top:-10px; margin-bottom:10px; color:#666;">Resim koyarsan yazÄ± iptal olur, resim gÃ¶rÃ¼nÃ¼r.</small>
                    
                    <label>Renk AyarÄ±</label>
                    <div style="display:flex; gap:10px;">
                        <select id="set-circle-mode" style="flex:2;">
                            <option value="auto">ğŸŒˆ Otomatik (GÃ¶kkuÅŸaÄŸÄ± Animasyon)</option>
                            <option value="manual">ğŸ¨ Manuel (Tek Renk)</option>
                        </select>
                        <input type="color" id="set-circle-color" value="#ff0000" style="flex:1; height:52px; cursor:pointer; padding:0; border:none;">
                    </div>

                    <label>TÄ±klayÄ±nca AÃ§Ä±lacak Mesaj (Alert)</label>
                    <textarea id="set-circle-msg" rows="2" placeholder="Ã–rn: YarÄ±n kar tatili!"></textarea>
                    
                    <label>TÄ±klayÄ±nca Gidilecek Link (Varsa)</label>
                    <input type="text" id="set-circle-link" placeholder="TÄ±klayÄ±nca bu sayfaya gitsin">
                    
                    <button onclick="daireAyarlariniKaydet()" class="save-btn" style="background:#ea580c;">Daire AyarlarÄ±nÄ± Kaydet</button>
                </div>

                <div class="settings-box">
                    <h4 style="display:flex; align-items:center; gap:10px;"><i class="fas fa-robot" style="color:#2563eb;"></i> Asistan Robot AyarlarÄ±</h4>
                    <label>Gemini API AnahtarÄ±</label>
                    <input type="text" id="set-api" placeholder="API Key">
                    <label>Robot TalimatÄ± (Prompt)</label>
                    <textarea id="set-prompt" rows="5" placeholder="Robotun kiÅŸiliÄŸi ve talimatlarÄ±..."></textarea>
                    <button onclick="robotAyarlariniKaydet()" class="save-btn" style="background:#2563eb;">Robotu GÃ¼ncelle</button>
                </div>
            </div>
        </div>

        <div id="mesaj-formu" class="panel-card" style="display:none;">
            <h3>ğŸ“¬ Gelen Mesajlar & Talepler</h3>
            <p style="font-size:0.9rem; color:#15803d; margin-bottom:20px; background:#dcfce7; padding:15px; border-radius:10px; border:1px solid #bbf7d0;">
                <i class="fab fa-whatsapp"></i> <strong>Sistem Bilgisi:</strong> Sitede telefon numarasÄ± zorunlu olduÄŸu iÃ§in, aÅŸaÄŸÄ±daki "Onayla / Cevapla" butonuna bastÄ±ÄŸÄ±nÄ±zda otomatik olarak Ã¶ÄŸrencinin numarasÄ±yla WhatsApp aÃ§Ä±lÄ±r ve konuya uygun cevap metni hazÄ±r gelir. Size sadece "GÃ¶nder" demek kalÄ±r.
            </p>
            <div id="mesaj-listesi"></div>
            
            <h4 style="margin-top:50px; border-top:2px dashed #ccc; padding-top:20px; color:#64748b;">ğŸ“¦ ArÅŸivlenmiÅŸ Mesajlar</h4>
            <div id="arsiv-listesi"></div>
        </div>

    </div>
    
    <script>
        const auth = firebase.auth();
        const db = firebase.firestore();

        function girisYap() { auth.signInWithEmailAndPassword(document.getElementById('email').value, document.getElementById('password').value).catch(() => document.getElementById('hata-mesaji').style.display='block'); }
        function cikisYap() { auth.signOut().then(()=>location.reload()); }
        auth.onAuthStateChanged(u => {
            if(u && !u.isAnonymous) { document.getElementById('login-screen').style.display = 'none'; document.getElementById('admin-panel').style.display = 'block'; ayarlarYukle(); listeleriGetir(); arsivGetir(); }
            else { document.getElementById('login-screen').style.display = 'flex'; document.getElementById('admin-panel').style.display = 'none'; if(u) auth.signOut(); }
        });

        function tabDegis(tip) {
            document.querySelectorAll('.panel-card').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tip + '-formu').style.display = 'block';
            if(tip !== 'mesaj') document.getElementById('btn-' + tip).classList.add('active');
        }

        const bugunStr = new Date().toISOString().split('T')[0];
        db.collection("istatistik").doc(bugunStr).onSnapshot(d => { document.getElementById('ziyaret-sayisi').innerText = d.exists ? d.data().ziyaret : 0; });

        // EKLEME Ä°ÅLEMLERÄ°
        function projeEkle() { db.collection("projeler").add({ baslik: document.getElementById('p-baslik').value, link: document.getElementById('p-link').value, kategori: document.getElementById('p-kategori').value, icon: document.getElementById('p-icon').value, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>alert("âœ… Proje Eklendi!")); }
        function yaziEkle() { db.collection("yazilar").add({ baslik: document.getElementById('y-baslik').value, icerik: document.getElementById('y-icerik').value, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>alert("âœ… YazÄ± Eklendi!")); }
        function tavsiyeEkle() { db.collection("tavsiyeler").add({ baslik: document.getElementById('t-baslik').value, aciklama: document.getElementById('t-aciklama').value, link: document.getElementById('t-link').value, icon: document.getElementById('t-icon').value, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>alert("âœ… Tavsiye Eklendi!")); }
        function duyuruEkle() { db.collection("duyurular").add({ metin: document.getElementById('d-metin').value, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>alert("âœ… Duyuru YayÄ±nda!")); }

        // LÄ°STELEME
        function listeleriGetir() {
            db.collection("projeler").orderBy("tarih", "desc").onSnapshot(snap => {
                let h = "";
                snap.forEach(d => {
                    const v = d.data();
                    const safeBaslik = (v.baslik || "").replace(/'/g, "\\'");
                    const safeLink = (v.link || "").replace(/'/g, "\\'");
                    h += `<div class="list-item" style="border-left:5px solid #3b82f6;">
                            <div class="item-info">
                                <i class="fas ${v.icon || 'fa-folder'}" style="color:#3b82f6; font-size:1.2rem;"></i> 
                                <div><strong>${v.baslik}</strong><br><span class="item-badge">${v.kategori}</span></div>
                            </div>
                            <div class="item-actions">
                                <button onclick="vitrinYap('${safeBaslik}', 'Ã–zel SeÃ§im', '${safeLink}')" class="btn-mini btn-vitrin"><i class="fas fa-star"></i> Vitrin Yap</button>
                                <button onclick="sil('projeler', '${d.id}')" class="btn-mini btn-sil"><i class="fas fa-trash"></i> Sil</button>
                            </div>
                          </div>`;
                });
                document.getElementById('list-projeler').innerHTML = h || "<p>KayÄ±tlÄ± proje yok.</p>";
            });

            // Duyurular (ZenginleÅŸtirildi)
            db.collection("duyurular").orderBy("tarih", "desc").onSnapshot(snap => {
                let h = "";
                snap.forEach(d => {
                    let v = d.data();
                    let tarih = v.tarih ? new Date(v.tarih.toDate()).toLocaleDateString('tr-TR') : "";
                    h += `<div class="list-item" style="border-left:5px solid #f59e0b;">
                            <div class="item-info">
                                <i class="fas fa-bullhorn" style="color:#f59e0b; font-size:1.2rem;"></i>
                                <div>${v.metin}<br><span style="font-size:0.75rem; color:#999;">${tarih}</span></div>
                            </div>
                            <button onclick="sil('duyurular', '${d.id}')" class="btn-mini btn-sil"><i class="fas fa-trash"></i> Sil</button>
                          </div>`;
                });
                document.getElementById('list-duyurular').innerHTML = h || "<p>Aktif duyuru yok.</p>";
            });

            // YazÄ±lar ve Tavsiyeler (Standart)
            const map = { yazilar: 'fa-pen', tavsiyeler: 'fa-star' };
            ['yazilar', 'tavsiyeler'].forEach(tip => {
                db.collection(tip).orderBy("tarih", "desc").onSnapshot(snap => {
                    let h = "";
                    snap.forEach(d => {
                        let v = d.data();
                        h += `<div class="list-item">
                                <div class="item-info"><i class="fas ${map[tip]}"></i> ${v.baslik || v.metin}</div>
                                <button onclick="sil('${tip}', '${d.id}')" class="btn-mini btn-sil"><i class="fas fa-trash"></i> Sil</button>
                              </div>`;
                    });
                    document.getElementById('list-' + tip).innerHTML = h || "<p>Veri yok.</p>";
                });
            });
        }

        function vitrinYap(baslik, aciklama, link) {
            if(!confirm("Bu iÃ§eriÄŸi 'HaftanÄ±n Oyunu' alanÄ±na taÅŸÄ±mak istiyor musun?")) return;
            db.collection("site_ayarlari").doc("haftanin_oyunu").set({ baslik: baslik, metin: aciklama, url: link, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(() => alert("âœ… Vitrin GÃ¼ncellendi!"));
        }

        function sil(kol, id) { if(confirm("Silmek istediÄŸine emin misin?")) db.collection(kol).doc(id).delete(); }

        // AYARLAR YÃ–NETÄ°MÄ°
        function ayarlarYukle() {
            db.collection("site_ayarlari").doc("robot").get().then(d => { if(d.exists) { document.getElementById('set-api').value=d.data().apiKey; document.getElementById('set-prompt').value=d.data().prompt; } });
            db.collection("site_ayarlari").doc("ozel_duyuru").get().then(d => { if(d.exists) { 
                const v = d.data();
                document.getElementById('set-circle-active').checked=v.aktif; 
                document.getElementById('set-circle-text').value=v.daireMetni || ""; 
                document.getElementById('set-circle-img').value=v.daireResim || ""; 
                document.getElementById('set-circle-mode').value=v.renkModu || "auto"; 
                document.getElementById('set-circle-color').value=v.manuelRenk || "#ff0000"; 
                document.getElementById('set-circle-msg').value=v.mesaj || ""; 
                document.getElementById('set-circle-link').value=v.link || ""; 
            } });
        }
        function robotAyarlariniKaydet() { db.collection("site_ayarlari").doc("robot").set({ apiKey: document.getElementById('set-api').value, prompt: document.getElementById('set-prompt').value }, {merge:true}).then(()=>alert("Kaydedildi")); }
        
        function daireAyarlariniKaydet() { 
            db.collection("site_ayarlari").doc("ozel_duyuru").set({ 
                aktif: document.getElementById('set-circle-active').checked, 
                daireMetni: document.getElementById('set-circle-text').value, 
                daireResim: document.getElementById('set-circle-img').value, 
                renkModu: document.getElementById('set-circle-mode').value, 
                manuelRenk: document.getElementById('set-circle-color').value, 
                mesaj: document.getElementById('set-circle-msg').value, 
                link: document.getElementById('set-circle-link').value 
            }, {merge:true}).then(()=>alert("Kaydedildi")); 
        }

        // --- MESAJLAR SÄ°STEMÄ° (TELEFON NUMARALI & AKILLI) ---
        db.collection("iletisim_talepleri").orderBy("tarih", "desc").onSnapshot(snap => {
            let h = ""; 
            if(snap.size>0){ document.getElementById('btn-mesaj').classList.add('has-message'); document.getElementById('msg-badge').innerText=snap.size; document.getElementById('msg-badge').style.display='inline-block'; }
            else { document.getElementById('msg-badge').style.display='none'; }
            
            snap.forEach(d=>{ 
                const v = d.data(); 
                const ad = v.ad_soyad || "Ä°simsiz";
                const konu = v.konu || "Konu Yok";
                const telRaw = v.telefon || "";
                const telClean = telRaw.replace(/\D/g, ''); // NumarayÄ± temizle
                
                // OTOMATÄ°K CEVAP OLUÅTURUCU
                let cevapMetni = "Merhaba ben BarÄ±ÅŸ Ã–ÄŸretmen. ";
                const k = konu.toLowerCase();
                
                if(k.includes("lgs") || k.includes("sÄ±nav")) { cevapMetni += `"${konu}" hakkÄ±ndaki talebini aldÄ±m. LGS Ã§alÄ±ÅŸma programÄ±mÄ±z iÃ§in dÃ¶nÃ¼ÅŸ yaptÄ±m.`; }
                else if(k.includes("kitap")) { cevapMetni += `Kitap talebinle ilgili yardÄ±mcÄ± olmak isterim.`; }
                else if(k.includes("ders")) { cevapMetni += `Ã–zel ders talebini inceledim. DetaylarÄ± konuÅŸabilir miyiz?`; }
                else if(k.includes("fiyat") || k.includes("Ã¼cret")) { cevapMetni += `EÄŸitim paketlerimiz ve Ã¼cretler hakkÄ±nda bilgi verebilirim.`; }
                else { cevapMetni += `"${konu}" konulu mesajÄ±nÄ± aldÄ±m. NasÄ±l yardÄ±mcÄ± olabilirim?`; }

                // WhatsApp Linki (Ã–ÄŸrencinin NumarasÄ±na Gider)
                // 90 ekleyerek baÅŸlatÄ±yoruz (TÃ¼rkiye kodu varsayÄ±lan)
                let waLink = "#";
                if(telClean.length > 9) {
                    waLink = `https://wa.me/90${telClean.substring(telClean.length - 10)}?text=${encodeURIComponent(cevapMetni)}`;
                }

                h += `<div class="list-item" style="border-left:5px solid #25D366;">
                        <div style="flex:1;">
                            <div style="font-weight:bold; font-size:1.1rem; display:flex; align-items:center; gap:10px;">
                                ${ad} <span style="font-size:0.8rem; font-weight:normal; background:#eee; padding:2px 6px; border-radius:4px;">${telRaw}</span>
                            </div>
                            <span style="font-size:0.8rem; color:#888;"><i class="far fa-clock"></i> ${v.tarih ? new Date(v.tarih.toDate()).toLocaleString('tr-TR') : 'Tarih Yok'}</span>
                            <div style="margin-top:5px; padding:10px; background:#f0fdf4; border-radius:8px; border:1px solid #bbf7d0;">
                                <span style="color:#15803d; font-weight:bold;">Talep:</span> ${konu}
                            </div>
                        </div>
                        <div class="item-actions">
                            ${telClean.length > 9 
                                ? `<a href="${waLink}" target="_blank" class="btn-mini btn-wa"><i class="fab fa-whatsapp"></i> âœ… Onayla / Cevapla</a>` 
                                : `<span style="font-size:0.8rem; color:red; padding:5px;">âš ï¸ Numara HatalÄ±</span>`
                            }
                            <button onclick="arsiveAt('${d.id}', '${ad}', '${konu}')" class="btn-mini btn-arsiv"><i class="fas fa-archive"></i> ArÅŸivle</button>
                            <button onclick="sil('iletisim_talepleri','${d.id}')" class="btn-mini btn-sil"><i class="fas fa-trash"></i> Sil</button>
                        </div>
                    </div>`; 
            });
            document.getElementById('mesaj-listesi').innerHTML = h || "<p style='text-align:center; color:#999; padding:20px;'>ğŸ“­ Gelen kutusu boÅŸ.</p>";
        });

        // ARÅÄ°V FONKSÄ°YONU
        function arsiveAt(id, ad, konu) {
            db.collection("arsiv_mesajlar").add({
                ad_soyad: ad, konu: konu,
                arsiv_tarihi: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                db.collection("iletisim_talepleri").doc(id).delete();
            });
        }

        // ARÅÄ°V LÄ°STESÄ°NÄ° GETÄ°R
        function arsivGetir() {
            db.collection("arsiv_mesajlar").orderBy("arsiv_tarihi", "desc").limit(10).onSnapshot(snap => {
                let h = "";
                snap.forEach(d => {
                    const v = d.data();
                    h += `<div class="list-item" style="opacity:0.7; border-left:5px solid #64748b;">
                            <div><strong>${v.ad_soyad}</strong>: ${v.konu}</div>
                            <button onclick="sil('arsiv_mesajlar', '${d.id}')" class="btn-mini btn-sil"><i class="fas fa-times"></i></button>
                          </div>`;
                });
                document.getElementById('arsiv-listesi').innerHTML = h;
            });
        }

    </script>
</body>
</html>
