<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BarÄ±ÅŸ Hoca - Final Panel v45</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="firebase-config.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #2563eb; --secondary: #f59e0b; --danger: #ef4444; --dark: #0f172a; --light: #f1f5f9; }
        body { font-family: 'Inter', sans-serif; background: var(--light); margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* SOL MENÃœ (FOTOÄRAFTAKÄ° GÄ°BÄ° KOYU VE ÅIK) */
        .sidebar { width: 260px; background: #111827; color: white; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; overflow-y: auto; }
        .brand { font-size: 1.4rem; font-weight: 700; color: #fbbf24; margin-bottom: 30px; display: flex; align-items: center; gap: 10px; }
        
        .menu-item { padding: 12px 15px; margin-bottom: 5px; border-radius: 12px; cursor: pointer; display: flex; align-items: center; gap: 12px; color: #9ca3af; font-weight: 500; transition: 0.2s; }
        .menu-item:hover { background: rgba(255,255,255,0.1); color: white; }
        .menu-item.active { background: var(--primary); color: white; box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4); }
        .menu-item.gold { color: #fbbf24; } 
        .menu-item.gold:hover { background: rgba(251, 191, 36, 0.1); }
        .badge { background: var(--danger); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.7rem; margin-left: auto; }

        /* ANA Ä°Ã‡ERÄ°K */
        .main { flex: 1; padding: 30px; overflow-y: auto; position: relative; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; }
        .title { font-size: 1.8rem; font-weight: 700; color: #1f2937; }
        
        /* KARTLAR VE KUTULAR */
        .card { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); margin-bottom: 20px; border: 1px solid #e5e7eb; }
        .section { display: none; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

        /* Ä°STATÄ°STÄ°K KUTULARI (FOTOÄRAFTAKÄ° GÄ°BÄ° BÃœYÃœK VE RENKLÄ°) */
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px; }
        .stat-box { padding: 30px; border-radius: 20px; color: white; text-align: center; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .sb-blue { background: #3b82f6; } .sb-red { background: #ef4444; } .sb-purple { background: #8b5cf6; }
        .sb-val { font-size: 3.5rem; font-weight: 800; line-height: 1; margin-top: 10px; }
        .sb-label { font-size: 1rem; opacity: 0.9; font-weight: 600; }

        /* INPUTLAR VE BUTONLAR */
        .inp, select, textarea { width: 100%; padding: 14px; border: 2px solid #e5e7eb; border-radius: 12px; font-size: 0.95rem; margin-bottom: 15px; outline: none; transition: 0.3s; background: #f9fafb; font-family: 'Inter', sans-serif; }
        .inp:focus { border-color: var(--primary); background: white; }
        
        .btn { width: 100%; padding: 14px; border: none; border-radius: 12px; font-weight: 600; cursor: pointer; color: white; font-size: 1rem; transition: 0.2s; }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-primary { background: var(--primary); }
        .btn-success { background: #10b981; }
        .btn-warning { background: var(--secondary); }
        .btn-danger { background: var(--danger); }

        /* LÄ°STE GÃ–RÃœNÃœMÃœ (Ã–ZET KISMI Ä°Ã‡Ä°N) */
        .item-list { display: flex; flex-direction: column; gap: 10px; }
        .item-row { background: #f8fafc; padding: 15px; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; border: 1px solid #e2e8f0; }
        .item-info b { color: #334155; font-size: 1rem; }
        .item-tag { font-size: 0.75rem; padding: 3px 8px; border-radius: 6px; background: #e0e7ff; color: var(--primary); font-weight: 600; margin-left: 5px; }
        .btn-sm { padding: 6px 12px; font-size: 0.85rem; border-radius: 8px; border: none; cursor: pointer; color: white; margin-left: 5px; }

        /* Ä°KON GRID (YAN YANA) */
        .icon-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(45px, 1fr)); gap: 8px; padding: 10px; background: #f8fafc; border-radius: 12px; border: 2px solid #e2e8f0; max-height: 200px; overflow-y: auto; }
        .icon-opt { height: 45px; display: flex; align-items: center; justify-content: center; background: white; border: 1px solid #cbd5e1; border-radius: 8px; cursor: pointer; color: #64748b; font-size: 1.2rem; }
        .icon-opt:hover { border-color: var(--primary); color: var(--primary); }
        .icon-opt.selected { background: var(--primary); color: white; border-color: var(--primary); }

        /* KATEGORÄ°LER (YAN YANA CHECKBOX) */
        .cat-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; margin-bottom: 20px; }
        .cat-item { background: #f1f5f9; padding: 10px; border-radius: 10px; display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 0.9rem; font-weight: 500; color: #475569; }
        .cat-item input { accent-color: var(--primary); transform: scale(1.2); }

        /* STORY MODÃœLÃœ */
        .story-page { background: white; border: 2px dashed #cbd5e1; padding: 15px; border-radius: 12px; margin-bottom: 15px; position: relative; }
        .sp-badge { position: absolute; top: -10px; left: 10px; background: var(--secondary); color: white; padding: 2px 10px; border-radius: 10px; font-size: 0.75rem; font-weight: bold; }

        /* TOAST */
        #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); background: #333; color: white; padding: 12px 25px; border-radius: 50px; font-weight: 600; display: none; box-shadow: 0 10px 30px rgba(0,0,0,0.3); z-index: 9999; }
    </style>
</head>
<body>

    <div id="toast">Ä°ÅŸlem BaÅŸarÄ±lÄ±!</div>

    <div class="sidebar">
        <div class="brand"><i class="fas fa-rocket"></i> BarÄ±ÅŸ Hoca</div>
        <div class="menu-item active" onclick="nav('ozet')"><i class="fas fa-chart-pie"></i> Ã–zet</div>
        <div class="menu-item gold" onclick="nav('hikaye-yaz')"><i class="fas fa-pen-nib"></i> <b>HÄ°KAYE YAZ</b></div>
        <div class="menu-item" onclick="nav('vitrin-yonetimi')"><i class="fas fa-star"></i> Vitrin YÃ¶netimi</div>
        <div class="menu-item" onclick="nav('sihirbaz')"><i class="fas fa-magic"></i> Ä°Ã§erik Ekle</div>
        <div class="menu-item" onclick="nav('yazi-yonetimi')"><i class="fas fa-feather-alt"></i> KÃ¶ÅŸe YazÄ±larÄ±</div>
        <div class="menu-item" onclick="nav('kitap-ekle')"><i class="fas fa-book"></i> Kitap YÃ¶netimi</div>
        <div class="menu-item" onclick="nav('mesajlar')"><i class="fas fa-envelope"></i> Mesajlar <span id="msg-badge" class="badge">0</span></div>
        <div class="menu-item" onclick="nav('duyuru-tavsiye')"><i class="fas fa-bullhorn"></i> Duyuru & Tavsiye</div>
        <div class="menu-item" onclick="nav('ayarlar')"><i class="fas fa-cog"></i> Ayarlar & Buton</div>
        <div style="margin-top: auto;">
            <div class="menu-item" onclick="auth.signOut()" style="color: #ef4444;"><i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ</div>
        </div>
    </div>

    <div class="main">
        
        <div id="ozet" class="section active">
            <div class="header"><div class="title">Panel Ã–zeti</div></div>
            <div class="stats">
                <div class="stat-box sb-blue">
                    <div class="sb-label">BugÃ¼n</div>
                    <div class="sb-val" id="stat-today">0</div>
                </div>
                <div class="stat-box sb-red">
                    <div class="sb-label">Bu Ay</div>
                    <div class="sb-val" id="stat-month">0</div>
                </div>
                <div class="stat-box sb-purple">
                    <div class="sb-label">Toplam</div>
                    <div class="sb-val" id="stat-total">0</div>
                </div>
            </div>
            
            <div class="card">
                <h3><i class="fas fa-bolt" style="color:var(--secondary);"></i> HÄ±zlÄ± Ä°Ã§erik YÃ¶netimi</h3>
                <input type="text" id="search-content" class="inp" placeholder="Ä°Ã§erik ara (Oyun, Kitap, YazÄ±)..." onkeyup="icerikFiltrele()">
                <div id="tum-icerik-listesi" class="item-list"><div style="padding:20px; text-align:center; color:#999;">YÃ¼kleniyor...</div></div>
            </div>
        </div>

        <div id="hikaye-yaz" class="section">
            <div class="header"><div class="title">Hikaye YazarÄ±</div></div>
            <div class="card" style="border-top: 5px solid var(--secondary);">
                <p style="color:#666; margin-bottom:20px;">Buradan yazdÄ±ÄŸÄ±n kitap, <b>otomatik olarak</b> siteye eklenir ve <b>Mavi Vitrin Kutusuna</b> yerleÅŸir.</p>
                
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                    <input type="text" id="h-baslik" class="inp" placeholder="Kitap AdÄ±">
                    <input type="text" id="h-alt" class="inp" placeholder="Alt BaÅŸlÄ±k">
                </div>
                <select id="h-renk" class="inp">
                    <option value="linear-gradient(135deg, #f59e0b, #d97706)">Turuncu Tema</option>
                    <option value="linear-gradient(135deg, #3b82f6, #1d4ed8)">Mavi Tema</option>
                    <option value="linear-gradient(135deg, #10b981, #059669)">YeÅŸil Tema</option>
                    <option value="linear-gradient(135deg, #ef4444, #b91c1c)">KÄ±rmÄ±zÄ± Tema</option>
                </select>

                <div id="sayfalar-alani"></div>
                
                <div style="display:flex; gap:10px; margin-top:20px;">
                    <button onclick="yeniSayfaEkle()" class="btn" style="background:#e2e8f0; color:#333; flex:1;">+ Sayfa Ekle</button>
                    <button onclick="hikayeyiKaydet()" class="btn btn-success" style="flex:2;">KÄ°TABI YAYINLA</button>
                </div>
            </div>
        </div>

        <div id="sihirbaz" class="section">
            <div class="header"><div class="title">Ä°Ã§erik SihirbazÄ±</div></div>
            <div class="card">
                <div style="display:flex; gap:15px; margin-bottom:20px;">
                    <label style="font-weight:bold;"><input type="radio" name="tur" value="projeler" checked onchange="formuGuncelle()"> ğŸ® Oyun</label>
                    <label style="font-weight:bold;"><input type="radio" name="tur" value="videolar" onchange="formuGuncelle()"> ğŸ¥ Video</label>
                    <label style="font-weight:bold;"><input type="radio" name="tur" value="kaynaklar" onchange="formuGuncelle()"> ğŸ“š PDF</label>
                    <label style="font-weight:bold;"><input type="radio" name="tur" value="yazilar" onchange="formuGuncelle()"> ğŸ“ KÃ¶ÅŸe YazÄ±sÄ±</label>
                </div>

                <input type="text" id="p-baslik" class="inp" placeholder="BaÅŸlÄ±k">
                <input type="text" id="p-aciklama" class="inp" placeholder="KÄ±sa AÃ§Ä±klama">
                <input type="text" id="p-link" class="inp" placeholder="Link / Dosya AdÄ± / Video URL">

                <div id="area-yazi" style="display:none;">
                    <textarea id="p-icerik" class="inp" rows="12" placeholder="YazÄ± iÃ§eriÄŸi HTML..."></textarea>
                    <small style="color:#d97706;">* KaydettiÄŸinde otomatik olarak <b>SarÄ± Kutu (Son YazÄ±)</b> gÃ¼ncellenir.</small>
                </div>

                <div id="area-detay">
                    <label style="font-weight:600; display:block; margin-bottom:10px;">Renkli Ä°kon SeÃ§:</label>
                    <div class="icon-grid" id="icon-grid-container"></div>
                    <input type="hidden" id="p-selected-icon" value="fa-gamepad">
                    
                    <label style="font-weight:600; display:block; margin:20px 0 10px;">Kategoriler (Eksiksiz):</label>
                    <div class="cat-grid">
                        <label class="cat-item"><input type="checkbox" class="cat-check" value="Anaokulu"> ğŸ§¸ Anaokulu</label>
                        <label class="cat-item"><input type="checkbox" class="cat-check" value="Ã–zel EÄŸitim"> ğŸ§© Ã–zel EÄŸitim</label>
                        <label class="cat-item"><input type="checkbox" class="cat-check" value="1. SÄ±nÄ±f"> 1. SÄ±nÄ±f</label>
                        <label class="cat-item"><input type="checkbox" class="cat-check" value="2. SÄ±nÄ±f"> 2. SÄ±nÄ±f</label>
                        <label class="cat-item"><input type="checkbox" class="cat-check" value="3. SÄ±nÄ±f"> 3. SÄ±nÄ±f</label>
                        <label class="cat-item"><input type="checkbox" class="cat-check" value="4. SÄ±nÄ±f"> 4. SÄ±nÄ±f</label>
                        <label class="cat-item"><input type="checkbox" class="cat-check" value="5. SÄ±nÄ±f"> 5. SÄ±nÄ±f</label>
                        <label class="cat-item"><input type="checkbox" class="cat-check" value="6. SÄ±nÄ±f"> 6. SÄ±nÄ±f</label>
                        <label class="cat-item"><input type="checkbox" class="cat-check" value="7. SÄ±nÄ±f"> 7. SÄ±nÄ±f</label>
                        <label class="cat-item"><input type="checkbox" class="cat-check" value="8. SÄ±nÄ±f"> 8. SÄ±nÄ±f</label>
                        <label class="cat-item"><input type="checkbox" class="cat-check" value="Robotik"> ğŸ¤– Robotik</label>
                        <label class="cat-item"><input type="checkbox" class="cat-check" value="Kodlama"> ğŸ’» Kodlama</label>
                        <label class="cat-item"><input type="checkbox" class="cat-check" value="AkÄ±l Zeka"> ğŸ§  AkÄ±l Zeka</label>
                        <label class="cat-item"><input type="checkbox" class="cat-check" value="SatranÃ§"> â™Ÿï¸ SatranÃ§</label>
                        <label class="cat-item"><input type="checkbox" class="cat-check" value="Dil KonuÅŸma"> ğŸ—£ï¸ Dil</label>
                        <label class="cat-item"><input type="checkbox" class="cat-check" value="TasarÄ±m"> ğŸ¨ TasarÄ±m</label>
                    </div>
                </div>

                <button onclick="icerikKaydet()" class="btn btn-primary" style="margin-top:20px;">Ä°Ã‡ERÄ°ÄÄ° KAYDET</button>
            </div>
        </div>

        <div id="vitrin-yonetimi" class="section">
            <div class="header"><div class="title">Vitrin YÃ¶netimi</div></div>
            <div class="card">
                <p style="color:#666;">Ä°Ã§erik eklediÄŸinde burasÄ± otomatik deÄŸiÅŸir. Ama eski bir ÅŸeyi Ã¶ne Ã§Ä±karmak istersen buradan seÃ§ebilirsin.</p>
                
                <h4 style="color:#2563eb;">ğŸ”µ MAVÄ° KUTU (Yeni Kitap)</h4>
                <div id="drop-kitap" style="max-height:200px; overflow-y:auto; border:2px solid #e2e8f0; border-radius:12px; padding:10px;">YÃ¼kleniyor...</div>

                <h4 style="color:#d97706; margin-top:30px;">ğŸŸ¡ SARI KUTU (Son YazÄ±)</h4>
                <div id="drop-yazi" style="max-height:200px; overflow-y:auto; border:2px solid #e2e8f0; border-radius:12px; padding:10px;">YÃ¼kleniyor...</div>
            </div>
        </div>

        <div id="yazi-yonetimi" class="section">
            <div class="header"><div class="title">KÃ¶ÅŸe YazÄ±larÄ±</div></div>
            <div class="card" id="ozel-yazi-listesi">YÃ¼kleniyor...</div>
        </div>

        <div id="kitap-ekle" class="section">
            <div class="header"><div class="title">Kitap YÃ¶netimi</div></div>
            <div class="card" id="kitap-listesi">YÃ¼kleniyor...</div>
        </div>

        <div id="mesajlar" class="section">
            <div class="header"><div class="title">Mesaj Kutusu</div></div>
            <div class="card" id="mesaj-listesi">YÃ¼kleniyor...</div>
        </div>

        <div id="duyuru-tavsiye" class="section">
            <div class="header"><div class="title">Duyurular & Tavsiyeler</div></div>
            <div class="card">
                <h3>ğŸ“¢ Duyuru Ekle (Kayan YazÄ±)</h3>
                <input type="text" id="d-metin" class="inp" placeholder="Duyuru metni...">
                <button onclick="duyuruEkle()" class="btn btn-primary">YayÄ±nla</button>
                <div id="list-duyurular" style="margin-top:15px;"></div>
            </div>
            <div class="card">
                <h3>â­ Tavsiye Ekle</h3>
                <input type="text" id="t-baslik" class="inp" placeholder="Tavsiye BaÅŸlÄ±ÄŸÄ±">
                <input type="text" id="t-link" class="inp" placeholder="Link">
                <button onclick="tavsiyeEkle()" class="btn btn-success">Ekle</button>
                <div id="list-tavsiyeler" style="margin-top:15px;"></div>
            </div>
        </div>

        <div id="ayarlar" class="section">
            <div class="header"><div class="title">Ayarlar</div></div>
            <div class="card">
                <h3>Buton Ã–zelleÅŸtirme</h3>
                <div style="display:flex; align-items:center; justify-content:center; background:#f1f5f9; padding:20px; border-radius:15px; margin-bottom:20px;">
                    <button id="demo-btn" style="width:80px; height:80px; border:none; color:white; font-weight:bold; box-shadow:0 10px 20px rgba(0,0,0,0.2); transition:0.3s;">YENÄ°</button>
                </div>
                
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:15px;">
                    <select id="set-shape" class="inp" onchange="updateButtonPreview()">
                        <option value="shape-circle">Yuvarlak</option>
                        <option value="shape-square">Kare</option>
                        <option value="shape-leaf">Yaprak</option>
                        <option value="shape-cloud">Bulut</option>
                        <option value="shape-heart">Kalp</option>
                        <option value="shape-star">YÄ±ldÄ±z</option>
                    </select>
                    <select id="set-color" class="inp" onchange="updateButtonPreview()">
                        <option value="linear-gradient(135deg, #ef4444, #b91c1c)">KÄ±rmÄ±zÄ±</option>
                        <option value="linear-gradient(135deg, #f59e0b, #d97706)">Turuncu</option>
                        <option value="linear-gradient(135deg, #3b82f6, #1d4ed8)">Mavi</option>
                        <option value="linear-gradient(135deg, #10b981, #059669)">YeÅŸil</option>
                    </select>
                </div>
                
                <input type="text" id="set-text" class="inp" value="YENÄ°" placeholder="Buton YazÄ±sÄ±" onkeyup="updateButtonPreview()">
                <input type="text" id="set-link" class="inp" placeholder="GideceÄŸi Link">
                <label><input type="checkbox" id="set-active"> Buton Sitede GÃ¶zÃ¼ksÃ¼n</label>
                
                <button onclick="daireKaydet()" class="btn btn-warning" style="margin-top:15px;">AYARLARI KAYDET</button>
            </div>
        </div>

    </div>

    <script>
        const auth = firebase.auth();
        const db = firebase.firestore();
        let tumIceriklerCache = [];

        // TOAST MESAJI
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.innerText = "âœ… " + msg; t.style.display = "block";
            setTimeout(() => t.style.display = "none", 3000);
        }

        // NAVÄ°GASYON
        function nav(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            // MenÃ¼ item'ini aktif yap
            event.currentTarget.classList.add('active');
            
            if(id === 'vitrin-yonetimi') vitrinVerileriniGetir();
            if(id === 'ozet') verileriYukle();
        }

        // GÄ°RÄ°Å KONTROLÃœ
        auth.onAuthStateChanged(user => {
            if(user) { verileriYukle(); istatistikGetir(); mesajlariGetir(); loadIcons(); yeniSayfaEkle(); } 
            else { window.location.reload(); /* GiriÅŸ yoksa sayfayÄ± yenile veya login gÃ¶ster */ }
        });

        // --- 1. OTOMATÄ°K VÄ°TRÄ°N GÃœNCELLEME (SÄ°HÄ°RLÄ° KISIM) ---
        function vitrinGuncelle(tur, baslik, link) {
            const docId = tur === 'kitap' ? 'vitrin_kitap' : 'vitrin_yazi';
            db.collection("site_ayarlari").doc(docId).set({ baslik, link }).then(() => console.log("Vitrin gÃ¼ncellendi"));
        }

        // --- 2. HÄ°KAYE YAZMA ---
        let sayfaSayisi = 0;
        function yeniSayfaEkle() {
            sayfaSayisi++;
            const div = document.createElement('div'); div.className = 'story-page';
            div.innerHTML = `<div class="sp-badge">Sayfa ${sayfaSayisi}</div><span style="float:right; color:red; cursor:pointer;" onclick="this.parentElement.remove()">Sil</span><input type="text" class="inp s-resim" placeholder="Resim AdÄ± (ali1.jpg)"><textarea class="inp s-metin" rows="3" placeholder="Hikaye metni..."></textarea>`;
            document.getElementById('sayfalar-alani').appendChild(div);
        }

        function hikayeyiKaydet() {
            const baslik = document.getElementById('h-baslik').value;
            if(!baslik) return alert("BaÅŸlÄ±k gir!");
            
            let sayfalar = [];
            document.querySelectorAll('.story-page').forEach(box => {
                sayfalar.push({ img: box.querySelector('.s-resim').value, text: box.querySelector('.s-metin').value });
            });

            if(sayfalar.length === 0) return alert("Sayfa ekle!");

            db.collection("dijital_kitaplar").add({ baslik, sayfalar, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(docRef => {
                const link = `kitap-oku.html?id=${docRef.id}`;
                db.collection("kitaplar").add({ baslik, altBaslik: document.getElementById('h-alt').value, link, renk: document.getElementById('h-renk').value, sira:100, tarih: firebase.firestore.FieldValue.serverTimestamp() });
                
                // OTOMATÄ°K VÄ°TRÄ°N GÃœNCELLEME
                vitrinGuncelle('kitap', baslik, link);
                
                showToast("Kitap YayÄ±nlandÄ±!");
                verileriYukle(); // Listeyi gÃ¼ncelle
                document.getElementById('sayfalar-alani').innerHTML=""; yeniSayfaEkle();
            });
        }

        // --- 3. Ä°Ã‡ERÄ°K KAYDETME ---
        function icerikKaydet() {
            const tur = document.querySelector('input[name="tur"]:checked').value;
            const baslik = document.getElementById('p-baslik').value;
            if(!baslik) return alert("BaÅŸlÄ±k gir!");

            const batch = db.batch();
            const ref = tur === 'yazilar' ? db.collection('yazilar').doc() : db.collection(tur).doc();
            let data = { baslik, tarih: firebase.firestore.FieldValue.serverTimestamp() };

            if(tur === 'yazilar') {
                data.icerik = document.getElementById('p-icerik').value;
                vitrinGuncelle('yazi', baslik, 'ebeveyn-kosesi.html');
            } else {
                data.link = document.getElementById('p-link').value; data.aciklama = document.getElementById('p-aciklama').value; data.icon = document.getElementById('p-selected-icon').value;
                const cats = []; document.querySelectorAll('.cat-check:checked').forEach(c => cats.push(c.value));
                if(cats.length > 0) { cats.forEach(k => batch.set(db.collection(tur).doc(), { ...data, kategori:k })); batch.commit(); showToast("Ä°Ã§erik Eklendi"); verileriYukle(); return; }
                else { data.kategori = "Genel"; }
            }
            batch.set(ref, data); batch.commit().then(() => { showToast("Kaydedildi"); verileriYukle(); });
        }

        function formuGuncelle() { const tur = document.querySelector('input[name="tur"]:checked').value; document.getElementById('area-yazi').style.display = tur === 'yazilar' ? 'block' : 'none'; document.getElementById('area-detay').style.display = tur === 'yazilar' ? 'none' : 'block'; }

        // --- VERÄ° Ã‡EKME & LÄ°STELEME ---
        function verileriYukle() {
            tumIceriklerCache = [];
            const load = (col, type) => { db.collection(col).get().then(snap => { snap.forEach(d => tumIceriklerCache.push({ id:d.id, col, type, ...d.data() })); renderList(); }); };
            load("projeler","OYUN"); load("videolar","VÄ°DEO"); load("kaynaklar","PDF"); load("kitaplar","KÄ°TAP"); load("yazilar","YAZI");
            
            // Kitap Listesi (Manuel YÃ¶netim Ä°Ã§in)
            db.collection("kitaplar").orderBy("tarih","desc").get().then(snap => {
                let h=""; snap.forEach(d => { const k=d.data(); h+=`<div class="item-row"><div class="item-info"><b>${k.baslik}</b></div><button class="btn-sm" style="background:#ef4444;" onclick="sil('kitaplar','${d.id}')">Sil</button></div>`; });
                document.getElementById('kitap-listesi').innerHTML = h;
            });
            
            // YazÄ± Listesi
            db.collection("yazilar").orderBy("tarih","desc").get().then(snap => {
                let h=""; snap.forEach(d => { const k=d.data(); h+=`<div class="item-row"><div class="item-info"><b>${k.baslik}</b></div><button class="btn-sm" style="background:#ef4444;" onclick="sil('yazilar','${d.id}')">Sil</button></div>`; });
                document.getElementById('ozel-yazi-listesi').innerHTML = h;
            });
        }

        function renderList() {
            tumIceriklerCache.sort((a,b) => (b.tarih?.seconds || 0) - (a.tarih?.seconds || 0));
            let h = "";
            tumIceriklerCache.forEach(i => {
                h += `<div class="item-row">
                    <div class="item-info"><b>${i.baslik}</b> <span class="item-tag">${i.type}</span></div>
                    <div>
                        <button class="btn-sm" style="background:#3b82f6;" onclick="window.open('${i.link}')">GÃ¶zat</button>
                        <button class="btn-sm" style="background:#94a3b8;" onclick="sil('${i.col}','${i.id}')">Sil</button>
                    </div>
                </div>`;
            });
            document.getElementById('tum-icerik-listesi').innerHTML = h;
        }

        function sil(col, id) { if(confirm("Silinsin mi?")) db.collection(col).doc(id).delete().then(() => { showToast("Silindi"); verileriYukle(); }); }

        // --- Ä°KONLAR & ÅEKÄ°LLER ---
        const icons = ["fa-gamepad","fa-book","fa-video","fa-robot","fa-chess","fa-brain","fa-rocket","fa-star","fa-pen-nib","fa-music","fa-code","fa-puzzle-piece","fa-child","fa-shapes"];
        function loadIcons() { const c = document.getElementById('icon-grid-container'); c.innerHTML=""; icons.forEach(i => { const d=document.createElement('div'); d.className='icon-opt'; d.innerHTML=`<i class="fas ${i}"></i>`; d.onclick=()=>{document.querySelectorAll('.icon-opt').forEach(x=>x.classList.remove('selected')); d.classList.add('selected'); document.getElementById('p-selected-icon').value=i;}; c.appendChild(d); }); }

        function updateButtonPreview() {
            const btn = document.getElementById('demo-btn');
            btn.innerText = document.getElementById('set-text').value;
            btn.style.background = document.getElementById('set-color').value;
            
            // Åekil Reset
            btn.style.borderRadius = ""; btn.style.clipPath = ""; btn.style.transform = ""; btn.style.width="80px"; btn.style.height="80px";
            
            const shape = document.getElementById('set-shape').value;
            if(shape === 'shape-circle') btn.style.borderRadius = "50%";
            else if(shape === 'shape-square') btn.style.borderRadius = "15px";
            else if(shape === 'shape-leaf') btn.style.borderRadius = "50% 0 50% 50%";
            else if(shape === 'shape-cloud') { btn.style.borderRadius = "50px"; btn.style.width="120px"; }
            else if(shape === 'shape-star') { btn.style.clipPath = "polygon(50% 0%, 61% 35%, 98% 35%, 68% 57%, 79% 91%, 50% 70%, 21% 91%, 32% 57%, 2% 35%, 39% 35%)"; btn.style.width="100px"; btn.style.height="100px"; }
            else if(shape === 'shape-heart') { btn.style.clipPath = "path('M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z')"; btn.style.transform="scale(2.5)"; btn.style.marginTop="20px"; }
        }

        function daireKaydet() {
            db.collection("site_ayarlari").doc("ozel_duyuru").set({
                aktif: document.getElementById('set-active').checked,
                daireMetni: document.getElementById('set-text').value,
                link: document.getElementById('set-link').value,
                renk: document.getElementById('set-color').value,
                sekil: document.getElementById('set-shape').value,
                anim: "anim-pulse"
            }, {merge:true}).then(() => showToast("Ayarlar Kaydedildi"));
        }

        // --- Ä°STATÄ°STÄ°K & MESAJLAR ---
        function istatistikGetir() {
            const bugun = new Date().toISOString().split('T')[0];
            const ay = bugun.substring(0,7);
            db.collection("istatistik").get().then(snap => {
                let g=0, a=0, t=0;
                snap.forEach(d => { const v = d.data().ziyaret || 0; t+=v; if(d.id.startsWith(ay)) a+=v; if(d.id===bugun) g=v; });
                document.getElementById('stat-today').innerText = g;
                document.getElementById('stat-month').innerText = a;
                document.getElementById('stat-total').innerText = t;
            });
        }

        function mesajlariGetir() {
            db.collection("iletisim_talepleri").orderBy("tarih","desc").onSnapshot(s => {
                let h=""; document.getElementById('msg-badge').innerText = s.size;
                s.forEach(d => { const m = d.data(); h+=`<div class="item-row"><div class="item-info"><b>${m.ad_soyad}</b><br><small>${m.konu}</small></div><button class="btn-sm" style="background:#94a3b8;" onclick="sil('iletisim_talepleri','${d.id}')">Sil</button></div>`; });
                document.getElementById('mesaj-listesi').innerHTML = h;
            });
        }

        function vitrinVerileriniGetir() {
            db.collection("kitaplar").orderBy("tarih","desc").get().then(snap => {
                let h=""; snap.forEach(d => { const k=d.data(); h+=`<div class="item-row"><span>${k.baslik}</span><button class="btn-sm" style="background:var(--primary);" onclick="vitrinGuncelle('kitap','${k.baslik}','${k.link}'); showToast('SeÃ§ildi');">SEÃ‡</button></div>`; });
                document.getElementById('drop-kitap').innerHTML = h;
            });
            db.collection("yazilar").orderBy("tarih","desc").get().then(snap => {
                let h=""; snap.forEach(d => { const k=d.data(); h+=`<div class="item-row"><span>${k.baslik}</span><button class="btn-sm" style="background:var(--secondary);" onclick="vitrinGuncelle('yazi','${k.baslik}','ebeveyn-kosesi.html'); showToast('SeÃ§ildi');">SEÃ‡</button></div>`; });
                document.getElementById('drop-yazi').innerHTML = h;
            });
        }
        
        function duyuruEkle() { db.collection("duyurular").add({ metin: document.getElementById('d-metin').value, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>showToast("Duyuru YayÄ±nlandÄ±")); }
        function tavsiyeEkle() { db.collection("tavsiyeler").add({ baslik: document.getElementById('t-baslik').value, link: document.getElementById('t-link').value, tarih: firebase.firestore.FieldValue.serverTimestamp() }).then(()=>showToast("Tavsiye Eklendi")); }
        
        // Verileri Getir
        db.collection("site_ayarlari").doc("ozel_duyuru").get().then(d => {
            if(d.exists) { const v=d.data(); document.getElementById('set-text').value=v.daireMetni; document.getElementById('set-link').value=v.link; document.getElementById('set-shape').value=v.sekil; document.getElementById('set-color').value=v.renk; document.getElementById('set-active').checked=v.aktif; updateButtonPreview(); }
        });
    </script>
</body>
</html>
