<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Matematik Ustasƒ±: Arcade Modu</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Courier Prime", monospace;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            display: flex;
            min-height: 100vh;
            align-items: center;
            justify-content: center;
            background-color: #202020;
            flex-direction: column;
            overflow-y: auto; /* Kaydƒ±rmaya izin ver */
            overflow-x: hidden;
            padding: 10px;
        }

        /* --- √úst Bilgi Paneli --- */
        .game-header {
            width: 100%;
            max-width: 320px; /* Daraltƒ±ldƒ± */
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: #a7af7c;
            font-size: 0.8rem; /* K√º√ß√ºlt√ºld√º */
            margin-bottom: 8px;
            padding: 0 5px;
            font-weight: bold;
            text-shadow: 0 0 10px rgba(167, 175, 124, 0.3);
            z-index: 5;
        }

        .level-badge {
            background: #a7af7c;
            color: #202020;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem;
        }

        .container {
            position: relative;
            width: 100%;
            max-width: 320px; /* Daha kompakt */
            min-width: 260px;
            padding: 20px 15px 15px; /* Padding azaltƒ±ldƒ± */
            border-radius: 15px;
            box-shadow: 20px 20px 60px rgba(0, 0, 0, 0.25),
                10px 10px 50px rgba(0, 0, 0, 0.25), inset -5px -5px 15px rgba(0, 0, 0, 0.25),
                inset 5px 5px 15px rgba(0, 0, 0, 0.25);
            transform-origin: center;
            transition: transform 0.3s ease;
            margin: auto;
            z-index: 2;
            background: #202020;
        }

        .calculator {
            position: relative;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px; /* Bo≈üluk azaltƒ±ldƒ± */
        }

        /* Ekran Alanƒ± */
        .screen-area {
            grid-column: span 4;
            margin-bottom: 12px;
            background-color: #a7af7c;
            border-radius: 8px;
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.2), inset -2px -2px 5px rgba(255,255,255,0.1);
            padding: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 90px; /* Y√ºkseklik azaltƒ±ldƒ± */
            position: relative;
            overflow: hidden;
            transition: background-color 0.2s;
        }

        /* Zaman √áubuƒüu */
        .time-bar-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: rgba(0,0,0,0.1);
        }
        .time-bar {
            height: 100%;
            background: #d32f2f;
            width: 100%;
            transition: width 1s linear;
        }

        .question-text {
            font-size: 1.2em;
            color: #333;
            font-weight: bold;
            margin-bottom: 2px;
            text-align: center;
            z-index: 2;
        }

        .answer-input {
            width: 100%;
            background: transparent;
            border: none;
            outline: none;
            text-align: center;
            font-size: 1.6em; /* Font k√º√ß√ºlt√ºld√º */
            color: #000;
            border-bottom: 2px dashed #444;
            z-index: 2;
        }

        /* Seri (Combo) G√∂stergesi */
        .streak-container {
            position: absolute;
            top: 5px;
            right: 8px;
            font-size: 0.7em;
            color: #d32f2f;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s, transform 0.2s;
            display: flex;
            align-items: center;
            gap: 2px;
        }
        .streak-container.active {
            opacity: 1;
            transform: scale(1.1);
        }

        /* Tu≈ülar */
        .container span {
            color: #fff;
            position: relative;
            display: grid;
            width: 100%;
            aspect-ratio: 1; 
            place-items: center;
            background: linear-gradient(180deg, #2f2f2f, #3f3f3f);
            box-shadow: inset -3px 0 3px rgba(0, 0, 0, 0.15),
                inset 0 -3px 3px rgba(0, 0, 0, 0.25), 0 0 0 2px rgba(0, 0, 0, 0.75),
                4px 8px 12px rgba(0, 0, 0, 0.4);
            user-select: none;
            cursor: pointer;
            font-weight: 400;
            border-radius: 8px;
            transition: all 0.1s;
        }

        .container span:active {
            filter: brightness(1.3);
            transform: translateY(2px);
        }

        .container span::before {
            content: "";
            position: absolute;
            top: 3px;
            left: 3px;
            bottom: 6px;
            right: 6px;
            border-radius: 6px;
            background: linear-gradient(90deg, #2d2d2d, #4d4d4d);
            box-shadow: -4px -4px 10px rgba(0, 0, 0, 0.1),
                8px 4px 8px rgba(0, 0, 0, 0.15);
            border-left: 1px solid #0004;
            border-bottom: 1px solid #0004;
            border-top: 1px solid #0009;
            pointer-events: none;
        }

        .container span i {
            position: relative;
            font-style: normal;
            font-size: 1.1em; /* ƒ∞konlar k√º√ß√ºlt√ºld√º */
            text-transform: uppercase;
            z-index: 2;
        }

        /* Renkler */
        .calculator .clear { grid-column: span 2; width: 100%; background: #d32f2f; }
        .calculator .clear::before { background: linear-gradient(90deg, #b71c1c, #e57373); }

        .calculator .equal { background: #1976d2; grid-row: span 2; height: 100%; aspect-ratio: auto; }
        .calculator .equal::before { background: linear-gradient(90deg, #1565c0, #64b5f6); }

        .calculator .operator { color: #a7af7c; pointer-events: none; opacity: 0.5; }
        .calculator .plus { height: 100%; grid-row: span 2; aspect-ratio: auto; }

        /* Animasyonlar */
        @keyframes correct-flash {
            0% { background-color: #a7af7c; }
            50% { background-color: #4caf50; }
            100% { background-color: #a7af7c; }
        }
        @keyframes wrong-flash {
            0% { background-color: #a7af7c; }
            50% { background-color: #f44336; }
            100% { background-color: #a7af7c; }
        }
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

        .flash-correct { animation: correct-flash 0.4s ease; }
        .flash-wrong { animation: wrong-flash 0.4s ease; }
        .shake { animation: shake 0.5s; }

        /* Overlay & Canvas */
        .overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(32, 32, 32, 0.98);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10;
            border-radius: 15px;
            color: white;
            text-align: center;
            padding: 15px;
        }
        .overlay h2 { margin-bottom: 8px; color: #a7af7c; font-size: 1.5em; }
        .overlay p { color: #ccc; margin-bottom: 15px; font-size: 0.9em; }
        
        .start-btn {
            padding: 12px 30px;
            font-size: 1.1em;
            background: linear-gradient(45deg, #2196f3, #1976d2);
            color: white;
            border: none;
            border-radius: 40px;
            cursor: pointer;
            box-shadow: 0 8px 15px rgba(0,0,0,0.4);
            transition: transform 0.1s, box-shadow 0.1s;
            font-family: "Courier Prime", monospace;
            font-weight: bold;
        }
        .start-btn:active { transform: scale(0.95); box-shadow: 0 4px 8px rgba(0,0,0,0.4); }

        #confetti-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        /* Seviye Atlama Bildirimi */
        #levelUpNotice {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(255, 215, 0, 0.95);
            color: #000;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1.3em;
            font-weight: bold;
            z-index: 101; /* Konfetinin √ºzerinde olsun */
            pointer-events: none;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            text-align: center;
            width: max-content;
        }
        #levelUpNotice.show { transform: translate(-50%, -50%) scale(1); }

        /* Medya Sorgularƒ± */
        /* √áok b√ºy√ºk ekranlar */
        @media (min-width: 1800px) and (min-height: 1000px) {
            .container { transform: scale(1.5); margin-top: 50px; }
        }
        
        /* √áok k√º√ß√ºk ekranlar */
        @media (max-width: 360px) {
            body { padding: 5px; }
            .container { width: 100%; padding: 15px 10px; }
            .game-header { font-size: 0.75rem; margin-bottom: 5px; }
            .screen-area { height: 80px; margin-bottom: 8px; }
            .answer-input { font-size: 1.4em; }
            .question-text { font-size: 1.1em; }
            .container span i { font-size: 1em; }
        }
    </style>
</head>
<body>

    <canvas id="confetti-canvas"></canvas>

    <div id="levelUpNotice">SEVƒ∞YE ATLADIN!</div>

    <div class="game-header">
        <div class="level-badge" id="levelDisplay">Seviye 1</div>
        <div id="scoreDisplay">Puan: 0</div>
        <div id="livesDisplay">Can: ‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
    </div>

    <div class="container">
        <!-- Oyun Ba≈ülangƒ±√ß Ekranƒ± -->
        <div id="gameOverlay" class="overlay">
            <h2 id="overlayTitle">Matematik Ustasƒ±</h2>
            <p>Zamana Kar≈üƒ± Yarƒ±≈ü!</p>
            <p id="finalScore" style="display:none; font-size:1.1em; color:#4caf50;">Skorun: 0</p>
            <button class="start-btn" onclick="startGame()">BA≈ûLA</button>
        </div>

        <div class="calculator">
            <!-- Ekran -->
            <div class="screen-area" id="screenArea">
                <div class="time-bar-container">
                    <div class="time-bar" id="timeBar"></div>
                </div>
                <div class="streak-container" id="streakContainer">
                    üî• <span id="streakCount">x2</span>
                </div>

                <div class="question-text" id="questionText">Hazƒ±r?</div>
                <input type="text" readonly class="answer-input" id="answerInput" placeholder="?">
            </div>
            
            <!-- Tu≈ülar -->
            <span class="clear" onclick="clearInput()"><i>Sƒ∞L</i></span>
            <span class="operator"><i>/</i></span>
            <span class="operator"><i>*</i></span>
            
            <span class="num" onclick="appendNumber('7')"><i>7</i></span>
            <span class="num" onclick="appendNumber('8')"><i>8</i></span>
            <span class="num" onclick="appendNumber('9')"><i>9</i></span>
            <span class="operator"><i>-</i></span>
            
            <span class="num" onclick="appendNumber('4')"><i>4</i></span>
            <span class="num" onclick="appendNumber('5')"><i>5</i></span>
            <span class="num" onclick="appendNumber('6')"><i>6</i></span>
            <span class="plus operator"><i>+</i></span>
            
            <span class="num" onclick="appendNumber('1')"><i>1</i></span>
            <span class="num" onclick="appendNumber('2')"><i>2</i></span>
            <span class="num" onclick="appendNumber('3')"><i>3</i></span>
            
            <span class="num" onclick="appendNumber('0')"><i>0</i></span>
            <span class="num" onclick="appendNumber('00')"><i>00</i></span>
            <span class="equal" onclick="checkAnswer()"><i>G√ñNDER</i></span>
        </div>
    </div>

    <script>
        // Oyun Deƒüi≈ükenleri
        let score = 0;
        let lives = 3;
        let level = 1;
        let streak = 0;
        let currentResult = 0;
        let isGameActive = false;
        
        // Zamanlayƒ±cƒ±
        let timeLimit = 15; // Saniye
        let timeLeft = 15;
        let timerInterval;

        // DOM Elementleri
        const questionText = document.getElementById('questionText');
        const answerInput = document.getElementById('answerInput');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const livesDisplay = document.getElementById('livesDisplay');
        const levelDisplay = document.getElementById('levelDisplay');
        const screenArea = document.getElementById('screenArea');
        const timeBar = document.getElementById('timeBar');
        const streakContainer = document.getElementById('streakContainer');
        const streakCount = document.getElementById('streakCount');
        const overlay = document.getElementById('gameOverlay');
        const overlayTitle = document.getElementById('overlayTitle');
        const finalScore = document.getElementById('finalScore');
        const levelUpNotice = document.getElementById('levelUpNotice');

        // Ses Efektleri
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            const now = audioCtx.currentTime;

            if (type === 'correct') {
                // Pozitif "Ding" sesi
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(500, now);
                osc.frequency.exponentialRampToValueAtTime(1000, now + 0.1);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'wrong') {
                // Negatif "Buzz" sesi
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.2);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'levelup') {
                // Seviye atlama melodisi
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.setValueAtTime(600, now + 0.1);
                osc.frequency.setValueAtTime(800, now + 0.2);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
            }
        }

        function startGame() {
            score = 0;
            lives = 3;
            level = 1;
            streak = 0;
            isGameActive = true;
            updateUI();
            overlay.style.display = 'none';
            generateQuestion();
        }

        function updateUI() {
            scoreDisplay.innerText = `Puan: ${score}`;
            livesDisplay.innerText = `Can: ${"‚ù§Ô∏è".repeat(lives)}`;
            levelDisplay.innerText = `Seviye ${level}`;
            
            if (streak > 1) {
                streakContainer.classList.add('active');
                streakCount.innerText = `x${streak}`;
            } else {
                streakContainer.classList.remove('active');
            }
        }

        function startTimer() {
            clearInterval(timerInterval);
            // Seviyeye g√∂re s√ºreyi azalt (min 5 saniye)
            timeLimit = Math.max(5, 15 - (level - 1)); 
            timeLeft = timeLimit;
            
            timeBar.style.width = '100%';
            timeBar.style.transition = 'none';
            timeBar.offsetHeight; /* Trigger reflow */
            timeBar.style.transition = `width ${timeLimit}s linear`;
            timeBar.style.width = '0%';

            timerInterval = setInterval(() => {
                timeLeft--;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    handleTimeOut();
                }
            }, 1000);
        }

        function handleTimeOut() {
            if (!isGameActive) return;
            lives--;
            streak = 0; // S√ºre bitince seri bozulur
            playSound('wrong');
            screenArea.classList.add('flash-wrong');
            setTimeout(() => screenArea.classList.remove('flash-wrong'), 500);
            
            if (lives <= 0) {
                gameOver();
            } else {
                generateQuestion();
            }
            updateUI();
        }

        function generateQuestion() {
            if (!isGameActive) return;

            // Seviye Kontrol√º (Her 100 puanda bir seviye atla)
            let newLevel = Math.floor(score / 100) + 1;
            if (newLevel > level) {
                level = newLevel;
                showLevelUp();
            }

            const operations = ['+', '-', '*', '/'];
            let op;
            
            // Seviyeye g√∂re i≈ülem havuzu
            if (level === 1) op = operations[Math.floor(Math.random() * 3)]; // /, yok
            else op = operations[Math.floor(Math.random() * 4)];

            // Sayƒ± aralƒ±klarƒ± seviyeye g√∂re artar
            let maxNum = 10 * level + 10; 

            if (op === '+') {
                const n1 = Math.floor(Math.random() * maxNum) + 5;
                const n2 = Math.floor(Math.random() * maxNum) + 5;
                currentResult = n1 + n2;
                questionText.innerText = `${n1} + ${n2} = ?`;
            } else if (op === '-') {
                const n1 = Math.floor(Math.random() * maxNum) + 5;
                const n2 = Math.floor(Math.random() * maxNum) + 5;
                const big = Math.max(n1, n2);
                const small = Math.min(n1, n2);
                currentResult = big - small;
                questionText.innerText = `${big} - ${small} = ?`;
            } else if (op === '*') {
                // √áarpma biraz daha k√º√ß√ºk sayƒ±larla olsun
                let factor = Math.min(12, level + 5);
                const n1 = Math.floor(Math.random() * factor) + 2;
                const n2 = Math.floor(Math.random() * 10) + 1;
                currentResult = n1 * n2;
                questionText.innerText = `${n1} x ${n2} = ?`;
            } else if (op === '/') {
                // B√∂lme: Tam sayƒ± √ßƒ±kmalƒ±
                let factor = Math.min(12, level + 5);
                const resultVal = Math.floor(Math.random() * factor) + 2;
                const divisor = Math.floor(Math.random() * 8) + 2;
                const dividend = resultVal * divisor;
                currentResult = resultVal;
                questionText.innerText = `${dividend} / ${divisor} = ?`;
            }

            answerInput.value = '';
            startTimer();
            updateUI();
        }

        function showLevelUp() {
            playSound('levelup');
            levelUpNotice.innerText = `SEVƒ∞YE ${level}!`;
            levelUpNotice.classList.add('show');
            fireConfetti();
            setTimeout(() => {
                levelUpNotice.classList.remove('show');
            }, 2000);
        }

        function appendNumber(num) {
            if (!isGameActive) return;
            if (answerInput.value.length < 5) answerInput.value += num;
        }

        function clearInput() {
            answerInput.value = '';
        }

        function checkAnswer() {
            if (!isGameActive) return;
            if (answerInput.value === '') return;
            
            clearInterval(timerInterval); // Cevap verilince s√ºreyi durdur

            const userVal = parseInt(answerInput.value);

            if (userVal === currentResult) {
                // DOƒûRU
                streak++;
                // Puan hesabƒ±: Temel puan (10) + (Seri * 2)
                let addedScore = 10 + (streak > 1 ? (streak * 2) : 0);
                score += addedScore;
                
                playSound('correct');
                screenArea.classList.add('flash-correct');
                setTimeout(() => screenArea.classList.remove('flash-correct'), 500);
                generateQuestion();
            } else {
                // YANLI≈û
                streak = 0;
                lives--;
                playSound('wrong');
                
                // Shake efekti
                document.querySelector('.container').classList.add('shake');
                screenArea.classList.add('flash-wrong');
                setTimeout(() => {
                    document.querySelector('.container').classList.remove('shake');
                    screenArea.classList.remove('flash-wrong');
                }, 500);

                if (lives <= 0) {
                    gameOver();
                } else {
                    answerInput.value = '';
                    generateQuestion(); // Yanlƒ±≈üta da yeni soru gelsin mi? Evet, takƒ±lmasƒ±n.
                }
            }
            updateUI();
        }

        function gameOver() {
            isGameActive = false;
            clearInterval(timerInterval);
            overlayTitle.innerText = "OYUN Bƒ∞TTƒ∞!";
            overlay.querySelector('p').innerText = `Ula≈üƒ±lan Seviye: ${level}`;
            finalScore.innerText = `TOPLAM SKOR: ${score}`;
            finalScore.style.display = 'block';
            overlay.querySelector('button').innerText = "TEKRAR DENE";
            overlay.style.display = 'flex';
        }

        // --- BASƒ∞T KONFETƒ∞ Sƒ∞STEMƒ∞ ---
        const canvas = document.getElementById('confetti-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        function fireConfetti() {
            for (let i = 0; i < 100; i++) {
                particles.push({
                    x: canvas.width / 2,
                    y: canvas.height / 2,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    color: `hsl(${Math.random() * 360}, 100%, 50%)`,
                    life: 100
                });
            }
            animateConfetti();
        }

        function animateConfetti() {
            if (particles.length === 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                return;
            }
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            for (let i = 0; i < particles.length; i++) {
                let p = particles[i];
                p.x += p.vx;
                p.y += p.vy;
                p.life--;
                
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 5, 5);
            }
            
            particles = particles.filter(p => p.life > 0);
            requestAnimationFrame(animateConfetti);
        }

        // Klavye Desteƒüi
        document.addEventListener('keydown', (e) => {
            if (!isGameActive) {
                if(e.key === 'Enter') startGame();
                return;
            }
            if (e.key >= '0' && e.key <= '9') appendNumber(e.key);
            else if (e.key === 'Enter') checkAnswer();
            else if (e.key === 'Backspace' || e.key === 'Delete') answerInput.value = answerInput.value.slice(0, -1);
            else if (e.key.toLowerCase() === 'c') clearInput();
        });

    </script>
</body>
</html>
