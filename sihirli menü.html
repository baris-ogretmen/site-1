<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Zihin Akademisi Ultimate - Eƒüitim Oyunu</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Poppins:100,200,300,400,500,600,700,800,900" rel="stylesheet">
    <!-- Confetti -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            --clr: #222327;
            --active-color: #00d2ff; /* Tema rengi Mavi Neon'a d√∂nd√º */
            --bg-color: #111827;
            --panel-bg: rgba(17, 24, 39, 0.85);
            --danger: #ff4757;
            --success: #2ecc71;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Poppins", sans-serif;
            touch-action: manipulation; 
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            height: 100dvh;
            background: var(--bg-color);
            color: #fff;
            overflow: hidden;
            background-image: radial-gradient(circle at 50% 0%, #1f2937 0%, #111827 100%);
        }

        /* OYUN ALANI */
        #game-container {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            padding-bottom: 100px;
            width: 100%;
            position: relative;
        }

        .game-section {
            display: none;
            width: 100%;
            max-width: 600px;
            height: 100%;
            flex-direction: column;
            justify-content: center;
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .game-section.active-section { display: flex; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* CAM PANEL */
        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-radius: 30px;
            border: 1px solid rgba(255, 255, 255, 0.08);
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
        }

        /* HEADER Bƒ∞LGƒ∞LERƒ∞ */
        .game-header {
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        .heart-container { color: var(--danger); display: flex; gap: 4px; font-size: 1.2rem; }
        .score-badge { background: rgba(0, 210, 255, 0.2); color: #00d2ff; padding: 4px 12px; rounded-full; font-size: 0.9rem; font-weight: 700; }
        .combo-text { color: #f1c40f; font-weight: 800; font-size: 0.9rem; opacity: 0; transition: 0.3s; }
        .combo-active { opacity: 1; transform: scale(1.1); animation: pulse 0.5s infinite; }

        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

        /* TIMER BAR */
        .timer-track { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 3px; overflow: hidden; margin-bottom: 20px; }
        .timer-fill { height: 100%; background: var(--active-color); width: 100%; transform-origin: left; }

        /* BUTONLAR */
        .btn-game {
            background: var(--active-color); color: #000; padding: 16px; width: 100%; border-radius: 16px;
            font-weight: 700; font-size: 1.1rem; border: none; cursor: pointer; transition: 0.2s;
            box-shadow: 0 0 15px rgba(0, 210, 255, 0.3); margin-top: 15px;
        }
        .btn-game:active { transform: scale(0.96); }

        .grid-options { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; width: 100%; }
        .option-btn {
            background: rgba(255,255,255,0.05); color: #fff; padding: 20px; border-radius: 16px;
            font-size: 1.8rem; font-weight: 600; border: 2px solid transparent; cursor: pointer; transition: 0.2s;
            display: flex; justify-content: center; align-items: center; min-height: 80px;
        }
        .option-btn:active { background: rgba(255,255,255,0.1); transform: scale(0.98); }

        /* Emoji Grid (Dikkat Oyunu) */
        .emoji-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; width: 100%; }
        .emoji-btn {
            aspect-ratio: 1; background: rgba(255,255,255,0.05); border-radius: 12px; font-size: 1.8rem;
            display: flex; justify-content: center; align-items: center; cursor: pointer; border: 2px solid transparent;
        }

        /* CEVAP EFEKTLERƒ∞ */
        .correct-anim { background: var(--success) !important; color: #000 !important; border-color: var(--success); transform: scale(1.05); box-shadow: 0 0 20px var(--success); }
        .wrong-anim { background: var(--danger) !important; color: #fff !important; border-color: var(--danger); animation: shake 0.4s; }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        /* NAVƒ∞GASYON */
        .navigation-wrapper { position: fixed; bottom: 20px; width: 100%; display: flex; justify-content: center; z-index: 100; pointer-events: none; }
        .navigation {
            position: relative; width: 380px; height: 70px; background: #1f2937;
            display: flex; justify-content: center; align-items: center; border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.6); pointer-events: auto; border: 1px solid rgba(255,255,255,0.1);
        }
        .navigation ul { display: flex; width: 350px; padding: 0; margin: 0; }
        .navigation ul li { position: relative; list-style: none; width: 70px; height: 70px; z-index: 1; }
        .navigation ul li a {
            position: relative; display: flex; justify-content: center; align-items: center;
            flex-direction: column; width: 100%; height: 100%; text-decoration: none;
        }
        .navigation ul li a .icon {
            position: relative; display: block; line-height: 75px; font-size: 1.6em;
            text-align: center; transition: 0.5s; color: #6b7280;
        }
        .navigation ul li.active a .icon { transform: translateY(-32px); color: var(--active-color); }
        .navigation ul li a .text {
            position: absolute; color: var(--active-color); font-weight: 600; font-size: 0.7em;
            letter-spacing: 0.05em; transition: 0.5s; opacity: 0; transform: translateY(20px);
        }
        .navigation ul li.active a .text { opacity: 1; transform: translateY(10px); }

        .indicator {
            position: absolute; top: -50%; left: 0; width: 70px; height: 70px;
            background: var(--active-color); border-radius: 50%;
            border: 6px solid var(--bg-color); transition: 0.5s;
            box-shadow: 0 0 15px var(--active-color);
        }

        /* Indicator Konumlarƒ± (5 eleman i√ßin dinamik) */
        .navigation ul li:nth-child(1).active ~ .indicator { transform: translateX(0px); }
        .navigation ul li:nth-child(2).active ~ .indicator { transform: translateX(70px); }
        .navigation ul li:nth-child(3).active ~ .indicator { transform: translateX(140px); }
        .navigation ul li:nth-child(4).active ~ .indicator { transform: translateX(210px); }
        .navigation ul li:nth-child(5).active ~ .indicator { transform: translateX(280px); }

        /* FULLSCREEN BUTON */
        #fullscreen-btn {
            position: absolute; top: 15px; right: 15px; background: rgba(255,255,255,0.1);
            width: 40px; height: 40px; border-radius: 10px; color: #fff; cursor: pointer;
            display: flex; justify-content: center; align-items: center; border: none; z-index: 50;
        }

    </style>
</head>

<body>
    
    <button id="fullscreen-btn" onclick="toggleFullScreen()"><ion-icon name="expand-outline"></ion-icon></button>

    <div id="game-container">
        
        <!-- 1. Gƒ∞Rƒ∞≈û EKRANI -->
        <div id="section-home" class="game-section active-section">
            <div class="glass-panel">
                <div class="mb-4 relative">
                    <div class="absolute inset-0 bg-blue-500 blur-xl opacity-20 rounded-full"></div>
                    <ion-icon name="game-controller" style="font-size: 4.5rem; color: #00d2ff; position: relative;"></ion-icon>
                </div>
                <h1 class="text-3xl font-bold mb-2 tracking-tight">Zihin Akademisi</h1>
                <p class="text-gray-400 mb-8 text-sm">Zekanƒ± Test Et ‚Ä¢ Geli≈ü ‚Ä¢ Yarƒ±≈ü</p>
                
                <div class="grid grid-cols-2 gap-4 w-full mb-6">
                    <div class="bg-gray-800/50 p-4 rounded-2xl flex flex-col items-center border border-gray-700">
                        <span class="text-2xl font-bold text-yellow-400" id="total-xp">0</span>
                        <span class="text-[10px] text-gray-500 uppercase tracking-widest mt-1">TOPLAM XP</span>
                    </div>
                    <div class="bg-gray-800/50 p-4 rounded-2xl flex flex-col items-center border border-gray-700">
                        <span class="text-2xl font-bold text-green-400" id="games-played">0</span>
                        <span class="text-[10px] text-gray-500 uppercase tracking-widest mt-1">OYUN</span>
                    </div>
                </div>
                <div class="text-xs text-gray-500 animate-pulse">üëá Ba≈ülamak i√ßin men√ºden bir oyun se√ßin</div>
            </div>
        </div>

        <!-- ORTAK OYUN ARAY√úZ√ú (≈ûablon) -->
        <!-- ƒ∞√ßerik JS ile dinamik doldurulacak -->
        
        <!-- 2. MATEMATƒ∞K -->
        <div id="section-math" class="game-section">
            <div class="glass-panel">
                <div class="game-header">
                    <div class="flex flex-col items-start">
                        <span class="text-xs text-gray-400">MATEMATƒ∞K</span>
                        <span class="text-lg font-bold" id="math-progress">1 / 15</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span class="combo-text" id="math-combo">COMBO x2!</span>
                    </div>
                    <div class="flex flex-col items-end">
                        <div class="heart-container" id="math-hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                        <span class="score-badge" id="math-score">0 XP</span>
                    </div>
                </div>
                <div class="timer-track"><div id="math-timer" class="timer-fill"></div></div>

                <div class="mb-8 mt-4">
                    <span id="math-question" class="text-5xl font-mono font-bold text-white tracking-wider">? + ?</span>
                </div>
                <div id="math-options" class="grid-options"></div>
            </div>
        </div>

        <!-- 3. KELƒ∞ME -->
        <div id="section-word" class="game-section">
            <div class="glass-panel">
                <div class="game-header">
                    <div class="flex flex-col items-start">
                        <span class="text-xs text-gray-400">KELƒ∞ME</span>
                        <span class="text-lg font-bold" id="word-progress">1 / 15</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span class="combo-text" id="word-combo">COMBO x2!</span>
                    </div>
                    <div class="flex flex-col items-end">
                        <div class="heart-container" id="word-hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                        <span class="score-badge" id="word-score">0 XP</span>
                    </div>
                </div>
                <div class="timer-track"><div id="word-timer" class="timer-fill"></div></div>

                <div class="mb-6 mt-2 w-full">
                    <span id="scrambled-word" class="text-4xl font-bold tracking-[0.2em] uppercase text-yellow-400 block mb-2 break-all">?</span>
                    <div id="word-hint" class="text-xs text-gray-400 italic bg-gray-800/50 inline-block px-3 py-1 rounded-full">ƒ∞pucu: ...</div>
                </div>
                
                <input type="text" id="word-input" class="w-full bg-gray-800 border border-gray-600 rounded-xl p-4 text-center text-white text-xl mb-4 uppercase focus:outline-none focus:border-blue-500 transition" placeholder="CEVABI YAZ" autocomplete="off">
                <button onclick="checkWord()" class="btn-game">KONTROL ET</button>
            </div>
        </div>

        <!-- 4. Dƒ∞KKAT (YENƒ∞ OYUN) -->
        <div id="section-attention" class="game-section">
            <div class="glass-panel">
                <div class="game-header">
                    <div class="flex flex-col items-start">
                        <span class="text-xs text-gray-400">Dƒ∞KKAT</span>
                        <span class="text-lg font-bold" id="att-progress">1 / 15</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span class="combo-text" id="att-combo">COMBO x2!</span>
                    </div>
                    <div class="flex flex-col items-end">
                        <div class="heart-container" id="att-hearts">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
                        <span class="score-badge" id="att-score">0 XP</span>
                    </div>
                </div>
                <div class="timer-track"><div id="att-timer" class="timer-fill"></div></div>
                
                <p class="mb-4 text-sm text-gray-300">Farklƒ± olan emojiyi bul!</p>
                <div id="att-grid" class="emoji-grid"></div>
            </div>
        </div>

        <!-- 5. AYARLAR -->
        <div id="section-settings" class="game-section">
            <div class="glass-panel">
                <h2 class="text-2xl font-bold mb-6">Ayarlar</h2>
                <div class="w-full max-w-xs space-y-4">
                    <div class="flex justify-between items-center bg-gray-800 p-4 rounded-xl cursor-pointer" onclick="toggleSound()">
                        <span>Ses Efektleri</span>
                        <div class="w-10 h-6 bg-gray-600 rounded-full relative transition-colors" id="sound-toggle-bg">
                            <div class="w-4 h-4 bg-white rounded-full absolute top-1 left-1 transition-all" id="sound-toggle-knob"></div>
                        </div>
                    </div>
                    <button onclick="resetStats()" class="btn-game" style="background: rgba(255, 71, 87, 0.2); color: #ff4757;">Verileri Sƒ±fƒ±rla</button>
                </div>
                <div class="mt-8 text-xs text-gray-600">v4.0 Final ‚Ä¢ Zihin Akademisi</div>
            </div>
        </div>

        <!-- SONU√á EKRANI -->
        <div id="section-result" class="game-section">
            <div class="glass-panel">
                <div class="mb-4">
                    <ion-icon name="trophy" class="text-yellow-400 text-6xl animate-bounce"></ion-icon>
                </div>
                <h2 class="text-3xl font-bold mb-2 text-white">Oyun Bitti!</h2>
                
                <div class="text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-green-400 mb-6" id="result-final-score">0 XP</div>
                
                <div class="flex justify-center gap-8 w-full mb-8">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-400" id="result-correct">0</div>
                        <div class="text-[10px] text-gray-400 uppercase">Doƒüru</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-red-400" id="result-wrong">0</div>
                        <div class="text-[10px] text-gray-400 uppercase">Yanlƒ±≈ü</div>
                    </div>
                </div>

                <button onclick="goHome()" class="btn-game">Ana Men√ºye D√∂n</button>
            </div>
        </div>

    </div>

    <!-- MEN√ú -->
    <div class="navigation-wrapper">
        <div class="navigation">
            <ul>
                <li class="list active" data-target="section-home"><a href="#"><span class="icon"><ion-icon name="home-outline"></ion-icon></span><span class="text">Giri≈ü</span></a></li>
                <li class="list" data-target="section-math"><a href="#"><span class="icon"><ion-icon name="calculator-outline"></ion-icon></span><span class="text">Mat.</span></a></li>
                <li class="list" data-target="section-word"><a href="#"><span class="icon"><ion-icon name="text-outline"></ion-icon></span><span class="text">Kelime</span></a></li>
                <li class="list" data-target="section-attention"><a href="#"><span class="icon"><ion-icon name="eye-outline"></ion-icon></span><span class="text">Dikkat</span></a></li>
                <li class="list" data-target="section-settings"><a href="#"><span class="icon"><ion-icon name="settings-outline"></ion-icon></span><span class="text">Ayar</span></a></li>
                <div class="indicator"></div>
            </ul>
        </div>
    </div>

    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

    <script>
        // --- SES Sƒ∞STEMƒ∞ ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        let soundEnabled = true;

        function playSound(type) {
            if (!soundEnabled) return;
            if (audioCtx.state === 'suspended') audioCtx.resume();

            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            const now = audioCtx.currentTime;

            if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, now);
                osc.frequency.exponentialRampToValueAtTime(1000, now + 0.1);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'wrong') {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.2);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.linearRampToValueAtTime(0.01, now + 0.3);
                osc.start(now);
                osc.stop(now + 0.3);
            } else if (type === 'click') {
                osc.type = 'triangle';
                osc.frequency.setValueAtTime(300, now);
                gainNode.gain.setValueAtTime(0.05, now);
                gainNode.gain.exponentialRampToValueAtTime(0.001, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            const bg = document.getElementById('sound-toggle-bg');
            const knob = document.getElementById('sound-toggle-knob');
            if(soundEnabled) {
                bg.classList.remove('bg-gray-600'); bg.classList.add('bg-green-500');
                knob.style.transform = 'translateX(16px)';
            } else {
                bg.classList.add('bg-gray-600'); bg.classList.remove('bg-green-500');
                knob.style.transform = 'translateX(0)';
            }
        }

        // --- OYUN MOTORU ---
        const MAX_QUESTIONS = 15;
        const MAX_LIVES = 3;
        
        let gameState = {
            activeGame: null, // 'math', 'word', 'attention'
            questionIndex: 0,
            score: 0,
            correctCount: 0,
            wrongCount: 0,
            lives: 3,
            combo: 0,
            timerId: null,
            timeLimit: 10
        };

        // ƒ∞statistikler
        let totalXP = parseInt(localStorage.getItem('za_xp')) || 0;
        let gamesPlayed = parseInt(localStorage.getItem('za_games')) || 0;
        updateDashboard();

        // Navigasyon
        const list = document.querySelectorAll(".list");
        const sections = document.querySelectorAll(".game-section");
        
        function activeLink() {
            list.forEach((item) => item.classList.remove("active"));
            this.classList.add("active");
            playSound('click');
            const targetId = this.getAttribute('data-target');
            changeSection(targetId);
        }
        list.forEach((item) => item.addEventListener("click", activeLink));

        function changeSection(id) {
            stopTimer(); // √ñnceki zamanlayƒ±cƒ±yƒ± durdur
            
            sections.forEach(sec => {
                sec.classList.remove('active-section');
                sec.style.opacity = '0';
            });
            
            // Kƒ±sa bir gecikme ile yeni b√∂l√ºm√º a√ß (animasyon i√ßin)
            setTimeout(() => {
                const target = document.getElementById(id);
                if(target) {
                    target.classList.add('active-section');
                    // Reflow
                    void target.offsetWidth;
                    target.style.opacity = '1';

                    // Oyun Ba≈ülatƒ±cƒ±larƒ±
                    if(id === 'section-math') startGame('math');
                    else if(id === 'section-word') startGame('word');
                    else if(id === 'section-attention') startGame('attention');
                }
            }, 100);
        }

        function startGame(type) {
            gameState = {
                activeGame: type,
                questionIndex: 1,
                score: 0,
                correctCount: 0,
                wrongCount: 0,
                lives: 3,
                combo: 0,
                timerId: null,
                timeLimit: type === 'word' ? 15 : 10
            };
            updateGameUI();
            nextQuestion();
        }

        function updateGameUI() {
            const prefix = gameState.activeGame === 'attention' ? 'att' : gameState.activeGame;
            
            // Progress
            const progEl = document.getElementById(`${prefix}-progress`);
            if(progEl) progEl.innerText = `${gameState.questionIndex} / ${MAX_QUESTIONS}`;

            // Score
            const scoreEl = document.getElementById(`${prefix}-score`);
            if(scoreEl) scoreEl.innerText = `${gameState.score} XP`;

            // Hearts
            const heartsEl = document.getElementById(`${prefix}-hearts`);
            if(heartsEl) heartsEl.innerText = '‚ù§Ô∏è'.repeat(gameState.lives) + 'üñ§'.repeat(MAX_LIVES - gameState.lives);

            // Combo
            const comboEl = document.getElementById(`${prefix}-combo`);
            if(comboEl) {
                if(gameState.combo > 1) {
                    comboEl.innerText = `COMBO x${gameState.combo}!`;
                    comboEl.classList.add('combo-active');
                } else {
                    comboEl.innerText = "";
                    comboEl.classList.remove('combo-active');
                }
            }
        }

        function nextQuestion() {
            updateGameUI();
            
            if(gameState.activeGame === 'math') generateMathQuestion();
            else if(gameState.activeGame === 'word') generateWordQuestion();
            else if(gameState.activeGame === 'attention') generateAttentionQuestion();
        }

        function startTimer(elementId) {
            stopTimer();
            const bar = document.getElementById(elementId);
            bar.style.transition = 'none';
            bar.style.width = '100%';
            void bar.offsetWidth; // Force Reflow
            
            bar.style.transition = `width ${gameState.timeLimit}s linear`;
            bar.style.width = '0%';

            gameState.timerId = setTimeout(() => {
                handleAnswer(false); // S√ºre bitti = Yanlƒ±≈ü
            }, gameState.timeLimit * 1000);
        }

        function stopTimer() {
            if(gameState.timerId) clearTimeout(gameState.timerId);
            document.querySelectorAll('.timer-fill').forEach(bar => {
                bar.style.transition = 'none';
                bar.style.width = '100%';
            });
        }

        function handleAnswer(isCorrect) {
            stopTimer();
            
            if(isCorrect) {
                playSound('correct');
                gameState.correctCount++;
                gameState.combo++;
                // Puan Hesabƒ±: Temel Puan * Combo
                const points = 10 * Math.min(gameState.combo, 5); 
                gameState.score += points;
            } else {
                playSound('wrong');
                gameState.wrongCount++;
                gameState.combo = 0; // Combo sƒ±fƒ±rla
                gameState.lives--;
                
                // Ekranƒ± salla
                document.body.style.animation = "shake 0.3s";
                setTimeout(() => document.body.style.animation = "", 300);
            }

            updateGameUI();

            // Oyun Sonu Kontrol√º
            if(gameState.lives <= 0 || gameState.questionIndex >= MAX_QUESTIONS) {
                setTimeout(endGame, 1000);
            } else {
                gameState.questionIndex++;
                setTimeout(nextQuestion, 800);
            }
        }

        function endGame() {
            // ƒ∞statistikleri Kaydet
            totalXP += gameState.score;
            gamesPlayed++;
            localStorage.setItem('za_xp', totalXP);
            localStorage.setItem('za_games', gamesPlayed);
            updateDashboard();

            // Sonu√ßlarƒ± G√∂ster
            document.getElementById('result-final-score').innerText = gameState.score + " XP";
            document.getElementById('result-correct').innerText = gameState.correctCount;
            document.getElementById('result-wrong').innerText = gameState.wrongCount;

            changeSection('section-result');

            if(gameState.score > 50) {
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            }
        }

        function updateDashboard() {
            document.getElementById('total-xp').innerText = totalXP;
            document.getElementById('games-played').innerText = gamesPlayed;
        }

        function goHome() {
            list[0].click(); // Giri≈ü butonuna tƒ±kla
        }


        // --- 1. MATEMATƒ∞K MANTIƒûI (D√ºzeltilmi≈ü) ---
        function generateMathQuestion() {
            const difficulty = Math.ceil(gameState.questionIndex / 3) * 5;
            let num1 = Math.floor(Math.random() * (10 + difficulty)) + 2;
            let num2 = Math.floor(Math.random() * (10 + difficulty)) + 2;
            const isPlus = Math.random() > 0.4; // %60 Toplama

            if (!isPlus && num1 < num2) [num1, num2] = [num2, num1]; // Negatif engelle

            const answer = isPlus ? num1 + num2 : num1 - num2;
            document.getElementById('math-question').innerText = `${num1} ${isPlus ? '+' : '-'} ${num2}`;

            // ≈ûƒ±k √úretimi (Sonsuz D√∂ng√º Korumalƒ±)
            let options = new Set();
            options.add(answer);

            let safety = 0;
            while(options.size < 4 && safety < 50) {
                safety++;
                // Rastgele yakƒ±n sayƒ± √ºret (√∂rn: cevap +3, cevap -2)
                let offset = Math.floor(Math.random() * 10) - 5; 
                if(offset === 0) offset = 1;
                
                let wrong = answer + offset;
                if(wrong >= 0) options.add(wrong);
            }
            
            // Eƒüer hala 4 tane yoksa rastgele doldur
            while(options.size < 4) {
                options.add(Math.floor(Math.random() * 50));
            }

            // Set'i Array'e √ßevir ve karƒ±≈ütƒ±r
            const optsArr = Array.from(options).sort(() => Math.random() - 0.5);

            const container = document.getElementById('math-options');
            container.innerHTML = '';

            optsArr.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.innerText = opt;
                btn.onclick = (e) => {
                    disableAllButtons(container);
                    if(opt === answer) {
                        e.target.classList.add('correct-anim');
                        handleAnswer(true);
                    } else {
                        e.target.classList.add('wrong-anim');
                        handleAnswer(false);
                    }
                };
                container.appendChild(btn);
            });

            startTimer('math-timer');
        }

        // --- 2. KELƒ∞ME MANTIƒûI ---
        const words = [
            {w:"ELMA", h:"Meyve"}, {w:"MASA", h:"E≈üya"}, {w:"OKUL", h:"Eƒüitim"},
            {w:"KEDƒ∞", h:"Hayvan"}, {w:"MAVƒ∞", h:"Renk"}, {w:"SAYI", h:"Matematik"},
            {w:"Bƒ∞Lƒ∞M", h:"ƒ∞lim"}, {w:"Kƒ∞TAP", h:"Okuma"}, {w:"G√úNE≈û", h:"Yƒ±ldƒ±z"},
            {w:"D√úNYA", h:"Gezegen"}, {w:"ROBOT", h:"Makine"}, {w:"YAZILIM", h:"Kod"},
            {w:"EKRAN", h:"Monit√∂r"}, {w:"KLAVYE", h:"Tu≈ülar"}, {w:"M√úZƒ∞K", h:"Sanat"}
        ];
        let currentWord = {};

        function generateWordQuestion() {
            document.getElementById('word-input').value = "";
            document.getElementById('word-input').disabled = false;
            document.getElementById('word-input').focus();

            currentWord = words[Math.floor(Math.random() * words.length)];
            const scrambled = currentWord.w.split('').sort(() => Math.random() - 0.5).join('');
            
            document.getElementById('scrambled-word').innerText = scrambled;
            document.getElementById('word-hint').innerText = `ƒ∞pucu: ${currentWord.h}`;

            startTimer('word-timer');
        }

        window.checkWord = function() {
            const input = document.getElementById('word-input');
            const val = input.value.toUpperCase().trim();
            
            if(!val) return; // Bo≈üsa i≈ülem yapma
            
            input.disabled = true;
            if(val === currentWord.w) {
                input.style.borderColor = "#2ecc71";
                handleAnswer(true);
            } else {
                input.style.borderColor = "#ff4757";
                handleAnswer(false);
            }
        }
        // Enter desteƒüi
        document.getElementById('word-input').addEventListener("keypress", (e) => {
            if(e.key === "Enter") checkWord();
        });


        // --- 3. Dƒ∞KKAT MANTIƒûI (YENƒ∞) ---
        const emojiSets = [
            {base: 'üòÄ', odd: 'üòÉ'}, {base: 'üöÄ', odd: 'üõ∏'}, {base: 'üê±', odd: 'üêØ'},
            {base: 'üçé', odd: 'üçÖ'}, {base: '‚öΩ', odd: 'üèÄ'}, {base: 'üïí', odd: 'üïì'},
            {base: '‚≠ê', odd: 'üåü'}, {base: 'üöó', odd: 'üöï'}, {base: 'üè†', odd: 'üè°'}
        ];

        function generateAttentionQuestion() {
            const grid = document.getElementById('att-grid');
            grid.innerHTML = '';
            
            // Zorluƒüa g√∂re grid boyutu (4x4 sabit ≈üimdilik, CSS grid yapƒ±sƒ± buna g√∂re)
            const count = 16; 
            const set = emojiSets[Math.floor(Math.random() * emojiSets.length)];
            const oddIndex = Math.floor(Math.random() * count);

            for(let i=0; i<count; i++) {
                const btn = document.createElement('div');
                btn.className = 'emoji-btn';
                btn.innerText = (i === oddIndex) ? set.odd : set.base;
                
                btn.onclick = (e) => {
                    // Tƒ±klamalarƒ± durdur
                    const all = grid.querySelectorAll('.emoji-btn');
                    all.forEach(d => d.style.pointerEvents = 'none');

                    if(i === oddIndex) {
                        e.target.style.backgroundColor = 'var(--success)';
                        handleAnswer(true);
                    } else {
                        e.target.style.backgroundColor = 'var(--danger)';
                        // Doƒüruyu g√∂ster
                        all[oddIndex].style.backgroundColor = 'rgba(46, 204, 113, 0.5)';
                        handleAnswer(false);
                    }
                };
                grid.appendChild(btn);
            }
            startTimer('att-timer');
        }

        // Yardƒ±mcƒ±lar
        function disableAllButtons(container) {
            const btns = container.querySelectorAll('button');
            btns.forEach(b => b.disabled = true);
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(e => console.log(e));
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        }

        function resetStats() {
            if(confirm("T√ºm puanlar sƒ±fƒ±rlanacak?")) {
                localStorage.removeItem('za_xp');
                localStorage.removeItem('za_games');
                totalXP = 0; gamesPlayed = 0;
                updateDashboard();
            }
        }

        // Ba≈ülangƒ±√ß
        list[0].click();

    </script>
</body>
</html>
