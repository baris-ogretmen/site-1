<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klinik GeliÅŸim Envanteri | BarÄ±ÅŸ Ä°lkan</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #2563eb; /* Medikal Mavi */
            --primary-dark: #1e40af;
            --secondary: #0f766e; /* Teal */
            --bg: #f8fafc;
            --surface: #ffffff;
            --text: #1e293b;
            --border: #e2e8f0;
        }

        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; }

        /* --- HEADER --- */
        .clinic-header {
            background: white; border-bottom: 1px solid var(--border); padding: 20px 40px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); position: relative; z-index: 10;
        }
        .brand { display: flex; align-items: center; gap: 15px; }
        .brand-icon { width: 45px; height: 45px; background: var(--primary); color: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .brand-text h1 { margin: 0; font-size: 1.2rem; font-weight: 700; color: var(--primary-dark); }
        .brand-text p { margin: 0; font-size: 0.8rem; color: #64748b; }
        
        .exit-btn { text-decoration: none; color: #64748b; font-weight: 600; display: flex; align-items: center; gap: 8px; transition:0.2s; }
        .exit-btn:hover { color: #ef4444; }

        /* --- KONTEYNER --- */
        .main-container { max-width: 900px; margin: 40px auto; padding: 0 20px; }

        /* --- ADIM KARTLARI --- */
        .step-card {
            background: var(--surface); border-radius: 16px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.05);
            padding: 40px; border: 1px solid var(--border); animation: fadeIn 0.5s ease-out;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- FORM ELEMANLARI --- */
        .input-group { margin-bottom: 25px; }
        .input-group label { display: block; font-weight: 600; margin-bottom: 8px; color: #334155; }
        .form-control {
            width: 100%; padding: 12px 16px; border: 2px solid var(--border); border-radius: 10px;
            font-size: 1rem; transition: 0.3s; box-sizing: border-box; font-family: inherit;
        }
        .form-control:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); }

        .btn-start {
            background: var(--primary); color: white; width: 100%; padding: 16px; border: none;
            border-radius: 10px; font-size: 1.1rem; font-weight: 700; cursor: pointer;
            transition: 0.2s; display: flex; align-items: center; justify-content: center; gap: 10px;
        }
        .btn-start:hover { background: var(--primary-dark); transform: translateY(-2px); }

        /* --- SORU LÄ°STESÄ° --- */
        .domain-badge {
            display: inline-block; padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 15px;
        }
        .bg-dil { background: #dbeafe; color: #1e40af; }
        .bg-ince { background: #fce7f3; color: #9d174d; }
        .bg-kaba { background: #dcfce7; color: #166534; }
        .bg-sosyal { background: #fff7ed; color: #9a3412; }

        .question-row {
            display: grid; grid-template-columns: 1fr auto; gap: 20px; align-items: center;
            padding: 20px; border-bottom: 1px solid #f1f5f9; transition: 0.2s;
        }
        .question-row:hover { background: #f8fafc; }
        .q-text { font-size: 1.05rem; font-weight: 500; color: #334155; }

        .options-group { display: flex; gap: 10px; }
        .opt-btn {
            padding: 8px 16px; border: 1px solid var(--border); border-radius: 8px; background: white;
            cursor: pointer; font-size: 0.9rem; color: #64748b; font-weight: 600; transition: 0.2s;
        }
        .opt-btn:hover { background: #f1f5f9; }
        
        .opt-btn.selected[data-val="2"] { background: #10b981; color: white; border-color: #10b981; } /* Evet */
        .opt-btn.selected[data-val="1"] { background: #f59e0b; color: white; border-color: #f59e0b; } /* Bazen */
        .opt-btn.selected[data-val="0"] { background: #ef4444; color: white; border-color: #ef4444; } /* HayÄ±r */

        /* --- RAPOR EKRANI --- */
        .report-header { text-align: center; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 2px dashed var(--border); }
        .age-calc-box {
            background: #f0f9ff; border: 1px solid #bae6fd; padding: 15px; border-radius: 12px;
            color: #0369a1; font-size: 0.95rem; margin-bottom: 30px; display: flex; align-items: center; gap: 10px;
        }

        .chart-wrapper { position: relative; height: 350px; width: 100%; margin-bottom: 40px; }

        .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: #f8fafc; padding: 20px; border-radius: 12px; text-align: center; border: 1px solid var(--border); }
        .stat-val { font-size: 2rem; font-weight: 800; color: var(--text); display: block; }
        .stat-label { font-size: 0.8rem; text-transform: uppercase; color: #64748b; font-weight: 700; letter-spacing: 1px; }

        .clinical-note {
            background: #fff; border-left: 5px solid; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px;
        }
        .note-high { border-color: #10b981; }
        .note-med { border-color: #f59e0b; }
        .note-low { border-color: #ef4444; }

        /* PRINT */
        @media print {
            body { background: white; }
            .clinic-header, .btn-start, .options-group { display: none; }
            .main-container { margin: 0; box-shadow: none; border: none; }
            .step-card { box-shadow: none; border: none; padding: 0; }
        }

    </style>
</head>
<body>

    <header class="clinic-header">
        <div class="brand">
            <div class="brand-icon"><i class="fas fa-user-md"></i></div>
            <div class="brand-text">
                <h1>GeliÅŸim Envanteri Pro</h1>
                <p>Klinik GÃ¶zlem & Analiz Sistemi v3.0</p>
            </div>
        </div>
        <a href="ozel-egitim.html" class="exit-btn"><i class="fas fa-sign-out-alt"></i> Ã‡Ä±kÄ±ÅŸ</a>
    </header>

    <div class="main-container">

        <div id="screen-intake" class="step-card">
            <h2 style="margin-top:0; color:var(--primary-dark);">Ã‡ocuk Bilgileri (Anamnez)</h2>
            <p style="color:#64748b; margin-bottom:30px;">Bu test, Denver II ve AGTE prensipleri baz alÄ±narak hazÄ±rlanmÄ±ÅŸ dijital bir tarama aracÄ±dÄ±r. Kesin tanÄ± iÃ§in lÃ¼tfen uzman onayÄ± alÄ±nÄ±z.</p>

            <div class="input-group">
                <label>AdÄ± SoyadÄ± (Rapor iÃ§in)</label>
                <input type="text" id="childName" class="form-control" placeholder="Ã–rn: Ali YÄ±lmaz">
            </div>

            <div class="input-group">
                <label>DoÄŸum Tarihi <span style="color:red">*</span></label>
                <input type="date" id="birthDate" class="form-control">
                <small style="color:#64748b; display:block; margin-top:5px;">Sistem kronolojik yaÅŸÄ± gÃ¼n hesabÄ± yaparak belirler.</small>
            </div>

            <div class="input-group">
                <label>PrematÃ¼re DoÄŸum Ã–ykÃ¼sÃ¼ Var mÄ±?</label>
                <select id="premature" class="form-control">
                    <option value="0">HayÄ±r (ZamanÄ±nda DoÄŸum)</option>
                    <option value="1">Evet (DÃ¼zeltilmiÅŸ YaÅŸ Hesaplanacak)</option>
                </select>
            </div>

            <button class="btn-start" onclick="startAssessment()">
                TARAMAYI BAÅžLAT <i class="fas fa-stethoscope"></i>
            </button>
        </div>

        <div id="screen-test" class="step-card" style="display:none;">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px; border-bottom:1px solid #eee; padding-bottom:15px;">
                <div>
                    <h3 style="margin:0; font-size:1.1rem;">GeliÅŸimsel Kontrol Listesi</h3>
                    <span id="chronological-age-display" style="font-size:0.9rem; color:var(--secondary); font-weight:600;"></span>
                </div>
                <div style="text-align:right;">
                    <span id="progress-txt" style="font-weight:bold; color:var(--primary);">0%</span>
                </div>
            </div>

            <div id="questions-wrapper">
                </div>

            <button class="btn-start" style="margin-top:30px;" onclick="generateReport()">
                ANALÄ°ZÄ° TAMAMLA & RAPORLA
            </button>
        </div>

        <div id="screen-report" class="step-card" style="display:none;">
            <div class="report-header">
                <h1 style="color:var(--primary-dark); margin:0;">GELÄ°ÅžÄ°MSEL ANALÄ°Z RAPORU</h1>
                <p style="color:#64748b; margin:5px 0;">Referans No: <span id="ref-no">TR-2026-X</span> | Tarih: <span id="report-date"></span></p>
                <h3 id="report-child-name" style="margin:10px 0 0 0; color:#334155;"></h3>
            </div>

            <div class="age-calc-box">
                <i class="fas fa-calculator"></i>
                <span id="age-calc-detail">Hesaplanan Kronolojik YaÅŸ: ...</span>
            </div>

            <div class="chart-wrapper">
                <canvas id="developmentChart"></canvas>
            </div>

            <div class="stat-grid">
                <div class="stat-card" style="border-top:4px solid #3b82f6;">
                    <span class="stat-label">DÄ°L & Ä°LETÄ°ÅžÄ°M</span>
                    <span class="stat-val" id="val-dil" style="color:#3b82f6;">--</span>
                </div>
                <div class="stat-card" style="border-top:4px solid #ec4899;">
                    <span class="stat-label">Ä°NCE MOTOR</span>
                    <span class="stat-val" id="val-ince" style="color:#ec4899;">--</span>
                </div>
                <div class="stat-card" style="border-top:4px solid #10b981;">
                    <span class="stat-label">KABA MOTOR</span>
                    <span class="stat-val" id="val-kaba" style="color:#10b981;">--</span>
                </div>
                <div class="stat-card" style="border-top:4px solid #f59e0b;">
                    <span class="stat-label">SOSYAL & Ã–ZBAKIM</span>
                    <span class="stat-val" id="val-sosyal" style="color:#f59e0b;">--</span>
                </div>
            </div>

            <div id="clinical-summary"></div>

            <div style="margin-top:40px; display:flex; gap:15px;">
                <button class="btn-start" onclick="window.print()" style="background:#334155;">
                    <i class="fas fa-print"></i> YAZDIR / PDF KAYDET
                </button>
                <button class="btn-start" onclick="location.reload()" style="background:#fff; color:#334155; border:1px solid #ccc;">
                    YENÄ° TEST
                </button>
            </div>
        </div>

    </div>

    <script>
        // --- 1. GELÄ°ÅžMÄ°Åž VERÄ° SETÄ° (0-6 YAÅž) ---
        // Her alan iÃ§in gerÃ§ekÃ§i geliÅŸim maddeleri
        const database = {
            '0-12': [ // BEBEKLÄ°K
                { id: 'k1', dom: 'kaba', t: 'Desteksiz oturabiliyor mu?' },
                { id: 'k2', dom: 'kaba', t: 'Emekleyerek veya sÃ¼rÃ¼nerek yer deÄŸiÅŸtiriyor mu?' },
                { id: 'k3', dom: 'kaba', t: 'Bir yerden tutunarak ayaÄŸa kalkabiliyor mu?' },
                { id: 'i1', dom: 'ince', t: 'Nesneleri bir elinden diÄŸerine geÃ§irebiliyor mu?' },
                { id: 'i2', dom: 'ince', t: 'BaÅŸparmak ve iÅŸaret parmaÄŸÄ±yla kÃ¼Ã§Ã¼k cisimleri (kÄ±skaÃ§) tutabiliyor mu?' },
                { id: 'd1', dom: 'dil', t: 'Bababa, dedede gibi heceleri tekrar ediyor mu?' },
                { id: 'd2', dom: 'dil', t: 'HayÄ±r dendiÄŸinde duraksÄ±yor veya tepki veriyor mu?' },
                { id: 's1', dom: 'sosyal', t: 'Ce-ee oyununa gÃ¼lerek tepki veriyor mu?' },
                { id: 's2', dom: 'sosyal', t: 'Aynadaki gÃ¶rÃ¼ntÃ¼sÃ¼ne ilgi gÃ¶steriyor mu?' }
            ],
            '13-24': [ // 1-2 YAÅž
                { id: 'k4', dom: 'kaba', t: 'Desteksiz yÃ¼rÃ¼yebiliyor mu?' },
                { id: 'k5', dom: 'kaba', t: 'YÃ¼rÃ¼rken durup yerdeki bir oyuncaÄŸÄ± alabiliyor mu?' },
                { id: 'i3', dom: 'ince', t: '2-3 kÃ¼ple kule yapabiliyor mu?' },
                { id: 'i4', dom: 'ince', t: 'KaÄŸÄ±t Ã¼zerine karalama yapabiliyor mu?' },
                { id: 'd3', dom: 'dil', t: 'Anne, baba dÄ±ÅŸÄ±nda en az 3-5 anlamlÄ± kelimesi var mÄ±?' },
                { id: 'd4', dom: 'dil', t: 'VÃ¼cudunun en az 2 parÃ§asÄ±nÄ± (gÃ¶z, kulak) gÃ¶sterebiliyor mu?' },
                { id: 's3', dom: 'sosyal', t: 'Basit ev iÅŸlerini taklit ediyor mu? (Toz alma, sÃ¼pÃ¼rme)' },
                { id: 's4', dom: 'sosyal', t: 'KaÅŸÄ±k veya Ã§atal kullanarak yemek yiyebiliyor mu?' }
            ],
            '25-36': [ // 2-3 YAÅž
                { id: 'k6', dom: 'kaba', t: 'Ã‡ift ayakla zÄ±playabiliyor mu?' },
                { id: 'k7', dom: 'kaba', t: 'Merdivenleri tutunarak Ã§Ä±kÄ±p inebiliyor mu?' },
                { id: 'i5', dom: 'ince', t: 'Kitap sayfalarÄ±nÄ± teker teker Ã§evirebiliyor mu?' },
                { id: 'i6', dom: 'ince', t: 'Kavanoz kapaklarÄ±nÄ± Ã§evirerek aÃ§abiliyor mu?' },
                { id: 'd5', dom: 'dil', t: 'Ä°ki kelimelik cÃ¼mleler kuruyor mu? (Baba gel, su ver)' },
                { id: 'd6', dom: 'dil', t: 'Ä°smi sorulduÄŸunda sÃ¶yleyebiliyor mu?' },
                { id: 's5', dom: 'sosyal', t: 'Ellerini yÄ±kayÄ±p kurulayabiliyor mu?' },
                { id: 's6', dom: 'sosyal', t: 'OyuncaÄŸÄ±nÄ± baÅŸkalarÄ±yla paylaÅŸmakta zorlansa da oyun kuruyor mu?' }
            ],
            '37-48': [ // 3-4 YAÅž
                { id: 'k8', dom: 'kaba', t: 'Tek ayak Ã¼zerinde 2-3 saniye dengede durabiliyor mu?' },
                { id: 'k9', dom: 'kaba', t: 'ÃœÃ§ tekerlekli bisikleti pedallarÄ±nÄ± Ã§evirerek sÃ¼rebiliyor mu?' },
                { id: 'i7', dom: 'ince', t: 'Makasla kaÄŸÄ±dÄ± geliÅŸigÃ¼zel kesebiliyor mu?' },
                { id: 'i8', dom: 'ince', t: 'Daire ÅŸeklini bakarak Ã§izebiliyor mu?' },
                { id: 'd7', dom: 'dil', t: '3-4 kelimelik cÃ¼mleler kurabiliyor mu?' },
                { id: 'd8', dom: 'dil', t: '"Neden, NasÄ±l, Ne zaman" sorularÄ±nÄ± soruyor mu?' },
                { id: 's7', dom: 'sosyal', t: 'Tuvalet ihtiyacÄ±nÄ± baÄŸÄ±msÄ±z giderebiliyor mu?' },
                { id: 's8', dom: 'sosyal', t: 'SÄ±rasÄ±nÄ± bekleme kavramÄ±nÄ± anlÄ±yor mu?' }
            ],
            '49-60': [ // 4-5 YAÅž
                { id: 'k10', dom: 'kaba', t: 'Topu havaya atÄ±p tutabiliyor mu?' },
                { id: 'i9', dom: 'ince', t: 'Ä°nsan resmi Ã§izerken en az 3 organ (baÅŸ, gÃ¶z, aÄŸÄ±z) yapÄ±yor mu?' },
                { id: 'd9', dom: 'dil', t: 'GeÃ§miÅŸ ve gelecek zaman eklerini doÄŸru kullanÄ±yor mu?' },
                { id: 's9', dom: 'sosyal', t: 'DÃ¼ÄŸmelerini ilikleyip Ã§Ã¶zebiliyor mu?' },
                { id: 'b1', dom: 'biliÅŸ', t: 'Renkleri (en az 4 ana renk) tanÄ±yor ve eÅŸleÅŸtiriyor mu?' }
            ],
            '61-72': [ // 5-6 YAÅž (OKUL Ã–NCESÄ°)
                { id: 'k11', dom: 'kaba', t: 'Geri geri yÃ¼rÃ¼yebiliyor mu (topuk-parmak)?' },
                { id: 'i10', dom: 'ince', t: 'AdÄ±nÄ± ve soyadÄ±nÄ± yazabiliyor mu (veya kopyalayabiliyor mu)?' },
                { id: 'd10', dom: 'dil', t: 'ZÄ±t kavramlarÄ± (bÃ¼yÃ¼k-kÃ¼Ã§Ã¼k, uzun-kÄ±sa) biliyor mu?' },
                { id: 's10', dom: 'sosyal', t: 'KurallÄ± grup oyunlarÄ±na uyum saÄŸlÄ±yor mu?' },
                { id: 'b2', dom: 'biliÅŸ', t: '10\'a kadar nesneleri sayabiliyor mu?' }
            ]
        };

        // --- GLOBAL DEÄžÄ°ÅžKENLER ---
        let currentAgeGroupKey = '';
        let scores = { dil: 0, ince: 0, kaba: 0, sosyal: 0 };
        let maxScores = { dil: 0, ince: 0, kaba: 0, sosyal: 0 };
        let chronologicalMonths = 0;

        // --- KRONOLOJÄ°K YAÅž HESABI ---
        function calculateExactAge(birthDateStr) {
            const birth = new Date(birthDateStr);
            const now = new Date();
            
            let years = now.getFullYear() - birth.getFullYear();
            let months = now.getMonth() - birth.getMonth();
            let days = now.getDate() - birth.getDate();

            if (days < 0) {
                months--;
                days += new Date(now.getFullYear(), now.getMonth(), 0).getDate();
            }
            if (months < 0) {
                years--;
                months += 12;
            }

            chronologicalMonths = (years * 12) + months;
            
            return {
                text: `${years} YÄ±l, ${months} Ay, ${days} GÃ¼n`,
                totalMonths: chronologicalMonths
            };
        }

        // --- TESTÄ° BAÅžLAT ---
        function startAssessment() {
            const name = document.getElementById('childName').value;
            const bdate = document.getElementById('birthDate').value;

            if(!bdate) { alert("LÃ¼tfen doÄŸum tarihini giriniz."); return; }

            const ageData = calculateExactAge(bdate);
            const m = ageData.totalMonths;

            // YaÅŸ Grubu Belirleme (Dinamik)
            if(m <= 12) currentAgeGroupKey = '0-12';
            else if(m <= 24) currentAgeGroupKey = '13-24';
            else if(m <= 36) currentAgeGroupKey = '25-36';
            else if(m <= 48) currentAgeGroupKey = '37-48';
            else if(m <= 60) currentAgeGroupKey = '49-60';
            else if(m <= 72) currentAgeGroupKey = '61-72';
            else {
                alert("Bu envanter 0-72 ay (6 yaÅŸ) aralÄ±ÄŸÄ± iÃ§indir.");
                return;
            }

            // Ekran GeÃ§iÅŸi
            document.getElementById('screen-intake').style.display = 'none';
            document.getElementById('screen-test').style.display = 'block';
            
            document.getElementById('chronological-age-display').innerText = `Takvim YaÅŸÄ±: ${ageData.text}`;
            
            renderQuestions();
        }

        // --- SORULARI OLUÅžTUR ---
        function renderQuestions() {
            const container = document.getElementById('questions-wrapper');
            const data = database[currentAgeGroupKey];
            container.innerHTML = "";

            // Ã–nce max puanlarÄ± sÄ±fÄ±rla
            maxScores = { dil: 0, ince: 0, kaba: 0, sosyal: 0 };

            data.forEach((q, index) => {
                // Max puanÄ± artÄ±r (Her soru max 2 puan)
                if(q.dom === 'biliÅŸ') maxScores['ince'] += 2; // BiliÅŸi ince motora dahil edelim basitlik iÃ§in
                else maxScores[q.dom] += 2;

                let badgeClass = '';
                let label = '';
                switch(q.dom) {
                    case 'dil': badgeClass='bg-dil'; label='Dil & KonuÅŸma'; break;
                    case 'ince': badgeClass='bg-ince'; label='Ä°nce Motor'; break;
                    case 'kaba': badgeClass='bg-kaba'; label='Kaba Motor'; break;
                    case 'sosyal': badgeClass='bg-sosyal'; label='Sosyal & Ã–zbakÄ±m'; break;
                    default: badgeClass='bg-ince'; label='BiliÅŸsel';
                }

                const html = `
                <div class="question-row">
                    <div>
                        <span class="domain-badge ${badgeClass}">${label}</span>
                        <div class="q-text">${index+1}. ${q.t}</div>
                    </div>
                    <div class="options-group" id="qgroup-${q.id}">
                        <button class="opt-btn" onclick="selectOpt(this, '${q.dom}', 2)">EVET</button>
                        <button class="opt-btn" onclick="selectOpt(this, '${q.dom}', 1)">BAZEN</button>
                        <button class="opt-btn" onclick="selectOpt(this, '${q.dom}', 0)">HAYIR</button>
                    </div>
                </div>`;
                container.innerHTML += html;
            });
        }

        // --- SEÃ‡Ä°M MANTIÄžI ---
        function selectOpt(btn, domain, val) {
            const parent = btn.parentElement;
            // Ã–ncekini temizle
            const buttons = parent.querySelectorAll('.opt-btn');
            buttons.forEach(b => b.classList.remove('selected'));
            
            // SeÃ§ileni iÅŸaretle
            btn.classList.add('selected');
            btn.setAttribute('data-val', val);

            // Ä°lerleme Ã§ubuÄŸu (Basit)
            // (DetaylÄ± hesaplama report aÅŸamasÄ±nda yapÄ±lacak)
        }

        // --- RAPOR OLUÅžTURMA ---
        function generateReport() {
            // PuanlarÄ± topla
            scores = { dil: 0, ince: 0, kaba: 0, sosyal: 0 };
            const allGroups = document.querySelectorAll('.options-group');
            
            let answeredCount = 0;

            allGroups.forEach(group => {
                const selected = group.querySelector('.selected');
                if(selected) {
                    answeredCount++;
                    const val = parseInt(selected.getAttribute('data-val'));
                    // Domaini butonun onclick'inden deÄŸil, HTML yapÄ±sÄ±ndan Ã§ekmek zor, 
                    // o yÃ¼zden render ederken ID'ye gÃ¶mdÃ¼ÄŸÃ¼mÃ¼zÃ¼ varsayalÄ±m ya da yeniden hesaplayalÄ±m.
                    // Pratik Ã§Ã¶zÃ¼m: onclick iÃ§inde global deÄŸiÅŸkene atmak yerine burada DOM'dan okuyalÄ±m.
                    // Ama yukarÄ±da selectOpt iÃ§inde skor tutmadÄ±k.
                    // DÃ¼zeltme: selectOpt fonksiyonu global bir "tempAnswers" objesi doldursun.
                }
            });

            // Basitlik adÄ±na DOM Ã¼zerinden tekrar tarayalÄ±m
            // (GerÃ§ek uygulamada state management kullanÄ±lÄ±r ama burada vanilla JS ile gidiyoruz)
            const data = database[currentAgeGroupKey];
            data.forEach(q => {
                const group = document.getElementById(`qgroup-${q.id}`);
                const selected = group.querySelector('.selected');
                if(selected) {
                    const val = parseInt(selected.getAttribute('data-val'));
                    if(q.dom === 'biliÅŸ') scores['ince'] += val;
                    else scores[q.dom] += val;
                }
            });

            if(answeredCount < data.length) {
                if(!confirm("TÃ¼m sorularÄ± yanÄ±tlamadÄ±nÄ±z. Yine de rapor oluÅŸturulsun mu?")) return;
            }

            // EKRAN GEÃ‡Ä°ÅžÄ°
            document.getElementById('screen-test').style.display = 'none';
            document.getElementById('screen-report').style.display = 'block';

            // BAÅžLIK BÄ°LGÄ°LERÄ°
            document.getElementById('report-child-name').innerText = document.getElementById('childName').value || "Ä°simsiz DanÄ±ÅŸan";
            document.getElementById('report-date').innerText = new Date().toLocaleDateString('tr-TR');
            document.getElementById('ref-no').innerText = "CL-" + Math.floor(Math.random()*10000);
            
            const ageInfo = calculateExactAge(document.getElementById('birthDate').value);
            document.getElementById('age-calc-detail').innerText = `Hesaplanan YaÅŸ: ${ageInfo.text} (${currentAgeGroupKey} Ay Grubu NormlarÄ± KullanÄ±ldÄ±)`;

            // YÃœZDELERÄ° HESAPLA
            const perDil = Math.round((scores.dil / maxScores.dil) * 100) || 0;
            const perInce = Math.round((scores.ince / maxScores.ince) * 100) || 0;
            const perKaba = Math.round((scores.kaba / maxScores.kaba) * 100) || 0;
            const perSosyal = Math.round((scores.sosyal / maxScores.sosyal) * 100) || 0;

            document.getElementById('val-dil').innerText = `%${perDil}`;
            document.getElementById('val-ince').innerText = `%${perInce}`;
            document.getElementById('val-kaba').innerText = `%${perKaba}`;
            document.getElementById('val-sosyal').innerText = `%${perSosyal}`;

            // KLÄ°NÄ°K YORUM
            const avg = (perDil + perInce + perKaba + perSosyal) / 4;
            const noteBox = document.getElementById('clinical-summary');
            
            if(avg >= 85) {
                noteBox.className = "clinical-note note-high";
                noteBox.innerHTML = `<strong>ðŸŸ¢ GELÄ°ÅžÄ°MSEL SONUÃ‡: UYUMLU</strong><br>Ã‡ocuÄŸun geliÅŸimsel becerileri takvim yaÅŸÄ±yla yÃ¼ksek dÃ¼zeyde uyumlu gÃ¶rÃ¼nmektedir. Mevcut destekleyici tutumun devamÄ± Ã¶nerilir.`;
            } else if(avg >= 65) {
                noteBox.className = "clinical-note note-med";
                noteBox.innerHTML = `<strong>ðŸŸ¡ GELÄ°ÅžÄ°MSEL SONUÃ‡: TAKÄ°P GEREKTÄ°RÄ°R</strong><br>Genel geliÅŸim sÄ±nÄ±rda izlenmektedir. Ã–zellikle dÃ¼ÅŸÃ¼k puan alÄ±nan alanlarda (Ã–rn: ${getLowestArea(perDil, perInce, perKaba, perSosyal)}) destekleyici etkinlikler planlanmalÄ± ve 3 ay sonra tekrar deÄŸerlendirilmelidir.`;
            } else {
                noteBox.className = "clinical-note note-low";
                noteBox.innerHTML = `<strong>ðŸ”´ GELÄ°ÅžÄ°MSEL SONUÃ‡: RÄ°SK GRUBU</strong><br>GeliÅŸimsel basamaklarda takvim yaÅŸÄ±na gÃ¶re anlamlÄ± gecikmeler gÃ¶zlemlenmiÅŸtir. Vakit kaybetmeden bir Ã‡ocuk Psikiyatristi veya GeliÅŸim UzmanÄ±'na baÅŸvurulmasÄ± klinik olarak Ã¶nerilir.`;
            }

            // GRAFÄ°K Ã‡Ä°Z
            renderChart(perDil, perInce, perKaba, perSosyal);
        }

        function getLowestArea(d, i, k, s) {
            if(d<=i && d<=k && d<=s) return "Dil GeliÅŸimi";
            if(i<=d && i<=k && i<=s) return "Ä°nce Motor";
            if(k<=d && k<=i && k<=s) return "Kaba Motor";
            return "Sosyal GeliÅŸim";
        }

        // --- CHART.JS ---
        function renderChart(d, i, k, s) {
            const ctx = document.getElementById('developmentChart').getContext('2d');
            new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Dil & KonuÅŸma', 'Ä°nce Motor', 'Kaba Motor', 'Sosyal & Ã–zbakÄ±m'],
                    datasets: [{
                        label: 'Ã‡ocuÄŸun GeliÅŸim Profili',
                        data: [d, i, k, s],
                        backgroundColor: 'rgba(37, 99, 235, 0.2)',
                        borderColor: '#2563eb',
                        pointBackgroundColor: '#1e40af',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#2563eb',
                        borderWidth: 3
                    },
                    {
                        label: 'Beklenen Norm (100%)',
                        data: [100, 100, 100, 100],
                        borderColor: '#94a3b8',
                        borderDash: [5, 5],
                        borderWidth: 1,
                        fill: false,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            angleLines: { color: '#e2e8f0' },
                            grid: { color: '#f1f5f9' },
                            pointLabels: {
                                font: { size: 12, weight: 'bold', family: 'Inter' },
                                color: '#475569'
                            },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            ticks: { stepSize: 20, display: false }
                        }
                    },
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }

    </script>
</body>
</html>
